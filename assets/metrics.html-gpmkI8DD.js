import{_ as s}from"./plugin-vue_export-helper-DlAUqK2U.js";import{o as n,c as a,f as e}from"./app-DR5J2daJ.js";const t={},p=e(`<h2 id="部署metrics-server" tabindex="-1"><a class="header-anchor" href="#部署metrics-server"><span>部署metrics-server</span></a></h2><h3 id="下载yaml文件" tabindex="-1"><a class="header-anchor" href="#下载yaml文件"><span>下载yaml文件</span></a></h3><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">wget</span> <span class="token parameter variable">-O</span> metrics-server-components.yaml https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/components.yaml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="更改镜像地址" tabindex="-1"><a class="header-anchor" href="#更改镜像地址"><span>更改镜像地址</span></a></h3><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">&#39;s/registry.k8s.io\\/metrics-server/registry.cn-hangzhou.aliyuncs.com\\/google_containers/g&#39;</span> metrics-server-components.yaml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="部署应用" tabindex="-1"><a class="header-anchor" href="#部署应用"><span>部署应用</span></a></h3><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>kubectl apply <span class="token parameter variable">-f</span> metrics-server-components.yaml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="常见问题" tabindex="-1"><a class="header-anchor" href="#常见问题"><span>常见问题</span></a></h2><h3 id="证书问题" tabindex="-1"><a class="header-anchor" href="#证书问题"><span>证书问题</span></a></h3><ul><li>问题描述</li></ul><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment"># 查询</span>
kubectl <span class="token parameter variable">-n</span> kube-system logs pods/metrics-server-86dd957dc5-tfz2r

<span class="token comment"># 错误信息</span>
E0411 02:24:41.598087       <span class="token number">1</span> scraper.go:140<span class="token punctuation">]</span> <span class="token string">&quot;Failed to scrape node&quot;</span> <span class="token assign-left variable">err</span><span class="token operator">=</span><span class="token string">&quot;Get <span class="token entity" title="\\&quot;">\\&quot;</span>https://10.10.12.210:10250/metrics/resource<span class="token entity" title="\\&quot;">\\&quot;</span>: x509: cannot validate certificate for 10.10.12.210 because it doesn&#39;t contain any IP SANs&quot;</span> <span class="token assign-left variable">node</span><span class="token operator">=</span><span class="token string">&quot;k8s-master01&quot;</span>
I0411 02:24:45.273592       <span class="token number">1</span> server.go:187<span class="token punctuation">]</span> <span class="token string">&quot;Failed probe&quot;</span> <span class="token assign-left variable">probe</span><span class="token operator">=</span><span class="token string">&quot;metric-storage-ready&quot;</span> <span class="token assign-left variable">err</span><span class="token operator">=</span><span class="token string">&quot;no metrics to serve&quot;</span>
I0411 02:24:55.274604       <span class="token number">1</span> server.go:187<span class="token punctuation">]</span> <span class="token string">&quot;Failed probe&quot;</span> <span class="token assign-left variable">probe</span><span class="token operator">=</span><span class="token string">&quot;metric-storage-ready&quot;</span> <span class="token assign-left variable">err</span><span class="token operator">=</span><span class="token string">&quot;no metrics to serve&quot;</span>
E0411 02:24:56.583622       <span class="token number">1</span> scraper.go:140<span class="token punctuation">]</span> <span class="token string">&quot;Failed to scrape node&quot;</span> <span class="token assign-left variable">err</span><span class="token operator">=</span><span class="token string">&quot;Get <span class="token entity" title="\\&quot;">\\&quot;</span>https://10.10.12.214:10250/metrics/resource<span class="token entity" title="\\&quot;">\\&quot;</span>: x509: cannot validate certificate for 10.10.12.214 because it doesn&#39;t contain any IP SANs&quot;</span> <span class="token assign-left variable">node</span><span class="token operator">=</span><span class="token string">&quot;k8s-workder03&quot;</span>
E0411 02:24:56.585732       <span class="token number">1</span> scraper.go:140<span class="token punctuation">]</span> <span class="token string">&quot;Failed to scrape node&quot;</span> <span class="token assign-left variable">err</span><span class="token operator">=</span><span class="token string">&quot;Get <span class="token entity" title="\\&quot;">\\&quot;</span>https://10.10.12.210:10250/metrics/resource<span class="token entity" title="\\&quot;">\\&quot;</span>: x509: cannot validate certificate for 10.10.12.210 because it doesn&#39;t contain any IP SANs&quot;</span> <span class="token assign-left variable">node</span><span class="token operator">=</span><span class="token string">&quot;k8s-master01&quot;</span>
E0411 02:24:56.597080       <span class="token number">1</span> scraper.go:140<span class="token punctuation">]</span> <span class="token string">&quot;Failed to scrape node&quot;</span> <span class="token assign-left variable">err</span><span class="token operator">=</span><span class="token string">&quot;Get <span class="token entity" title="\\&quot;">\\&quot;</span>https://10.10.12.213:10250/metrics/resource<span class="token entity" title="\\&quot;">\\&quot;</span>: x509: cannot validate certificate for 10.10.12.213 because it doesn&#39;t contain any IP SANs&quot;</span> <span class="token assign-left variable">node</span><span class="token operator">=</span><span class="token string">&quot;k8s-workder02&quot;</span>
E0411 02:24:56.600963       <span class="token number">1</span> scraper.go:140<span class="token punctuation">]</span> <span class="token string">&quot;Failed to scrape node&quot;</span> <span class="token assign-left variable">err</span><span class="token operator">=</span><span class="token string">&quot;Get <span class="token entity" title="\\&quot;">\\&quot;</span>https://10.10.12.212:10250/metrics/resource<span class="token entity" title="\\&quot;">\\&quot;</span>: x509: cannot validate certificate for 10.10.12.212 because it doesn&#39;t contain any IP SANs&quot;</span> <span class="token assign-left variable">node</span><span class="token operator">=</span><span class="token string">&quot;k8s-workder01&quot;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>解决方案 在<code>metrics-server-components.yaml</code>加入<code>--kubelet-insecure-tls</code>参数，具体如下： 更改之前：</li></ul><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">k8s-app</span><span class="token punctuation">:</span> metrics<span class="token punctuation">-</span>server
  <span class="token key atrule">name</span><span class="token punctuation">:</span> metrics<span class="token punctuation">-</span>server
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>system
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">k8s-app</span><span class="token punctuation">:</span> metrics<span class="token punctuation">-</span>server
  <span class="token key atrule">strategy</span><span class="token punctuation">:</span>
    <span class="token key atrule">rollingUpdate</span><span class="token punctuation">:</span>
      <span class="token key atrule">maxUnavailable</span><span class="token punctuation">:</span> <span class="token number">0</span>
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">k8s-app</span><span class="token punctuation">:</span> metrics<span class="token punctuation">-</span>server
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">args</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>cert<span class="token punctuation">-</span>dir=/tmp
        <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>secure<span class="token punctuation">-</span>port=4443
        <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>kubelet<span class="token punctuation">-</span>preferred<span class="token punctuation">-</span>address<span class="token punctuation">-</span>types=InternalIP<span class="token punctuation">,</span>ExternalIP<span class="token punctuation">,</span>Hostname
        <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>kubelet<span class="token punctuation">-</span>use<span class="token punctuation">-</span>node<span class="token punctuation">-</span>status<span class="token punctuation">-</span>port
        <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>metric<span class="token punctuation">-</span>resolution=15s
        <span class="token key atrule">image</span><span class="token punctuation">:</span> registry.cn<span class="token punctuation">-</span>hangzhou.aliyuncs.com/google_containers/metrics<span class="token punctuation">-</span>server<span class="token punctuation">:</span>v0.6.3
        <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> IfNotPresent
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>更改之后：</p><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">k8s-app</span><span class="token punctuation">:</span> metrics<span class="token punctuation">-</span>server
  <span class="token key atrule">name</span><span class="token punctuation">:</span> metrics<span class="token punctuation">-</span>server
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>system
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">k8s-app</span><span class="token punctuation">:</span> metrics<span class="token punctuation">-</span>server
  <span class="token key atrule">strategy</span><span class="token punctuation">:</span>
    <span class="token key atrule">rollingUpdate</span><span class="token punctuation">:</span>
      <span class="token key atrule">maxUnavailable</span><span class="token punctuation">:</span> <span class="token number">0</span>
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">k8s-app</span><span class="token punctuation">:</span> metrics<span class="token punctuation">-</span>server
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">args</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>cert<span class="token punctuation">-</span>dir=/tmp
        <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>secure<span class="token punctuation">-</span>port=4443
        <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>kubelet<span class="token punctuation">-</span>preferred<span class="token punctuation">-</span>address<span class="token punctuation">-</span>types=InternalIP<span class="token punctuation">,</span>ExternalIP<span class="token punctuation">,</span>Hostname
        <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>kubelet<span class="token punctuation">-</span>use<span class="token punctuation">-</span>node<span class="token punctuation">-</span>status<span class="token punctuation">-</span>port
        <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>metric<span class="token punctuation">-</span>resolution=15s
        <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>kubelet<span class="token punctuation">-</span>insecure<span class="token punctuation">-</span>tls
        <span class="token key atrule">image</span><span class="token punctuation">:</span> registry.cn<span class="token punctuation">-</span>hangzhou.aliyuncs.com/google_containers/metrics<span class="token punctuation">-</span>server<span class="token punctuation">:</span>v0.6.3
        <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> IfNotPresent
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>更新Deployment</li></ul><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>kubectl apply <span class="token parameter variable">-f</span> metrics-server-components.yaml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,17),l=[p];function c(o,i){return n(),a("div",null,l)}const d=s(t,[["render",c],["__file","metrics.html.vue"]]),k=JSON.parse('{"path":"/guide/cloudnative/kubernetes/metrics.html","title":"Metrics","lang":"zh-CN","frontmatter":{"title":"Metrics","description":"部署metrics-server 下载yaml文件 更改镜像地址 部署应用 常见问题 证书问题 问题描述 解决方案 在metrics-server-components.yaml加入--kubelet-insecure-tls参数，具体如下： 更改之前： 更改之后： 更新Deployment","head":[["meta",{"property":"og:url","content":"https://github.com/abelit/abelit-datapeacock.git/guide/cloudnative/kubernetes/metrics.html"}],["meta",{"property":"og:site_name","content":"数之雀"}],["meta",{"property":"og:title","content":"Metrics"}],["meta",{"property":"og:description","content":"部署metrics-server 下载yaml文件 更改镜像地址 部署应用 常见问题 证书问题 问题描述 解决方案 在metrics-server-components.yaml加入--kubelet-insecure-tls参数，具体如下： 更改之前： 更改之后： 更新Deployment"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-05-11T14:06:18.000Z"}],["meta",{"property":"article:author","content":"Abelit"}],["meta",{"property":"article:modified_time","content":"2024-05-11T14:06:18.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Metrics\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2024-05-11T14:06:18.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Abelit\\",\\"url\\":\\"https://github.com/abelit\\"}]}"]]},"headers":[{"level":2,"title":"部署metrics-server","slug":"部署metrics-server","link":"#部署metrics-server","children":[{"level":3,"title":"下载yaml文件","slug":"下载yaml文件","link":"#下载yaml文件","children":[]},{"level":3,"title":"更改镜像地址","slug":"更改镜像地址","link":"#更改镜像地址","children":[]},{"level":3,"title":"部署应用","slug":"部署应用","link":"#部署应用","children":[]}]},{"level":2,"title":"常见问题","slug":"常见问题","link":"#常见问题","children":[{"level":3,"title":"证书问题","slug":"证书问题","link":"#证书问题","children":[]}]}],"git":{"createdTime":1715436378000,"updatedTime":1715436378000,"contributors":[{"name":"ableit","email":"ychenid@live.com","commits":1}]},"readingTime":{"minutes":1.5,"words":450},"filePathRelative":"guide/cloudnative/kubernetes/metrics.md","localizedDate":"2024年5月11日","autoDesc":true,"excerpt":"<h2>部署metrics-server</h2>\\n<h3>下载yaml文件</h3>\\n<div class=\\"language-bash\\" data-ext=\\"sh\\" data-title=\\"sh\\"><pre class=\\"language-bash\\"><code><span class=\\"token function\\">wget</span> <span class=\\"token parameter variable\\">-O</span> metrics-server-components.yaml https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/components.yaml\\n</code></pre></div>"}');export{d as comp,k as data};
