import{_ as s}from"./plugin-vue_export-helper-DlAUqK2U.js";import{o as n,c as a,f as e}from"./app-DR5J2daJ.js";const t={},l=e(`<h2 id="主从同步-binlog-pos-异步模式" tabindex="-1"><a class="header-anchor" href="#主从同步-binlog-pos-异步模式"><span>主从同步（Binlog+Pos+异步模式）</span></a></h2><h3 id="主机信息" tabindex="-1"><a class="header-anchor" href="#主机信息"><span>主机信息</span></a></h3><table><thead><tr><th>编号</th><th>IP 地址</th><th>角色</th><th>操作系统</th><th>内核版本</th><th>数据库版本</th></tr></thead><tbody><tr><td>1</td><td>10.10.12.213</td><td>主</td><td>CentOS 7.9</td><td>3.10.0-1160.el7.x86_64</td><td>MySQL 8.0</td></tr><tr><td>2</td><td>10.10.12.214</td><td>从</td><td>CentOS 7.9</td><td>3.10.0-1160.el7.x86_64</td><td>MySQL 8.0</td></tr></tbody></table><h3 id="安装数据库" tabindex="-1"><a class="header-anchor" href="#安装数据库"><span>安装数据库</span></a></h3><ul><li>安装 <blockquote><p>主、从</p></blockquote></li></ul><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>systemctl stop firewalld
yum <span class="token function">install</span> <span class="token parameter variable">-y</span> https://repo.mysql.com//mysql80-community-release-el7-7.noarch.rpm
yum <span class="token function">install</span> <span class="token parameter variable">-y</span> mysql-server
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>重启数据库 <blockquote><p>主从节点</p></blockquote></li></ul><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>systemctl restart mysqld
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>获取初始化密码</li></ul><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">cat</span> /var/log/mysqld.log<span class="token operator">|</span><span class="token function">grep</span> <span class="token string">&quot;A temporary password&quot;</span><span class="token operator">|</span><span class="token function">awk</span> -F<span class="token string">&#39;root@localhost:&#39;</span> <span class="token string">&#39;{print $2}&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>更改密码</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">alter</span> <span class="token keyword">user</span> root<span class="token variable">@localhost</span> identified <span class="token keyword">by</span> <span class="token string">&quot;Hello@2023&quot;</span><span class="token punctuation">;</span>
flush <span class="token keyword">privileges</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="配置主从数据库" tabindex="-1"><a class="header-anchor" href="#配置主从数据库"><span>配置主从数据库</span></a></h3><ul><li>主节点</li></ul><div class="language-conf line-numbers-mode" data-ext="conf" data-title="conf"><pre class="language-conf"><code>[mysqld]
server-id=1
log-bin=mysql-bin
binlog_expire_logs_seconds=2592000
binlog_format=mixed
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>从节点</li></ul><div class="language-conf line-numbers-mode" data-ext="conf" data-title="conf"><pre class="language-conf"><code>[mysqld]
server-id=2
log-bin=mysql-bin
binlog_expire_logs_seconds=2592000
binlog_format=mixed
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>参数说明</li></ul><div class="language-conf line-numbers-mode" data-ext="conf" data-title="conf"><pre class="language-conf"><code># 设置 server-id,唯一值，标识主机，必须与从库不一致
server-id=2

# 开启二进制日志，主库必须开启
log-bin=mysql-bin

# 自动删除 2592000 秒（30 天）前的日志
# 8.0 以前的版本中这个配置为 expire_logs_days，单位为天
binlog_expire_logs_seconds=2592000

# binlog 记录的模式
# statement 模式不会记录每一条更改语句，节约资源但主从数据可能不一致
# row 模式记录每一条更改的语句，日志量非常大
# mixed 模式是前两者优点的综合，但日志结构较为复杂
binlog_format=mixed
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>重启数据库 <blockquote><p>主从节点</p></blockquote></li></ul><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>systemctl restart mysqld
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="传输基础数据" tabindex="-1"><a class="header-anchor" href="#传输基础数据"><span>传输基础数据</span></a></h3><ul><li>写入测试数据 <blockquote><p>主节点</p></blockquote></li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> abelitdb <span class="token keyword">CHARSET</span> utf8mb4<span class="token punctuation">;</span>
<span class="token keyword">USE</span> abelitdb<span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> abelitinfo <span class="token punctuation">(</span>
    id <span class="token keyword">INT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">COMMENT</span> <span class="token string">&quot;主键&quot;</span><span class="token punctuation">,</span>
    name <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&quot;姓名&quot;</span><span class="token punctuation">,</span>
    <span class="token keyword">INDEX</span> idx_name<span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token keyword">COMMENT</span> <span class="token string">&quot;普通索引&quot;</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token keyword">innodb</span> <span class="token keyword">CHARSET</span> utf8mb4 <span class="token keyword">COLLATE</span> utf8mb4_general_ci<span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> abelitinfo<span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">&quot;Jack&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&quot;Tom&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&quot;Mary&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> abelitinfo<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>导出数据 <blockquote><p>主节点</p></blockquote></li></ul><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>mysqldump <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-p</span> --skip-lock-tables --single-transaction --flush-logs --hex-blob --master-data<span class="token operator">=</span><span class="token number">2</span> --all-databases <span class="token operator">&gt;</span> alldatabases.sql
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="hint-container tip"><p class="hint-container-title">参数说明</p><p>--skip-lock-tables #不锁表</p><p>--single-transaction #设定事务级别为可重复读</p><p>--flush-logs #开启一个新的 binlog 文件</p><p>--hex-blob #以 16 进制导出 blob 数据</p><p>--master-data=2 #导出数据库时将 binlog 信息也一并导出，2 表示注释 binlog 信息</p></div><ul><li>传输数据到从库 <blockquote><p>主节点</p></blockquote></li></ul><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">scp</span> alldatabases.sql root@10.10.12.214:/root/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>在从库上还原数据 <blockquote><p>从节点</p></blockquote></li></ul><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>mysql <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-p</span> <span class="token operator">&lt;</span> alldatabases.sql
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="创建复制用户" tabindex="-1"><a class="header-anchor" href="#创建复制用户"><span>创建复制用户</span></a></h3><ul><li>主节点</li></ul><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>create user <span class="token string">&#39;repl&#39;</span>@<span class="token string">&#39;%&#39;</span> identified by <span class="token string">&#39;Hello@2022&#39;</span><span class="token punctuation">;</span>
grant replication slave,replication client on *.* to <span class="token string">&#39;repl&#39;</span>@<span class="token string">&#39;%&#39;</span><span class="token punctuation">;</span>
flush privileges<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="查询-binlog-信息" tabindex="-1"><a class="header-anchor" href="#查询-binlog-信息"><span>查询 binlog 信息</span></a></h3><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">cat</span> fulldb.sql <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">&quot;CHANGE MASTER TO MASTER_LOG_FILE&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="hint-container tip"><p class="hint-container-title">查询结果：</p><p>-- CHANGE MASTER TO MASTER_LOG_FILE=&#39;mysql.000002&#39;, MASTER_LOG_POS=157;</p></div><h3 id="设置从库" tabindex="-1"><a class="header-anchor" href="#设置从库"><span>设置从库</span></a></h3><ul><li>配置从库连接主库信息</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code>change master <span class="token keyword">to</span>
    master_host<span class="token operator">=</span><span class="token string">&#39;10.10.12.213&#39;</span><span class="token punctuation">,</span>
    master_port<span class="token operator">=</span><span class="token number">3306</span><span class="token punctuation">,</span>
    master_user<span class="token operator">=</span><span class="token string">&#39;repl&#39;</span><span class="token punctuation">,</span>
    master_password<span class="token operator">=</span><span class="token string">&#39;Hello@2022&#39;</span><span class="token punctuation">,</span>
    master_log_file<span class="token operator">=</span><span class="token string">&#39;mysql-bin.000002&#39;</span><span class="token punctuation">,</span>
    master_log_pos<span class="token operator">=</span><span class="token number">157</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="hint-container warning"><p class="hint-container-title">注意事项：</p><p>当 Slave_IO_Running 和 Slave_SQL_Running 都为 Yes 的时候，表示主从同步正常。</p></div><ul><li>开启从库</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">start</span> slave<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="查看主从状态" tabindex="-1"><a class="header-anchor" href="#查看主从状态"><span>查看主从状态</span></a></h3><ul><li>检查从库状态</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">show</span> slave <span class="token keyword">status</span>\\G
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="hint-container warning"><p class="hint-container-title">注意事项：</p><p>当 Slave_IO_Running 和 Slave_SQL_Running 都为 Yes 的时候，表示主从同步正常。</p></div><ul><li>测试</li></ul><p>主库写入数据</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">use</span> abelitdb<span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> abelitinfo<span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">&quot;abelit&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> abelitinfo<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>从库查看数据是否同步</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">use</span> abelitdb<span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> abelitinfo<span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">&quot;abelit&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> abelitinfo<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,52),i=[l];function o(d,p){return n(),a("div",null,i)}const u=s(t,[["render",o],["__file","mysql-master-slave-with-pos.html.vue"]]),v=JSON.parse('{"path":"/guide/database/mysql/ha/deployment/mysql-master-slave-with-pos.html","title":"MySQL主从复制（基于传统Binlog复制）","lang":"zh-CN","frontmatter":{"title":"MySQL主从复制（基于传统Binlog复制）","description":"主从同步（Binlog+Pos+异步模式） 主机信息 安装数据库 安装 主、从 重启数据库 主从节点 获取初始化密码 更改密码 配置主从数据库 主节点 从节点 参数说明 重启数据库 主从节点 传输基础数据 写入测试数据 主节点 导出数据 主节点 参数说明 --skip-lock-tables #不锁表 --single-transaction #设定事...","head":[["meta",{"property":"og:url","content":"https://github.com/abelit/abelit-datapeacock.git/guide/database/mysql/ha/deployment/mysql-master-slave-with-pos.html"}],["meta",{"property":"og:site_name","content":"数之雀"}],["meta",{"property":"og:title","content":"MySQL主从复制（基于传统Binlog复制）"}],["meta",{"property":"og:description","content":"主从同步（Binlog+Pos+异步模式） 主机信息 安装数据库 安装 主、从 重启数据库 主从节点 获取初始化密码 更改密码 配置主从数据库 主节点 从节点 参数说明 重启数据库 主从节点 传输基础数据 写入测试数据 主节点 导出数据 主节点 参数说明 --skip-lock-tables #不锁表 --single-transaction #设定事..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-05-11T14:06:18.000Z"}],["meta",{"property":"article:author","content":"Abelit"}],["meta",{"property":"article:modified_time","content":"2024-05-11T14:06:18.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"MySQL主从复制（基于传统Binlog复制）\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2024-05-11T14:06:18.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Abelit\\",\\"url\\":\\"https://github.com/abelit\\"}]}"]]},"headers":[{"level":2,"title":"主从同步（Binlog+Pos+异步模式）","slug":"主从同步-binlog-pos-异步模式","link":"#主从同步-binlog-pos-异步模式","children":[{"level":3,"title":"主机信息","slug":"主机信息","link":"#主机信息","children":[]},{"level":3,"title":"安装数据库","slug":"安装数据库","link":"#安装数据库","children":[]},{"level":3,"title":"配置主从数据库","slug":"配置主从数据库","link":"#配置主从数据库","children":[]},{"level":3,"title":"传输基础数据","slug":"传输基础数据","link":"#传输基础数据","children":[]},{"level":3,"title":"创建复制用户","slug":"创建复制用户","link":"#创建复制用户","children":[]},{"level":3,"title":"查询 binlog 信息","slug":"查询-binlog-信息","link":"#查询-binlog-信息","children":[]},{"level":3,"title":"设置从库","slug":"设置从库","link":"#设置从库","children":[]},{"level":3,"title":"查看主从状态","slug":"查看主从状态","link":"#查看主从状态","children":[]}]}],"git":{"createdTime":1715436378000,"updatedTime":1715436378000,"contributors":[{"name":"ableit","email":"ychenid@live.com","commits":1}]},"readingTime":{"minutes":2.44,"words":733},"filePathRelative":"guide/database/mysql/ha/deployment/mysql-master-slave-with-pos.md","localizedDate":"2024年5月11日","autoDesc":true,"excerpt":"<h2>主从同步（Binlog+Pos+异步模式）</h2>\\n<h3>主机信息</h3>\\n<table>\\n<thead>\\n<tr>\\n<th>编号</th>\\n<th>IP 地址</th>\\n<th>角色</th>\\n<th>操作系统</th>\\n<th>内核版本</th>\\n<th>数据库版本</th>\\n</tr>\\n</thead>\\n<tbody>\\n<tr>\\n<td>1</td>\\n<td>10.10.12.213</td>\\n<td>主</td>\\n<td>CentOS 7.9</td>\\n<td>3.10.0-1160.el7.x86_64</td>\\n<td>MySQL 8.0</td>\\n</tr>\\n<tr>\\n<td>2</td>\\n<td>10.10.12.214</td>\\n<td>从</td>\\n<td>CentOS 7.9</td>\\n<td>3.10.0-1160.el7.x86_64</td>\\n<td>MySQL 8.0</td>\\n</tr>\\n</tbody>\\n</table>"}');export{u as comp,v as data};
