import{_ as n}from"./plugin-vue_export-helper-DlAUqK2U.js";import{o as s,c as a,f as p}from"./app-DR5J2daJ.js";const t={},e=p(`<div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token comment">-- how much history do we have:</span>
<span class="token keyword">select</span> <span class="token function">min</span><span class="token punctuation">(</span>sample_time<span class="token punctuation">)</span> <span class="token keyword">from</span> V$ACTIVE_SESSION_HISTORY

<span class="token comment">-- top events</span>
<span class="token keyword">select</span> event<span class="token punctuation">,</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> DBA_HIST_ACTIVE_SESS_HISTORY <span class="token keyword">where</span> sample_time<span class="token operator">&gt;</span> sysdate<span class="token operator">-</span><span class="token number">1</span><span class="token operator">/</span><span class="token number">24</span> 
<span class="token operator">and</span> user_id<span class="token operator">&gt;</span><span class="token number">0</span>
<span class="token keyword">group</span> <span class="token keyword">by</span> event
<span class="token keyword">order</span> <span class="token keyword">by</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">desc</span><span class="token punctuation">;</span>


<span class="token comment">-- top sql</span>
<span class="token keyword">select</span> sql_id<span class="token punctuation">,</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> DBA_HIST_ACTIVE_SESS_HISTORY <span class="token keyword">where</span> sample_time<span class="token operator">&gt;</span> sysdate<span class="token operator">-</span><span class="token number">1</span><span class="token operator">/</span><span class="token number">24</span> 
<span class="token operator">and</span> user_id<span class="token operator">&gt;</span><span class="token number">0</span>
<span class="token keyword">group</span> <span class="token keyword">by</span> sql_id
<span class="token keyword">order</span> <span class="token keyword">by</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">desc</span><span class="token punctuation">;</span>


<span class="token comment">-- see specific samples</span>
<span class="token keyword">select</span> sample_time<span class="token punctuation">,</span>user_id<span class="token punctuation">,</span>sql_id<span class="token punctuation">,</span>event <span class="token keyword">from</span> DBA_HIST_ACTIVE_SESS_HISTORY
<span class="token keyword">where</span> <span class="token number">1</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token comment">--and sample_time&gt; to_date(&#39;03-MAR-11 15:30&#39;,&#39;dd-mon-yy hh24:mi&#39;)</span>
<span class="token operator">and</span> sample_time<span class="token operator">&gt;</span> sysdate<span class="token operator">-</span><span class="token number">1</span><span class="token operator">/</span><span class="token number">24</span>
<span class="token comment">--and user_id&gt;0</span>
<span class="token comment">--and session_id=371</span>
<span class="token keyword">order</span> <span class="token keyword">by</span> sample_time<span class="token punctuation">;</span>

<span class="token comment">-- look for hot buffers</span>
<span class="token keyword">select</span> p1<span class="token punctuation">,</span>p2<span class="token punctuation">,</span>p3<span class="token punctuation">,</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> DBA_HIST_ACTIVE_SESS_HISTORY
<span class="token keyword">where</span> sample_time<span class="token operator">&gt;</span> to_date<span class="token punctuation">(</span><span class="token string">&#39;03-MAR-11 15:30&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;dd-mon-yy hh24:mi&#39;</span><span class="token punctuation">)</span>
<span class="token operator">and</span>  sample_time<span class="token operator">&lt;</span> to_date<span class="token punctuation">(</span><span class="token string">&#39;03-MAR-11 16:30&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;dd-mon-yy hh24:mi&#39;</span><span class="token punctuation">)</span>
<span class="token operator">and</span> user_id<span class="token operator">&gt;</span><span class="token number">0</span>
<span class="token operator">and</span> event<span class="token operator">=</span><span class="token string">&#39;buffer busy waits&#39;</span>
<span class="token keyword">group</span> <span class="token keyword">by</span> p1<span class="token punctuation">,</span>p2<span class="token punctuation">,</span>p3 
<span class="token keyword">order</span> <span class="token keyword">by</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span>



           <span class="token keyword">SELECT</span> SEGMENT_NAME<span class="token punctuation">,</span> SEGMENT_TYPE <span class="token keyword">FROM</span> DBA_EXTENTS            
                <span class="token keyword">WHERE</span> FILE_ID <span class="token operator">=</span> <span class="token number">1</span>  <span class="token operator">AND</span> <span class="token number">231928</span> <span class="token operator">BETWEEN</span> BLOCK_ID <span class="token operator">AND</span>                  
                      BLOCK_ID <span class="token operator">+</span> BLOCKS <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>  
					  
					  
					  

<span class="token comment">-- top SQL waiting for a specific events</span>
<span class="token keyword">select</span> sql_id<span class="token punctuation">,</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> DBA_HIST_ACTIVE_SESS_HISTORY
<span class="token keyword">where</span> sample_time<span class="token operator">&gt;</span> sysdate<span class="token operator">-</span><span class="token number">1</span><span class="token operator">/</span><span class="token number">24</span>
<span class="token operator">and</span> user_id<span class="token operator">&gt;</span><span class="token number">0</span>
<span class="token operator">and</span> event  <span class="token operator">is</span> <span class="token boolean">null</span>
<span class="token keyword">group</span> <span class="token keyword">by</span> sql_id 
<span class="token keyword">order</span> <span class="token keyword">by</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span>

<span class="token comment">-- top programs waiting for a specific events</span>
<span class="token keyword">select</span> program<span class="token punctuation">,</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> DBA_HIST_ACTIVE_SESS_HISTORY
<span class="token keyword">where</span> sample_time<span class="token operator">&gt;</span> to_date<span class="token punctuation">(</span><span class="token string">&#39;03-MAR-11 15:30&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;dd-mon-yy hh24:mi&#39;</span><span class="token punctuation">)</span>
<span class="token operator">and</span>  sample_time<span class="token operator">&lt;</span> to_date<span class="token punctuation">(</span><span class="token string">&#39;03-MAR-11 16:30&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;dd-mon-yy hh24:mi&#39;</span><span class="token punctuation">)</span>
<span class="token operator">and</span> user_id<span class="token operator">&gt;</span><span class="token number">0</span>
<span class="token operator">and</span> event<span class="token operator">=</span><span class="token string">&#39;buffer busy waits&#39;</span>
<span class="token keyword">group</span> <span class="token keyword">by</span> program
<span class="token keyword">order</span> <span class="token keyword">by</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span>

<span class="token comment">-- top users waiting for a specific events</span>
<span class="token keyword">select</span> user_id<span class="token punctuation">,</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> DBA_HIST_ACTIVE_SESS_HISTORY
<span class="token keyword">where</span> sample_time<span class="token operator">&gt;</span> to_date<span class="token punctuation">(</span><span class="token string">&#39;03-MAR-11 15:30&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;dd-mon-yy hh24:mi&#39;</span><span class="token punctuation">)</span>
<span class="token operator">and</span>  sample_time<span class="token operator">&lt;</span> to_date<span class="token punctuation">(</span><span class="token string">&#39;03-MAR-11 16:30&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;dd-mon-yy hh24:mi&#39;</span><span class="token punctuation">)</span>
<span class="token operator">and</span> user_id<span class="token operator">&gt;</span><span class="token number">0</span>
<span class="token operator">and</span> event<span class="token operator">=</span><span class="token string">&#39;buffer busy waits&#39;</span>
<span class="token keyword">group</span> <span class="token keyword">by</span> user_id
<span class="token keyword">order</span> <span class="token keyword">by</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span>  <span class="token number">2</span>    <span class="token number">3</span>    <span class="token number">4</span>    <span class="token number">5</span>    <span class="token number">6</span>    <span class="token number">7</span>  <span class="token punctuation">;</span>

<span class="token comment">-- Everyone waiting for specific event</span>
<span class="token keyword">select</span> sample_time<span class="token punctuation">,</span>user_id<span class="token punctuation">,</span>sql_id<span class="token punctuation">,</span>event<span class="token punctuation">,</span>p1<span class="token punctuation">,</span>blocking_session <span class="token keyword">from</span> V$ACTIVE_SESSION_HISTORY
<span class="token keyword">where</span> event <span class="token operator">like</span> <span class="token string">&#39;library%&#39;</span>

<span class="token comment">-- Who is waiting for specific event the most:</span>
<span class="token keyword">select</span> SESSION_ID<span class="token punctuation">,</span>user_id<span class="token punctuation">,</span>sql_id<span class="token punctuation">,</span><span class="token function">round</span><span class="token punctuation">(</span>sample_time<span class="token punctuation">,</span><span class="token string">&#39;hh&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> V$ACTIVE_SESSION_HISTORY
<span class="token keyword">where</span> event <span class="token operator">like</span> <span class="token string">&#39;log file sync&#39;</span>
<span class="token keyword">group</span> <span class="token keyword">by</span>  SESSION_ID<span class="token punctuation">,</span>user_id<span class="token punctuation">,</span>sql_id<span class="token punctuation">,</span><span class="token function">round</span><span class="token punctuation">(</span>sample_time<span class="token punctuation">,</span><span class="token string">&#39;hh&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">order</span> <span class="token keyword">by</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">desc</span>





<span class="token keyword">select</span> event<span class="token punctuation">,</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> DBA_HIST_ACTIVE_SESS_HISTORY
<span class="token keyword">where</span> sample_time<span class="token operator">&gt;</span> to_date<span class="token punctuation">(</span><span class="token string">&#39;03-MAR-11 15:30&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;dd-mon-yy hh24:mi&#39;</span><span class="token punctuation">)</span>
<span class="token operator">and</span>  sample_time<span class="token operator">&lt;</span> to_date<span class="token punctuation">(</span><span class="token string">&#39;03-MAR-11 16:00&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;dd-mon-yy hh24:mi&#39;</span><span class="token punctuation">)</span>
<span class="token operator">and</span> user_id<span class="token operator">&gt;</span><span class="token number">0</span>
<span class="token keyword">group</span> <span class="token keyword">by</span> event
<span class="token keyword">order</span> <span class="token keyword">by</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">desc</span>


<span class="token keyword">select</span> to_char<span class="token punctuation">(</span>trunc<span class="token punctuation">(</span>sample_time<span class="token punctuation">,</span> <span class="token string">&#39;hh24&#39;</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">round</span><span class="token punctuation">(</span><span class="token punctuation">(</span>cast<span class="token punctuation">(</span>sample_time <span class="token keyword">as</span> <span class="token keyword">date</span><span class="token punctuation">)</span><span class="token operator">-</span> trunc<span class="token punctuation">(</span>cast<span class="token punctuation">(</span>sample_time <span class="token keyword">as</span> <span class="token keyword">date</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&#39;hh24&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">60</span><span class="token operator">*</span><span class="token number">24</span><span class="token operator">/</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">5</span><span class="token operator">/</span><span class="token number">60</span><span class="token operator">/</span><span class="token number">24</span><span class="token punctuation">,</span> <span class="token string">&#39;dd/mm/yyyy hh24:mi&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> DBA_HIST_ACTIVE_SESS_HISTORY
<span class="token keyword">where</span> sample_time<span class="token operator">&gt;</span> to_date<span class="token punctuation">(</span><span class="token string">&#39;03-MAR-11 15:30&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;dd-mon-yy hh24:mi&#39;</span><span class="token punctuation">)</span>
<span class="token operator">and</span>  sample_time<span class="token operator">&lt;</span> to_date<span class="token punctuation">(</span><span class="token string">&#39;03-MAR-11 16:30&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;dd-mon-yy hh24:mi&#39;</span><span class="token punctuation">)</span>
<span class="token operator">and</span> user_id<span class="token operator">=</span><span class="token number">209</span>
<span class="token operator">and</span> event<span class="token operator">=</span><span class="token string">&#39;buffer busy waits&#39;</span>
<span class="token keyword">group</span> <span class="token keyword">by</span> to_char<span class="token punctuation">(</span>trunc<span class="token punctuation">(</span>sample_time<span class="token punctuation">,</span> <span class="token string">&#39;hh24&#39;</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">round</span><span class="token punctuation">(</span><span class="token punctuation">(</span>cast<span class="token punctuation">(</span>sample_time <span class="token keyword">as</span> <span class="token keyword">date</span><span class="token punctuation">)</span><span class="token operator">-</span> trunc<span class="token punctuation">(</span>cast<span class="token punctuation">(</span>sample_time <span class="token keyword">as</span> <span class="token keyword">date</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&#39;hh24&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">60</span><span class="token operator">*</span><span class="token number">24</span><span class="token operator">/</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">5</span><span class="token operator">/</span><span class="token number">60</span><span class="token operator">/</span><span class="token number">24</span><span class="token punctuation">,</span> <span class="token string">&#39;dd/mm/yyyy hh24:mi&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">order</span> <span class="token keyword">by</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span>


<span class="token keyword">select</span> sql_id<span class="token punctuation">,</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> V$ACTIVE_SESSION_HISTORY
<span class="token keyword">where</span> sample_time<span class="token operator">&gt;</span> to_date<span class="token punctuation">(</span><span class="token string">&#39;08-FEB-10 13:00&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;dd-mon-yy hh24:mi&#39;</span><span class="token punctuation">)</span>
<span class="token operator">and</span>  sample_time<span class="token operator">&lt;</span> to_date<span class="token punctuation">(</span><span class="token string">&#39;08-FEB-10 16:00&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;dd-mon-yy hh24:mi&#39;</span><span class="token punctuation">)</span>
<span class="token operator">and</span> user_id<span class="token operator">&gt;</span><span class="token number">0</span>
<span class="token keyword">group</span> <span class="token keyword">by</span> sql_id
<span class="token keyword">order</span> <span class="token keyword">by</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">desc</span>

<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> dba_views <span class="token keyword">where</span> view_name <span class="token operator">like</span> <span class="token string">&#39;DBA_HIST%&#39;</span>

<span class="token keyword">select</span> sh<span class="token punctuation">.</span>sample_time<span class="token punctuation">,</span>sh<span class="token punctuation">.</span>SESSION_ID<span class="token punctuation">,</span>user_id<span class="token punctuation">,</span>sh<span class="token punctuation">.</span>sql_id<span class="token punctuation">,</span>event<span class="token punctuation">,</span>p1<span class="token punctuation">,</span>blocking_session<span class="token punctuation">,</span>PROGRAM<span class="token punctuation">,</span>sql_text
<span class="token keyword">from</span> DBA_HIST_ACTIVE_SESS_HISTORY sh
<span class="token keyword">left</span> <span class="token keyword">outer</span> <span class="token keyword">join</span>  DBA_HIST_SQLTEXT  sq <span class="token keyword">on</span> sq<span class="token punctuation">.</span>sql_id<span class="token operator">=</span>sh<span class="token punctuation">.</span>sql_id 
<span class="token keyword">where</span> <span class="token number">1</span><span class="token operator">=</span><span class="token number">1</span> 
<span class="token operator">and</span> sample_time<span class="token operator">&gt;</span> to_date<span class="token punctuation">(</span><span class="token string">&#39;08-FEB-10 00:00&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;dd-mon-yy hh24:mi&#39;</span><span class="token punctuation">)</span>
<span class="token operator">and</span>  sample_time<span class="token operator">&lt;</span> to_date<span class="token punctuation">(</span><span class="token string">&#39;08-FEB-10 23:00&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;dd-mon-yy hh24:mi&#39;</span><span class="token punctuation">)</span>
<span class="token operator">and</span> user_id<span class="token operator">=</span><span class="token number">61</span>
<span class="token comment">--and sql_id=&#39;809u1jtt54kfy&#39;</span>
<span class="token keyword">order</span> <span class="token keyword">by</span> sample_time


<span class="token keyword">select</span> trunc<span class="token punctuation">(</span>sample_time<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token function">sum</span><span class="token punctuation">(</span><span class="token keyword">case</span> <span class="token keyword">when</span> INSTANCE_NUMBER<span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">then</span> <span class="token number">1</span> <span class="token keyword">else</span> <span class="token number">0</span> <span class="token keyword">end</span><span class="token punctuation">)</span> inst1<span class="token punctuation">,</span>
<span class="token function">sum</span><span class="token punctuation">(</span><span class="token keyword">case</span> <span class="token keyword">when</span> INSTANCE_NUMBER<span class="token operator">=</span><span class="token number">2</span> <span class="token keyword">then</span> <span class="token number">1</span> <span class="token keyword">else</span> <span class="token number">0</span> <span class="token keyword">end</span><span class="token punctuation">)</span> inst2
<span class="token keyword">from</span> DBA_HIST_ACTIVE_SESS_HISTORY sh
<span class="token keyword">where</span> <span class="token number">1</span><span class="token operator">=</span><span class="token number">1</span> 
<span class="token operator">and</span> user_id<span class="token operator">=</span><span class="token number">61</span>
<span class="token keyword">group</span> <span class="token keyword">by</span> trunc<span class="token punctuation">(</span>sample_time<span class="token punctuation">)</span>
<span class="token keyword">order</span> <span class="token keyword">by</span> trunc<span class="token punctuation">(</span>sample_time<span class="token punctuation">)</span>



<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> DBA_HIST_SQLTEXT <span class="token keyword">where</span> sql_id<span class="token operator">=</span><span class="token string">&#39;d15cdr0zt3vtp&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">where</span> dbms_lob<span class="token punctuation">.</span>instr<span class="token punctuation">(</span>sql_text<span class="token punctuation">,</span> <span class="token string">&#39;GLOBAL&#39;</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span>

<span class="token keyword">desc</span> DBA_HIST_ACTIVE_SESS_HISTORY 

<span class="token keyword">EXEC</span> DBMS_MONITOR<span class="token punctuation">.</span>session_trace_enable<span class="token punctuation">(</span>session_id <span class="token operator">=</span><span class="token operator">&gt;</span><span class="token number">1234</span><span class="token punctuation">,</span> serial_num<span class="token operator">=</span><span class="token operator">&gt;</span><span class="token number">1234</span><span class="token punctuation">,</span> waits<span class="token operator">=</span><span class="token operator">&gt;</span><span class="token boolean">TRUE</span><span class="token punctuation">,</span> binds<span class="token operator">=</span><span class="token operator">&gt;</span><span class="token boolean">FALSE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">select</span> sample_time<span class="token punctuation">,</span>user_id<span class="token punctuation">,</span>sql_id<span class="token punctuation">,</span>event<span class="token punctuation">,</span>p1<span class="token punctuation">,</span>blocking_session <span class="token keyword">from</span> V$ACTIVE_SESSION_HISTORY
<span class="token keyword">where</span> event <span class="token operator">like</span> <span class="token string">&#39;library%&#39;</span>

<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> v$active_session_history <span class="token keyword">where</span> session_id<span class="token operator">=</span><span class="token number">306</span>
<span class="token number">6969666696</span>
<span class="token keyword">select</span> SESSION_ID<span class="token punctuation">,</span>user_id<span class="token punctuation">,</span>sql_id<span class="token punctuation">,</span><span class="token function">round</span><span class="token punctuation">(</span>sample_time<span class="token punctuation">,</span><span class="token string">&#39;hh&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> V$ACTIVE_SESSION_HISTORY
<span class="token keyword">where</span> event <span class="token operator">like</span> <span class="token string">&#39;log file sync&#39;</span>
<span class="token keyword">group</span> <span class="token keyword">by</span>  SESSION_ID<span class="token punctuation">,</span>user_id<span class="token punctuation">,</span>sql_id<span class="token punctuation">,</span><span class="token function">round</span><span class="token punctuation">(</span>sample_time<span class="token punctuation">,</span><span class="token string">&#39;hh&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">order</span> <span class="token keyword">by</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">desc</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="lock" tabindex="-1"><a class="header-anchor" href="#lock"><span>lock</span></a></h2><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">WITH</span> ash_query <span class="token keyword">AS</span> <span class="token punctuation">(</span>
    <span class="token keyword">SELECT</span>
        substr<span class="token punctuation">(</span>
            event<span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">2</span>
        <span class="token punctuation">)</span>                       lock_type<span class="token punctuation">,</span>
        program<span class="token punctuation">,</span>
        h<span class="token punctuation">.</span>module<span class="token punctuation">,</span>
        h<span class="token punctuation">.</span><span class="token keyword">action</span><span class="token punctuation">,</span>
        object_name<span class="token punctuation">,</span>
        <span class="token function">SUM</span><span class="token punctuation">(</span>time_waited<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span> time_ms<span class="token punctuation">,</span>
        <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span>                waits<span class="token punctuation">,</span>
        username<span class="token punctuation">,</span>
        sql_text<span class="token punctuation">,</span>
        RANK<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">OVER</span><span class="token punctuation">(</span>
            <span class="token keyword">ORDER</span> <span class="token keyword">BY</span>
                <span class="token function">SUM</span><span class="token punctuation">(</span>time_waited<span class="token punctuation">)</span> <span class="token keyword">DESC</span>
        <span class="token punctuation">)</span>                       <span class="token keyword">AS</span> time_rank<span class="token punctuation">,</span>
        <span class="token function">round</span><span class="token punctuation">(</span>
            <span class="token function">SUM</span><span class="token punctuation">(</span>time_waited<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span> <span class="token operator">/</span> <span class="token function">SUM</span><span class="token punctuation">(</span><span class="token function">SUM</span><span class="token punctuation">(</span>time_waited<span class="token punctuation">)</span><span class="token punctuation">)</span>
                                     <span class="token keyword">OVER</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span>
        <span class="token punctuation">)</span>                       pct_of_time
    <span class="token keyword">FROM</span>
        v$active_session_history h
        <span class="token keyword">JOIN</span> dba_users   u <span class="token keyword">USING</span> <span class="token punctuation">(</span> user_id <span class="token punctuation">)</span>
        <span class="token keyword">LEFT</span> <span class="token keyword">OUTER</span> <span class="token keyword">JOIN</span> dba_objects o <span class="token keyword">ON</span> <span class="token punctuation">(</span> o<span class="token punctuation">.</span>object_id <span class="token operator">=</span> h<span class="token punctuation">.</span>current_obj<span class="token comment"># )</span>
        <span class="token keyword">LEFT</span> <span class="token keyword">OUTER</span> <span class="token keyword">JOIN</span> v$<span class="token keyword">sql</span>       s <span class="token keyword">USING</span> <span class="token punctuation">(</span> sql_id <span class="token punctuation">)</span>
    <span class="token keyword">WHERE</span>
        event <span class="token operator">LIKE</span> <span class="token string">&#39;enq: %&#39;</span>
        <span class="token operator">AND</span> sample_time <span class="token operator">BETWEEN</span> TO_DATE<span class="token punctuation">(</span><span class="token string">&#39;&amp;start_time&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;YYYY-MM-DD HH24:MI:SS&#39;</span><span class="token punctuation">)</span> <span class="token operator">AND</span> TO_DATE<span class="token punctuation">(</span><span class="token string">&#39;&amp;end_time&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;YYYY-MM-DD HH24:MI:SS&#39;</span><span class="token punctuation">)</span>
    <span class="token keyword">GROUP</span> <span class="token keyword">BY</span>
        substr<span class="token punctuation">(</span>
            event<span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">2</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
        program<span class="token punctuation">,</span>
        h<span class="token punctuation">.</span>module<span class="token punctuation">,</span>
        h<span class="token punctuation">.</span><span class="token keyword">action</span><span class="token punctuation">,</span>
        object_name<span class="token punctuation">,</span>
        sql_text<span class="token punctuation">,</span>
        username
<span class="token punctuation">)</span>
<span class="token keyword">SELECT</span>
    lock_type<span class="token punctuation">,</span>
    module<span class="token punctuation">,</span>
    username<span class="token punctuation">,</span>
    object_name<span class="token punctuation">,</span>
    time_ms<span class="token punctuation">,</span>
    pct_of_time<span class="token punctuation">,</span>
    sql_text
<span class="token keyword">FROM</span>
    ash_query
<span class="token keyword">WHERE</span>
    time_rank <span class="token operator">&lt;</span> <span class="token number">11</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span>
    time_rank<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="阻塞" tabindex="-1"><a class="header-anchor" href="#阻塞"><span>阻塞</span></a></h2><div class="language-sl line-numbers-mode" data-ext="sl" data-title="sl"><pre class="language-sl"><code>SELECT DISTINCT
    a.sid              &quot;waiting sid&quot;,
    d.sql_text         &quot;waiting SQL&quot;,
    a.row_wait_obj#    &quot;locked object&quot;,
    a.blocking_session &quot;blocking sid&quot;,
    c.sql_text         &quot;SQL from blocking session&quot;
FROM
    v$session                a,
    v$active_session_history b,
    v$sql                    c,
    v$sql                    d
WHERE
    a.sql_id = d.sql_id
    AND a.blocking_session = b.session_id
    AND c.sql_id = b.sql_id
    AND b.current_obj# = a.row_wait_obj#
    AND b.current_file# = a.row_wait_file#
    AND b.sample_time BETWEEN TO_DATE(&#39;&amp;start_time&#39;, &#39;YYYY-MM-DD HH24:MI:SS&#39;) AND TO_DATE(&#39;&amp;end_time&#39;, &#39;YYYY-MM-DD HH24:MI:SS&#39;)
    AND b.current_block# = a.row_wait_block#;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,5),o=[e];function c(l,i){return s(),a("div",null,o)}const u=n(t,[["render",c],["__file","ash.html.vue"]]),d=JSON.parse(`{"path":"/guide/database/oracle/ash.html","title":"ASH","lang":"zh-CN","frontmatter":{"title":"ASH","description":"lock 阻塞","head":[["meta",{"property":"og:url","content":"https://github.com/abelit/abelit-datapeacock.git/guide/database/oracle/ash.html"}],["meta",{"property":"og:site_name","content":"数之雀"}],["meta",{"property":"og:title","content":"ASH"}],["meta",{"property":"og:description","content":"lock 阻塞"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-05-11T14:06:18.000Z"}],["meta",{"property":"article:author","content":"Abelit"}],["meta",{"property":"article:modified_time","content":"2024-05-11T14:06:18.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"ASH\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2024-05-11T14:06:18.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Abelit\\",\\"url\\":\\"https://github.com/abelit\\"}]}"]]},"headers":[{"level":2,"title":"lock","slug":"lock","link":"#lock","children":[]},{"level":2,"title":"阻塞","slug":"阻塞","link":"#阻塞","children":[]}],"git":{"createdTime":1715436378000,"updatedTime":1715436378000,"contributors":[{"name":"ableit","email":"ychenid@live.com","commits":1}]},"readingTime":{"minutes":3.02,"words":906},"filePathRelative":"guide/database/oracle/ash.md","localizedDate":"2024年5月11日","autoDesc":true,"excerpt":"<div class=\\"language-sql\\" data-ext=\\"sql\\" data-title=\\"sql\\"><pre class=\\"language-sql\\"><code><span class=\\"token comment\\">-- how much history do we have:</span>\\n<span class=\\"token keyword\\">select</span> <span class=\\"token function\\">min</span><span class=\\"token punctuation\\">(</span>sample_time<span class=\\"token punctuation\\">)</span> <span class=\\"token keyword\\">from</span> V$ACTIVE_SESSION_HISTORY\\n\\n<span class=\\"token comment\\">-- top events</span>\\n<span class=\\"token keyword\\">select</span> event<span class=\\"token punctuation\\">,</span><span class=\\"token function\\">count</span><span class=\\"token punctuation\\">(</span><span class=\\"token operator\\">*</span><span class=\\"token punctuation\\">)</span> <span class=\\"token keyword\\">from</span> DBA_HIST_ACTIVE_SESS_HISTORY <span class=\\"token keyword\\">where</span> sample_time<span class=\\"token operator\\">&gt;</span> sysdate<span class=\\"token operator\\">-</span><span class=\\"token number\\">1</span><span class=\\"token operator\\">/</span><span class=\\"token number\\">24</span> \\n<span class=\\"token operator\\">and</span> user_id<span class=\\"token operator\\">&gt;</span><span class=\\"token number\\">0</span>\\n<span class=\\"token keyword\\">group</span> <span class=\\"token keyword\\">by</span> event\\n<span class=\\"token keyword\\">order</span> <span class=\\"token keyword\\">by</span> <span class=\\"token function\\">count</span><span class=\\"token punctuation\\">(</span><span class=\\"token operator\\">*</span><span class=\\"token punctuation\\">)</span> <span class=\\"token keyword\\">desc</span><span class=\\"token punctuation\\">;</span>\\n\\n\\n<span class=\\"token comment\\">-- top sql</span>\\n<span class=\\"token keyword\\">select</span> sql_id<span class=\\"token punctuation\\">,</span><span class=\\"token function\\">count</span><span class=\\"token punctuation\\">(</span><span class=\\"token operator\\">*</span><span class=\\"token punctuation\\">)</span> <span class=\\"token keyword\\">from</span> DBA_HIST_ACTIVE_SESS_HISTORY <span class=\\"token keyword\\">where</span> sample_time<span class=\\"token operator\\">&gt;</span> sysdate<span class=\\"token operator\\">-</span><span class=\\"token number\\">1</span><span class=\\"token operator\\">/</span><span class=\\"token number\\">24</span> \\n<span class=\\"token operator\\">and</span> user_id<span class=\\"token operator\\">&gt;</span><span class=\\"token number\\">0</span>\\n<span class=\\"token keyword\\">group</span> <span class=\\"token keyword\\">by</span> sql_id\\n<span class=\\"token keyword\\">order</span> <span class=\\"token keyword\\">by</span> <span class=\\"token function\\">count</span><span class=\\"token punctuation\\">(</span><span class=\\"token operator\\">*</span><span class=\\"token punctuation\\">)</span> <span class=\\"token keyword\\">desc</span><span class=\\"token punctuation\\">;</span>\\n\\n\\n<span class=\\"token comment\\">-- see specific samples</span>\\n<span class=\\"token keyword\\">select</span> sample_time<span class=\\"token punctuation\\">,</span>user_id<span class=\\"token punctuation\\">,</span>sql_id<span class=\\"token punctuation\\">,</span>event <span class=\\"token keyword\\">from</span> DBA_HIST_ACTIVE_SESS_HISTORY\\n<span class=\\"token keyword\\">where</span> <span class=\\"token number\\">1</span><span class=\\"token operator\\">=</span><span class=\\"token number\\">1</span>\\n<span class=\\"token comment\\">--and sample_time&gt; to_date('03-MAR-11 15:30','dd-mon-yy hh24:mi')</span>\\n<span class=\\"token operator\\">and</span> sample_time<span class=\\"token operator\\">&gt;</span> sysdate<span class=\\"token operator\\">-</span><span class=\\"token number\\">1</span><span class=\\"token operator\\">/</span><span class=\\"token number\\">24</span>\\n<span class=\\"token comment\\">--and user_id&gt;0</span>\\n<span class=\\"token comment\\">--and session_id=371</span>\\n<span class=\\"token keyword\\">order</span> <span class=\\"token keyword\\">by</span> sample_time<span class=\\"token punctuation\\">;</span>\\n\\n<span class=\\"token comment\\">-- look for hot buffers</span>\\n<span class=\\"token keyword\\">select</span> p1<span class=\\"token punctuation\\">,</span>p2<span class=\\"token punctuation\\">,</span>p3<span class=\\"token punctuation\\">,</span><span class=\\"token function\\">count</span><span class=\\"token punctuation\\">(</span><span class=\\"token operator\\">*</span><span class=\\"token punctuation\\">)</span> <span class=\\"token keyword\\">from</span> DBA_HIST_ACTIVE_SESS_HISTORY\\n<span class=\\"token keyword\\">where</span> sample_time<span class=\\"token operator\\">&gt;</span> to_date<span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'03-MAR-11 15:30'</span><span class=\\"token punctuation\\">,</span><span class=\\"token string\\">'dd-mon-yy hh24:mi'</span><span class=\\"token punctuation\\">)</span>\\n<span class=\\"token operator\\">and</span>  sample_time<span class=\\"token operator\\">&lt;</span> to_date<span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'03-MAR-11 16:30'</span><span class=\\"token punctuation\\">,</span><span class=\\"token string\\">'dd-mon-yy hh24:mi'</span><span class=\\"token punctuation\\">)</span>\\n<span class=\\"token operator\\">and</span> user_id<span class=\\"token operator\\">&gt;</span><span class=\\"token number\\">0</span>\\n<span class=\\"token operator\\">and</span> event<span class=\\"token operator\\">=</span><span class=\\"token string\\">'buffer busy waits'</span>\\n<span class=\\"token keyword\\">group</span> <span class=\\"token keyword\\">by</span> p1<span class=\\"token punctuation\\">,</span>p2<span class=\\"token punctuation\\">,</span>p3 \\n<span class=\\"token keyword\\">order</span> <span class=\\"token keyword\\">by</span> <span class=\\"token function\\">count</span><span class=\\"token punctuation\\">(</span><span class=\\"token operator\\">*</span><span class=\\"token punctuation\\">)</span>\\n\\n\\n\\n           <span class=\\"token keyword\\">SELECT</span> SEGMENT_NAME<span class=\\"token punctuation\\">,</span> SEGMENT_TYPE <span class=\\"token keyword\\">FROM</span> DBA_EXTENTS            \\n                <span class=\\"token keyword\\">WHERE</span> FILE_ID <span class=\\"token operator\\">=</span> <span class=\\"token number\\">1</span>  <span class=\\"token operator\\">AND</span> <span class=\\"token number\\">231928</span> <span class=\\"token operator\\">BETWEEN</span> BLOCK_ID <span class=\\"token operator\\">AND</span>                  \\n                      BLOCK_ID <span class=\\"token operator\\">+</span> BLOCKS <span class=\\"token operator\\">-</span> <span class=\\"token number\\">1</span><span class=\\"token punctuation\\">;</span>  \\n\\t\\t\\t\\t\\t  \\n\\t\\t\\t\\t\\t  \\n\\t\\t\\t\\t\\t  \\n\\n<span class=\\"token comment\\">-- top SQL waiting for a specific events</span>\\n<span class=\\"token keyword\\">select</span> sql_id<span class=\\"token punctuation\\">,</span><span class=\\"token function\\">count</span><span class=\\"token punctuation\\">(</span><span class=\\"token operator\\">*</span><span class=\\"token punctuation\\">)</span> <span class=\\"token keyword\\">from</span> DBA_HIST_ACTIVE_SESS_HISTORY\\n<span class=\\"token keyword\\">where</span> sample_time<span class=\\"token operator\\">&gt;</span> sysdate<span class=\\"token operator\\">-</span><span class=\\"token number\\">1</span><span class=\\"token operator\\">/</span><span class=\\"token number\\">24</span>\\n<span class=\\"token operator\\">and</span> user_id<span class=\\"token operator\\">&gt;</span><span class=\\"token number\\">0</span>\\n<span class=\\"token operator\\">and</span> event  <span class=\\"token operator\\">is</span> <span class=\\"token boolean\\">null</span>\\n<span class=\\"token keyword\\">group</span> <span class=\\"token keyword\\">by</span> sql_id \\n<span class=\\"token keyword\\">order</span> <span class=\\"token keyword\\">by</span> <span class=\\"token function\\">count</span><span class=\\"token punctuation\\">(</span><span class=\\"token operator\\">*</span><span class=\\"token punctuation\\">)</span>\\n\\n<span class=\\"token comment\\">-- top programs waiting for a specific events</span>\\n<span class=\\"token keyword\\">select</span> program<span class=\\"token punctuation\\">,</span><span class=\\"token function\\">count</span><span class=\\"token punctuation\\">(</span><span class=\\"token operator\\">*</span><span class=\\"token punctuation\\">)</span> <span class=\\"token keyword\\">from</span> DBA_HIST_ACTIVE_SESS_HISTORY\\n<span class=\\"token keyword\\">where</span> sample_time<span class=\\"token operator\\">&gt;</span> to_date<span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'03-MAR-11 15:30'</span><span class=\\"token punctuation\\">,</span><span class=\\"token string\\">'dd-mon-yy hh24:mi'</span><span class=\\"token punctuation\\">)</span>\\n<span class=\\"token operator\\">and</span>  sample_time<span class=\\"token operator\\">&lt;</span> to_date<span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'03-MAR-11 16:30'</span><span class=\\"token punctuation\\">,</span><span class=\\"token string\\">'dd-mon-yy hh24:mi'</span><span class=\\"token punctuation\\">)</span>\\n<span class=\\"token operator\\">and</span> user_id<span class=\\"token operator\\">&gt;</span><span class=\\"token number\\">0</span>\\n<span class=\\"token operator\\">and</span> event<span class=\\"token operator\\">=</span><span class=\\"token string\\">'buffer busy waits'</span>\\n<span class=\\"token keyword\\">group</span> <span class=\\"token keyword\\">by</span> program\\n<span class=\\"token keyword\\">order</span> <span class=\\"token keyword\\">by</span> <span class=\\"token function\\">count</span><span class=\\"token punctuation\\">(</span><span class=\\"token operator\\">*</span><span class=\\"token punctuation\\">)</span>\\n\\n<span class=\\"token comment\\">-- top users waiting for a specific events</span>\\n<span class=\\"token keyword\\">select</span> user_id<span class=\\"token punctuation\\">,</span><span class=\\"token function\\">count</span><span class=\\"token punctuation\\">(</span><span class=\\"token operator\\">*</span><span class=\\"token punctuation\\">)</span> <span class=\\"token keyword\\">from</span> DBA_HIST_ACTIVE_SESS_HISTORY\\n<span class=\\"token keyword\\">where</span> sample_time<span class=\\"token operator\\">&gt;</span> to_date<span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'03-MAR-11 15:30'</span><span class=\\"token punctuation\\">,</span><span class=\\"token string\\">'dd-mon-yy hh24:mi'</span><span class=\\"token punctuation\\">)</span>\\n<span class=\\"token operator\\">and</span>  sample_time<span class=\\"token operator\\">&lt;</span> to_date<span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'03-MAR-11 16:30'</span><span class=\\"token punctuation\\">,</span><span class=\\"token string\\">'dd-mon-yy hh24:mi'</span><span class=\\"token punctuation\\">)</span>\\n<span class=\\"token operator\\">and</span> user_id<span class=\\"token operator\\">&gt;</span><span class=\\"token number\\">0</span>\\n<span class=\\"token operator\\">and</span> event<span class=\\"token operator\\">=</span><span class=\\"token string\\">'buffer busy waits'</span>\\n<span class=\\"token keyword\\">group</span> <span class=\\"token keyword\\">by</span> user_id\\n<span class=\\"token keyword\\">order</span> <span class=\\"token keyword\\">by</span> <span class=\\"token function\\">count</span><span class=\\"token punctuation\\">(</span><span class=\\"token operator\\">*</span><span class=\\"token punctuation\\">)</span>  <span class=\\"token number\\">2</span>    <span class=\\"token number\\">3</span>    <span class=\\"token number\\">4</span>    <span class=\\"token number\\">5</span>    <span class=\\"token number\\">6</span>    <span class=\\"token number\\">7</span>  <span class=\\"token punctuation\\">;</span>\\n\\n<span class=\\"token comment\\">-- Everyone waiting for specific event</span>\\n<span class=\\"token keyword\\">select</span> sample_time<span class=\\"token punctuation\\">,</span>user_id<span class=\\"token punctuation\\">,</span>sql_id<span class=\\"token punctuation\\">,</span>event<span class=\\"token punctuation\\">,</span>p1<span class=\\"token punctuation\\">,</span>blocking_session <span class=\\"token keyword\\">from</span> V$ACTIVE_SESSION_HISTORY\\n<span class=\\"token keyword\\">where</span> event <span class=\\"token operator\\">like</span> <span class=\\"token string\\">'library%'</span>\\n\\n<span class=\\"token comment\\">-- Who is waiting for specific event the most:</span>\\n<span class=\\"token keyword\\">select</span> SESSION_ID<span class=\\"token punctuation\\">,</span>user_id<span class=\\"token punctuation\\">,</span>sql_id<span class=\\"token punctuation\\">,</span><span class=\\"token function\\">round</span><span class=\\"token punctuation\\">(</span>sample_time<span class=\\"token punctuation\\">,</span><span class=\\"token string\\">'hh'</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">,</span><span class=\\"token function\\">count</span><span class=\\"token punctuation\\">(</span><span class=\\"token operator\\">*</span><span class=\\"token punctuation\\">)</span> <span class=\\"token keyword\\">from</span> V$ACTIVE_SESSION_HISTORY\\n<span class=\\"token keyword\\">where</span> event <span class=\\"token operator\\">like</span> <span class=\\"token string\\">'log file sync'</span>\\n<span class=\\"token keyword\\">group</span> <span class=\\"token keyword\\">by</span>  SESSION_ID<span class=\\"token punctuation\\">,</span>user_id<span class=\\"token punctuation\\">,</span>sql_id<span class=\\"token punctuation\\">,</span><span class=\\"token function\\">round</span><span class=\\"token punctuation\\">(</span>sample_time<span class=\\"token punctuation\\">,</span><span class=\\"token string\\">'hh'</span><span class=\\"token punctuation\\">)</span>\\n<span class=\\"token keyword\\">order</span> <span class=\\"token keyword\\">by</span> <span class=\\"token function\\">count</span><span class=\\"token punctuation\\">(</span><span class=\\"token operator\\">*</span><span class=\\"token punctuation\\">)</span> <span class=\\"token keyword\\">desc</span>\\n\\n\\n\\n\\n\\n<span class=\\"token keyword\\">select</span> event<span class=\\"token punctuation\\">,</span><span class=\\"token function\\">count</span><span class=\\"token punctuation\\">(</span><span class=\\"token operator\\">*</span><span class=\\"token punctuation\\">)</span> <span class=\\"token keyword\\">from</span> DBA_HIST_ACTIVE_SESS_HISTORY\\n<span class=\\"token keyword\\">where</span> sample_time<span class=\\"token operator\\">&gt;</span> to_date<span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'03-MAR-11 15:30'</span><span class=\\"token punctuation\\">,</span><span class=\\"token string\\">'dd-mon-yy hh24:mi'</span><span class=\\"token punctuation\\">)</span>\\n<span class=\\"token operator\\">and</span>  sample_time<span class=\\"token operator\\">&lt;</span> to_date<span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'03-MAR-11 16:00'</span><span class=\\"token punctuation\\">,</span><span class=\\"token string\\">'dd-mon-yy hh24:mi'</span><span class=\\"token punctuation\\">)</span>\\n<span class=\\"token operator\\">and</span> user_id<span class=\\"token operator\\">&gt;</span><span class=\\"token number\\">0</span>\\n<span class=\\"token keyword\\">group</span> <span class=\\"token keyword\\">by</span> event\\n<span class=\\"token keyword\\">order</span> <span class=\\"token keyword\\">by</span> <span class=\\"token function\\">count</span><span class=\\"token punctuation\\">(</span><span class=\\"token operator\\">*</span><span class=\\"token punctuation\\">)</span> <span class=\\"token keyword\\">desc</span>\\n\\n\\n<span class=\\"token keyword\\">select</span> to_char<span class=\\"token punctuation\\">(</span>trunc<span class=\\"token punctuation\\">(</span>sample_time<span class=\\"token punctuation\\">,</span> <span class=\\"token string\\">'hh24'</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">+</span> <span class=\\"token function\\">round</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span>cast<span class=\\"token punctuation\\">(</span>sample_time <span class=\\"token keyword\\">as</span> <span class=\\"token keyword\\">date</span><span class=\\"token punctuation\\">)</span><span class=\\"token operator\\">-</span> trunc<span class=\\"token punctuation\\">(</span>cast<span class=\\"token punctuation\\">(</span>sample_time <span class=\\"token keyword\\">as</span> <span class=\\"token keyword\\">date</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">,</span> <span class=\\"token string\\">'hh24'</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span><span class=\\"token operator\\">*</span><span class=\\"token number\\">60</span><span class=\\"token operator\\">*</span><span class=\\"token number\\">24</span><span class=\\"token operator\\">/</span><span class=\\"token number\\">5</span><span class=\\"token punctuation\\">)</span><span class=\\"token operator\\">*</span><span class=\\"token number\\">5</span><span class=\\"token operator\\">/</span><span class=\\"token number\\">60</span><span class=\\"token operator\\">/</span><span class=\\"token number\\">24</span><span class=\\"token punctuation\\">,</span> <span class=\\"token string\\">'dd/mm/yyyy hh24:mi'</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">,</span><span class=\\"token function\\">count</span><span class=\\"token punctuation\\">(</span><span class=\\"token operator\\">*</span><span class=\\"token punctuation\\">)</span> <span class=\\"token keyword\\">from</span> DBA_HIST_ACTIVE_SESS_HISTORY\\n<span class=\\"token keyword\\">where</span> sample_time<span class=\\"token operator\\">&gt;</span> to_date<span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'03-MAR-11 15:30'</span><span class=\\"token punctuation\\">,</span><span class=\\"token string\\">'dd-mon-yy hh24:mi'</span><span class=\\"token punctuation\\">)</span>\\n<span class=\\"token operator\\">and</span>  sample_time<span class=\\"token operator\\">&lt;</span> to_date<span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'03-MAR-11 16:30'</span><span class=\\"token punctuation\\">,</span><span class=\\"token string\\">'dd-mon-yy hh24:mi'</span><span class=\\"token punctuation\\">)</span>\\n<span class=\\"token operator\\">and</span> user_id<span class=\\"token operator\\">=</span><span class=\\"token number\\">209</span>\\n<span class=\\"token operator\\">and</span> event<span class=\\"token operator\\">=</span><span class=\\"token string\\">'buffer busy waits'</span>\\n<span class=\\"token keyword\\">group</span> <span class=\\"token keyword\\">by</span> to_char<span class=\\"token punctuation\\">(</span>trunc<span class=\\"token punctuation\\">(</span>sample_time<span class=\\"token punctuation\\">,</span> <span class=\\"token string\\">'hh24'</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">+</span> <span class=\\"token function\\">round</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span>cast<span class=\\"token punctuation\\">(</span>sample_time <span class=\\"token keyword\\">as</span> <span class=\\"token keyword\\">date</span><span class=\\"token punctuation\\">)</span><span class=\\"token operator\\">-</span> trunc<span class=\\"token punctuation\\">(</span>cast<span class=\\"token punctuation\\">(</span>sample_time <span class=\\"token keyword\\">as</span> <span class=\\"token keyword\\">date</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">,</span> <span class=\\"token string\\">'hh24'</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span><span class=\\"token operator\\">*</span><span class=\\"token number\\">60</span><span class=\\"token operator\\">*</span><span class=\\"token number\\">24</span><span class=\\"token operator\\">/</span><span class=\\"token number\\">5</span><span class=\\"token punctuation\\">)</span><span class=\\"token operator\\">*</span><span class=\\"token number\\">5</span><span class=\\"token operator\\">/</span><span class=\\"token number\\">60</span><span class=\\"token operator\\">/</span><span class=\\"token number\\">24</span><span class=\\"token punctuation\\">,</span> <span class=\\"token string\\">'dd/mm/yyyy hh24:mi'</span><span class=\\"token punctuation\\">)</span>\\n<span class=\\"token keyword\\">order</span> <span class=\\"token keyword\\">by</span> <span class=\\"token function\\">count</span><span class=\\"token punctuation\\">(</span><span class=\\"token operator\\">*</span><span class=\\"token punctuation\\">)</span>\\n\\n\\n<span class=\\"token keyword\\">select</span> sql_id<span class=\\"token punctuation\\">,</span><span class=\\"token function\\">count</span><span class=\\"token punctuation\\">(</span><span class=\\"token operator\\">*</span><span class=\\"token punctuation\\">)</span> <span class=\\"token keyword\\">from</span> V$ACTIVE_SESSION_HISTORY\\n<span class=\\"token keyword\\">where</span> sample_time<span class=\\"token operator\\">&gt;</span> to_date<span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'08-FEB-10 13:00'</span><span class=\\"token punctuation\\">,</span><span class=\\"token string\\">'dd-mon-yy hh24:mi'</span><span class=\\"token punctuation\\">)</span>\\n<span class=\\"token operator\\">and</span>  sample_time<span class=\\"token operator\\">&lt;</span> to_date<span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'08-FEB-10 16:00'</span><span class=\\"token punctuation\\">,</span><span class=\\"token string\\">'dd-mon-yy hh24:mi'</span><span class=\\"token punctuation\\">)</span>\\n<span class=\\"token operator\\">and</span> user_id<span class=\\"token operator\\">&gt;</span><span class=\\"token number\\">0</span>\\n<span class=\\"token keyword\\">group</span> <span class=\\"token keyword\\">by</span> sql_id\\n<span class=\\"token keyword\\">order</span> <span class=\\"token keyword\\">by</span> <span class=\\"token function\\">count</span><span class=\\"token punctuation\\">(</span><span class=\\"token operator\\">*</span><span class=\\"token punctuation\\">)</span> <span class=\\"token keyword\\">desc</span>\\n\\n<span class=\\"token keyword\\">select</span> <span class=\\"token operator\\">*</span> <span class=\\"token keyword\\">from</span> dba_views <span class=\\"token keyword\\">where</span> view_name <span class=\\"token operator\\">like</span> <span class=\\"token string\\">'DBA_HIST%'</span>\\n\\n<span class=\\"token keyword\\">select</span> sh<span class=\\"token punctuation\\">.</span>sample_time<span class=\\"token punctuation\\">,</span>sh<span class=\\"token punctuation\\">.</span>SESSION_ID<span class=\\"token punctuation\\">,</span>user_id<span class=\\"token punctuation\\">,</span>sh<span class=\\"token punctuation\\">.</span>sql_id<span class=\\"token punctuation\\">,</span>event<span class=\\"token punctuation\\">,</span>p1<span class=\\"token punctuation\\">,</span>blocking_session<span class=\\"token punctuation\\">,</span>PROGRAM<span class=\\"token punctuation\\">,</span>sql_text\\n<span class=\\"token keyword\\">from</span> DBA_HIST_ACTIVE_SESS_HISTORY sh\\n<span class=\\"token keyword\\">left</span> <span class=\\"token keyword\\">outer</span> <span class=\\"token keyword\\">join</span>  DBA_HIST_SQLTEXT  sq <span class=\\"token keyword\\">on</span> sq<span class=\\"token punctuation\\">.</span>sql_id<span class=\\"token operator\\">=</span>sh<span class=\\"token punctuation\\">.</span>sql_id \\n<span class=\\"token keyword\\">where</span> <span class=\\"token number\\">1</span><span class=\\"token operator\\">=</span><span class=\\"token number\\">1</span> \\n<span class=\\"token operator\\">and</span> sample_time<span class=\\"token operator\\">&gt;</span> to_date<span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'08-FEB-10 00:00'</span><span class=\\"token punctuation\\">,</span><span class=\\"token string\\">'dd-mon-yy hh24:mi'</span><span class=\\"token punctuation\\">)</span>\\n<span class=\\"token operator\\">and</span>  sample_time<span class=\\"token operator\\">&lt;</span> to_date<span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'08-FEB-10 23:00'</span><span class=\\"token punctuation\\">,</span><span class=\\"token string\\">'dd-mon-yy hh24:mi'</span><span class=\\"token punctuation\\">)</span>\\n<span class=\\"token operator\\">and</span> user_id<span class=\\"token operator\\">=</span><span class=\\"token number\\">61</span>\\n<span class=\\"token comment\\">--and sql_id='809u1jtt54kfy'</span>\\n<span class=\\"token keyword\\">order</span> <span class=\\"token keyword\\">by</span> sample_time\\n\\n\\n<span class=\\"token keyword\\">select</span> trunc<span class=\\"token punctuation\\">(</span>sample_time<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">,</span>\\n<span class=\\"token function\\">sum</span><span class=\\"token punctuation\\">(</span><span class=\\"token keyword\\">case</span> <span class=\\"token keyword\\">when</span> INSTANCE_NUMBER<span class=\\"token operator\\">=</span><span class=\\"token number\\">1</span> <span class=\\"token keyword\\">then</span> <span class=\\"token number\\">1</span> <span class=\\"token keyword\\">else</span> <span class=\\"token number\\">0</span> <span class=\\"token keyword\\">end</span><span class=\\"token punctuation\\">)</span> inst1<span class=\\"token punctuation\\">,</span>\\n<span class=\\"token function\\">sum</span><span class=\\"token punctuation\\">(</span><span class=\\"token keyword\\">case</span> <span class=\\"token keyword\\">when</span> INSTANCE_NUMBER<span class=\\"token operator\\">=</span><span class=\\"token number\\">2</span> <span class=\\"token keyword\\">then</span> <span class=\\"token number\\">1</span> <span class=\\"token keyword\\">else</span> <span class=\\"token number\\">0</span> <span class=\\"token keyword\\">end</span><span class=\\"token punctuation\\">)</span> inst2\\n<span class=\\"token keyword\\">from</span> DBA_HIST_ACTIVE_SESS_HISTORY sh\\n<span class=\\"token keyword\\">where</span> <span class=\\"token number\\">1</span><span class=\\"token operator\\">=</span><span class=\\"token number\\">1</span> \\n<span class=\\"token operator\\">and</span> user_id<span class=\\"token operator\\">=</span><span class=\\"token number\\">61</span>\\n<span class=\\"token keyword\\">group</span> <span class=\\"token keyword\\">by</span> trunc<span class=\\"token punctuation\\">(</span>sample_time<span class=\\"token punctuation\\">)</span>\\n<span class=\\"token keyword\\">order</span> <span class=\\"token keyword\\">by</span> trunc<span class=\\"token punctuation\\">(</span>sample_time<span class=\\"token punctuation\\">)</span>\\n\\n\\n\\n<span class=\\"token keyword\\">select</span> <span class=\\"token operator\\">*</span> <span class=\\"token keyword\\">from</span> DBA_HIST_SQLTEXT <span class=\\"token keyword\\">where</span> sql_id<span class=\\"token operator\\">=</span><span class=\\"token string\\">'d15cdr0zt3vtp'</span><span class=\\"token punctuation\\">;</span>\\n<span class=\\"token keyword\\">where</span> dbms_lob<span class=\\"token punctuation\\">.</span>instr<span class=\\"token punctuation\\">(</span>sql_text<span class=\\"token punctuation\\">,</span> <span class=\\"token string\\">'GLOBAL'</span><span class=\\"token punctuation\\">,</span><span class=\\"token number\\">1</span><span class=\\"token punctuation\\">,</span><span class=\\"token number\\">1</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">&gt;</span> <span class=\\"token number\\">0</span>\\n\\n<span class=\\"token keyword\\">desc</span> DBA_HIST_ACTIVE_SESS_HISTORY \\n\\n<span class=\\"token keyword\\">EXEC</span> DBMS_MONITOR<span class=\\"token punctuation\\">.</span>session_trace_enable<span class=\\"token punctuation\\">(</span>session_id <span class=\\"token operator\\">=</span><span class=\\"token operator\\">&gt;</span><span class=\\"token number\\">1234</span><span class=\\"token punctuation\\">,</span> serial_num<span class=\\"token operator\\">=</span><span class=\\"token operator\\">&gt;</span><span class=\\"token number\\">1234</span><span class=\\"token punctuation\\">,</span> waits<span class=\\"token operator\\">=</span><span class=\\"token operator\\">&gt;</span><span class=\\"token boolean\\">TRUE</span><span class=\\"token punctuation\\">,</span> binds<span class=\\"token operator\\">=</span><span class=\\"token operator\\">&gt;</span><span class=\\"token boolean\\">FALSE</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>\\n\\n<span class=\\"token keyword\\">select</span> sample_time<span class=\\"token punctuation\\">,</span>user_id<span class=\\"token punctuation\\">,</span>sql_id<span class=\\"token punctuation\\">,</span>event<span class=\\"token punctuation\\">,</span>p1<span class=\\"token punctuation\\">,</span>blocking_session <span class=\\"token keyword\\">from</span> V$ACTIVE_SESSION_HISTORY\\n<span class=\\"token keyword\\">where</span> event <span class=\\"token operator\\">like</span> <span class=\\"token string\\">'library%'</span>\\n\\n<span class=\\"token keyword\\">select</span> <span class=\\"token operator\\">*</span> <span class=\\"token keyword\\">from</span> v$active_session_history <span class=\\"token keyword\\">where</span> session_id<span class=\\"token operator\\">=</span><span class=\\"token number\\">306</span>\\n<span class=\\"token number\\">6969666696</span>\\n<span class=\\"token keyword\\">select</span> SESSION_ID<span class=\\"token punctuation\\">,</span>user_id<span class=\\"token punctuation\\">,</span>sql_id<span class=\\"token punctuation\\">,</span><span class=\\"token function\\">round</span><span class=\\"token punctuation\\">(</span>sample_time<span class=\\"token punctuation\\">,</span><span class=\\"token string\\">'hh'</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">,</span><span class=\\"token function\\">count</span><span class=\\"token punctuation\\">(</span><span class=\\"token operator\\">*</span><span class=\\"token punctuation\\">)</span> <span class=\\"token keyword\\">from</span> V$ACTIVE_SESSION_HISTORY\\n<span class=\\"token keyword\\">where</span> event <span class=\\"token operator\\">like</span> <span class=\\"token string\\">'log file sync'</span>\\n<span class=\\"token keyword\\">group</span> <span class=\\"token keyword\\">by</span>  SESSION_ID<span class=\\"token punctuation\\">,</span>user_id<span class=\\"token punctuation\\">,</span>sql_id<span class=\\"token punctuation\\">,</span><span class=\\"token function\\">round</span><span class=\\"token punctuation\\">(</span>sample_time<span class=\\"token punctuation\\">,</span><span class=\\"token string\\">'hh'</span><span class=\\"token punctuation\\">)</span>\\n<span class=\\"token keyword\\">order</span> <span class=\\"token keyword\\">by</span> <span class=\\"token function\\">count</span><span class=\\"token punctuation\\">(</span><span class=\\"token operator\\">*</span><span class=\\"token punctuation\\">)</span> <span class=\\"token keyword\\">desc</span>\\n</code></pre></div>"}`);export{u as comp,d as data};
