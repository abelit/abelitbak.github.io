import{_ as o}from"./plugin-vue_export-helper-DlAUqK2U.js";import{r as p,o as c,c as d,b as r,w as a,f as i,a as s,d as n}from"./app-DR5J2daJ.js";const u="/assets/redis-ha-master-slave-with-sentinel-001-Df5YCVHM.png",m={},b=i('<h2 id="主机准备" tabindex="-1"><a class="header-anchor" href="#主机准备"><span>主机准备</span></a></h2><h3 id="拓扑架构" tabindex="-1"><a class="header-anchor" href="#拓扑架构"><span>拓扑架构</span></a></h3><figure><img src="'+u+`" alt="主从+哨兵架构图" tabindex="0" loading="lazy"><figcaption>主从+哨兵架构图</figcaption></figure><h3 id="主机信息" tabindex="-1"><a class="header-anchor" href="#主机信息"><span>主机信息</span></a></h3><table><thead><tr><th>编号</th><th>IP 地址</th><th>角色</th><th>操作系统</th><th>内核版本</th><th>数据库版本</th></tr></thead><tbody><tr><td>1</td><td>10.10.13.100</td><td>redis主、sentinel</td><td>CentOS 7.9</td><td>3.10.0-1160.el7.x86_64</td><td>7.0.14/6.2.14</td></tr><tr><td>2</td><td>10.10.13.101</td><td>redis从、sentinel</td><td>CentOS 7.9</td><td>3.10.0-1160.el7.x86_64</td><td>7.0.14/6.2.14</td></tr><tr><td>3</td><td>10.10.13.102</td><td>redis从、sentinel</td><td>CentOS 7.9</td><td>3.10.0-1160.el7.x86_64</td><td>7.0.14/6.2.14</td></tr></tbody></table><h3 id="主机设置" tabindex="-1"><a class="header-anchor" href="#主机设置"><span>主机设置</span></a></h3><ul><li>主机名称设置</li></ul><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment"># 主节点</span>
hostnamectl set-hostname node0

<span class="token comment"># 从节点</span>
hostnamectl set-hostname node1

<span class="token comment"># 从节点</span>
hostnamectl set-hostname node2

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>主机<code>hosts</code>设置</li></ul><blockquote><p>所有节点</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">cat</span> <span class="token operator">&gt;</span> /etc/hosts <span class="token operator">&lt;&lt;</span><span class="token string">EOF
127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
::1         localhost localhost.localdomain localhost6 localhost6.localdomain6

# by abelit
10.10.13.100 node0
10.10.13.101 node1
10.10.13.102 node2
EOF</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>关闭防火墙</li></ul><blockquote><p>所有节点</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>systemctl stop firewalld
systemctl disable firewalld
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>selinux设置</li></ul><blockquote><p>所有节点</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>setenforce <span class="token number">0</span>
<span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">&quot;s/^SELINUX=enforcing/SELINUX=disabled/g&quot;</span> /etc/selinux/config
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="安装依赖" tabindex="-1"><a class="header-anchor" href="#安装依赖"><span>安装依赖</span></a></h3><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>yum <span class="token function">install</span> <span class="token parameter variable">-y</span> <span class="token function">wget</span>

yum <span class="token parameter variable">-y</span> <span class="token function">install</span> gcc c++ <span class="token function">make</span>  


</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="安装和配置redis主从" tabindex="-1"><a class="header-anchor" href="#安装和配置redis主从"><span>安装和配置Redis主从</span></a></h2><h3 id="安装redis" tabindex="-1"><a class="header-anchor" href="#安装redis"><span>安装Redis</span></a></h3><blockquote><p>所有节点</p></blockquote><ul><li>下载redis</li></ul><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">wget</span> https://download.redis.io/releases/redis-6.2.14.tar.gz
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>安装redis</li></ul><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">tar</span> <span class="token parameter variable">-zxvf</span> redis-6.2.14.tar.gz <span class="token parameter variable">-C</span> /usr/local/

<span class="token function">ln</span> <span class="token parameter variable">-sf</span> /usr/local/redis-6.2.14 /usr/local/redis

<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /usr/local/redis/data/redis
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /usr/local/redis/data/sentinel

<span class="token builtin class-name">cd</span> /usr/local/redis

<span class="token function">make</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="配置启动服务-可选" tabindex="-1"><a class="header-anchor" href="#配置启动服务-可选"><span>配置启动服务(可选)</span></a></h3><ul><li>使用systemd管理redis服务</li></ul><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">cat</span> <span class="token operator">&gt;</span> /lib/systemd/system/redis.service <span class="token operator">&lt;&lt;</span><span class="token string">&#39;EOF&#39;
[Unit]
Description=Redis
After=network.target

[Service]
ExecStart=/usr/local/redis/src/redis-server /usr/local/redis/redis.conf  --daemonize no
ExecStop=/usr/local/redis/src/redis-cli -h 127.0.0.1 -p 6379 shutdown

[Install]
WantedBy=multi-user.target
EOF</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>启动redis</li></ul><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>systemctl daemon-reload

systemctl start redis.service
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="主从配置" tabindex="-1"><a class="header-anchor" href="#主从配置"><span>主从配置</span></a></h3><ul><li>主库配置 编辑<code>/usr/local/redis/redis.conf</code>配置文件，修改如下内容：</li></ul>`,33),k=s("div",{class:"language-conf line-numbers-mode","data-ext":"conf","data-title":"conf"},[s("pre",{class:"language-conf"},[s("code",null,`bind 0.0.0.0
port 6379

protected-mode no
dir /usr/local/redis/data/redis

requirepass Hello@2023
masterauth Hello@2023

appendonly yes
appendfilename "appendonly.aof"
dbfilename dump.rdb

daemonize yes
`)]),s("div",{class:"line-numbers","aria-hidden":"true"},[s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"})])],-1),v=s("div",{class:"language-bash line-numbers-mode","data-ext":"sh","data-title":"sh"},[s("pre",{class:"language-bash"},[s("code",null,[s("span",{class:"token function"},"cp"),n(` /usr/local/redis/redis.conf /usr/local/redis/redis.conf.origin

`),s("span",{class:"token function"},"sed"),n(),s("span",{class:"token parameter variable"},"-i"),n(),s("span",{class:"token string"},"'s/^bind 127.0.0.1 -::1/bind 0.0.0.0/g'"),n(` /usr/local/redis/redis.conf
`),s("span",{class:"token function"},"sed"),n(),s("span",{class:"token parameter variable"},"-i"),n(),s("span",{class:"token string"},"'s/^port 6379/port 6379/g'"),n(` /usr/local/redis/redis.conf
`),s("span",{class:"token function"},"sed"),n(),s("span",{class:"token parameter variable"},"-i"),n(),s("span",{class:"token string"},"'s/^protected-mode yes/protected-mode no/g'"),n(` /usr/local/redis/redis.conf
`),s("span",{class:"token function"},"sed"),n(),s("span",{class:"token parameter variable"},"-i"),n(),s("span",{class:"token string"},"'s/^dir .\\//dir \\/usr\\/local\\/redis\\/data/g'"),n(` /usr/local/redis/redis.conf
`),s("span",{class:"token function"},"sed"),n(),s("span",{class:"token parameter variable"},"-i"),n(),s("span",{class:"token string"},"'s/^# requirepass foobared/requirepass Hello@2023/g'"),n(` /usr/local/redis/redis.conf
`),s("span",{class:"token function"},"sed"),n(),s("span",{class:"token parameter variable"},"-i"),n(),s("span",{class:"token string"},"'s/^# masterauth <master-password>/masterauth Hello@2023/g'"),n(` /usr/local/redis/redis.conf
`),s("span",{class:"token function"},"sed"),n(),s("span",{class:"token parameter variable"},"-i"),n(),s("span",{class:"token string"},"'s/^appendonly no/appendonly yes/g'"),n(` /usr/local/redis/redis.conf
`),s("span",{class:"token function"},"sed"),n(),s("span",{class:"token parameter variable"},"-i"),n(),s("span",{class:"token string"},`'s/^appendfilename "appendonly.aof"/appendfilename "appendonly.aof"/g'`),n(` /usr/local/redis/redis.conf
`),s("span",{class:"token function"},"sed"),n(),s("span",{class:"token parameter variable"},"-i"),n(),s("span",{class:"token string"},"'s/^dbfilename dump.rdb/dbfilename dump.rdb/g'"),n(` /usr/local/redis/redis.conf
`),s("span",{class:"token function"},"sed"),n(),s("span",{class:"token parameter variable"},"-i"),n(),s("span",{class:"token string"},"'s/^daemonize no/daemonize yes/g'"),n(` /usr/local/redis/redis.conf

`),s("span",{class:"token function"},"cat"),n(" /usr/local/redis/redis.conf "),s("span",{class:"token operator"},"|"),n(),s("span",{class:"token function"},"grep"),n(),s("span",{class:"token parameter variable"},"-E"),n(),s("span",{class:"token string"},'"^bind|^port|^protected-mode|^dir|^requirepass|^masterauth|^appendonly|^appendfilename|^dbfilename|^daemonize"'),n(`
`)])]),s("div",{class:"line-numbers","aria-hidden":"true"},[s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"})])],-1),h=s("ul",null,[s("li",null,[n("从库配置 编辑"),s("code",null,"/usr/local/redis/redis.conf"),n("配置文件，修改如下内容：")])],-1),g=s("div",{class:"language-conf line-numbers-mode","data-ext":"conf","data-title":"conf"},[s("pre",{class:"language-conf"},[s("code",null,`bind 0.0.0.0
port 6379

protected-mode no
dir /usr/local/redis/data/redis

requirepass Hello@2023
masterauth Hello@2023

appendonly yes
appendfilename "appendonly.aof"
dbfilename dump.rdb

daemonize yes

replicaof node0 6379
`)]),s("div",{class:"line-numbers","aria-hidden":"true"},[s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"})])],-1),f=s("div",{class:"language-bash line-numbers-mode","data-ext":"sh","data-title":"sh"},[s("pre",{class:"language-bash"},[s("code",null,[s("span",{class:"token function"},"cp"),n(` /usr/local/redis/redis.conf /usr/local/redis/redis.conf.origin

`),s("span",{class:"token function"},"sed"),n(),s("span",{class:"token parameter variable"},"-i"),n(),s("span",{class:"token string"},"'s/^bind 127.0.0.1 -::1/bind 0.0.0.0/g'"),n(` /usr/local/redis/redis.conf
`),s("span",{class:"token function"},"sed"),n(),s("span",{class:"token parameter variable"},"-i"),n(),s("span",{class:"token string"},"'s/^port 6379/port 6379/g'"),n(` /usr/local/redis/redis.conf
`),s("span",{class:"token function"},"sed"),n(),s("span",{class:"token parameter variable"},"-i"),n(),s("span",{class:"token string"},"'s/^protected-mode yes/protected-mode no/g'"),n(` /usr/local/redis/redis.conf
`),s("span",{class:"token function"},"sed"),n(),s("span",{class:"token parameter variable"},"-i"),n(),s("span",{class:"token string"},"'s/^dir .\\//dir \\/usr\\/local\\/redis\\/data/g'"),n(` /usr/local/redis/redis.conf
`),s("span",{class:"token function"},"sed"),n(),s("span",{class:"token parameter variable"},"-i"),n(),s("span",{class:"token string"},"'s/^# requirepass foobared/requirepass Hello@2023/g'"),n(` /usr/local/redis/redis.conf
`),s("span",{class:"token function"},"sed"),n(),s("span",{class:"token parameter variable"},"-i"),n(),s("span",{class:"token string"},"'s/^# masterauth <master-password>/masterauth Hello@2023/g'"),n(` /usr/local/redis/redis.conf
`),s("span",{class:"token function"},"sed"),n(),s("span",{class:"token parameter variable"},"-i"),n(),s("span",{class:"token string"},"'s/^appendonly no/appendonly yes/g'"),n(` /usr/local/redis/redis.conf
`),s("span",{class:"token function"},"sed"),n(),s("span",{class:"token parameter variable"},"-i"),n(),s("span",{class:"token string"},`'s/^appendfilename "appendonly.aof"/appendfilename "appendonly.aof"/g'`),n(` /usr/local/redis/redis.conf
`),s("span",{class:"token function"},"sed"),n(),s("span",{class:"token parameter variable"},"-i"),n(),s("span",{class:"token string"},"'s/^dbfilename dump.rdb/dbfilename dump.rdb/g'"),n(` /usr/local/redis/redis.conf
`),s("span",{class:"token function"},"sed"),n(),s("span",{class:"token parameter variable"},"-i"),n(),s("span",{class:"token string"},"'s/^daemonize no/daemonize yes/g'"),n(` /usr/local/redis/redis.conf
`),s("span",{class:"token function"},"sed"),n(),s("span",{class:"token parameter variable"},"-i"),n(),s("span",{class:"token string"},"'s/^# replicaof <masterip> <masterport>/replicaof node0 6379/g'"),n(` /usr/local/redis/redis.conf

`),s("span",{class:"token function"},"cat"),n(" /usr/local/redis/redis.conf "),s("span",{class:"token operator"},"|"),n(),s("span",{class:"token function"},"grep"),n(),s("span",{class:"token parameter variable"},"-E"),n(),s("span",{class:"token string"},'"^bind|^port|^protected-mode|^dir|^requirepass|^masterauth|^appendonly|^appendfilename|^dbfilename|^daemonize|^replicaof"'),n(`
`)])]),s("div",{class:"line-numbers","aria-hidden":"true"},[s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"})])],-1),_=i(`<div class="hint-container tip"><p class="hint-container-title">参数说明</p><ul><li>redis protected-mode 是一种安全机制，用于保护 Redis 实例免受未经授权的访问。当 protected-mode 启用时，只有来自本地主机或已在 redis.conf 文件中明确授权的 IP 地址的连接才能访问 Redis 实例。这可以防止恶意攻击者通过网络访问 Redis 实例并执行未经授权的操作。</li></ul></div><h3 id="启动服务" tabindex="-1"><a class="header-anchor" href="#启动服务"><span>启动服务</span></a></h3><ul><li>启动主库</li></ul><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>/usr/local/redis/src/redis-server /usr/local/redis/redis.conf

<span class="token function">netstat</span>  -antlp<span class="token operator">|</span><span class="token function">grep</span> :6379
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>启动从库</li></ul><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>/usr/local/redis/src/redis-server /usr/local/redis/redis.conf

<span class="token function">netstat</span>  -antlp<span class="token operator">|</span><span class="token function">grep</span> :6379
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="主从管理" tabindex="-1"><a class="header-anchor" href="#主从管理"><span>主从管理</span></a></h2><h3 id="主从状态检查" tabindex="-1"><a class="header-anchor" href="#主从状态检查"><span>主从状态检查</span></a></h3><h4 id="检查主库状态" tabindex="-1"><a class="header-anchor" href="#检查主库状态"><span>检查主库状态</span></a></h4><ul><li>登陆redis主库</li></ul><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>/usr/local/redis/src/redis-cli <span class="token parameter variable">-p</span> <span class="token number">6379</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>查看redis主库状态</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code>info <span class="token keyword">replication</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>显示结果：</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> info replication
<span class="token comment"># Replication</span>
role:master
connected_slaves:2
slave0:ip<span class="token operator">=</span><span class="token number">10.10</span>.13.101,port<span class="token operator">=</span><span class="token number">6379</span>,state<span class="token operator">=</span>online,offset<span class="token operator">=</span><span class="token number">688</span>,lag<span class="token operator">=</span><span class="token number">1</span>
slave1:ip<span class="token operator">=</span><span class="token number">10.10</span>.13.102,port<span class="token operator">=</span><span class="token number">6379</span>,state<span class="token operator">=</span>online,offset<span class="token operator">=</span><span class="token number">688</span>,lag<span class="token operator">=</span><span class="token number">1</span>
master_failover_state:no-failover
master_replid:93041a705f6ea57f30038f54b2e447f2835f79e8
master_replid2:0000000000000000000000000000000000000000
master_repl_offset:688
second_repl_offset:-1
repl_backlog_active:1
repl_backlog_size:1048576
repl_backlog_first_byte_offset:1
repl_backlog_histlen:688
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="检查从库状态" tabindex="-1"><a class="header-anchor" href="#检查从库状态"><span>检查从库状态</span></a></h4><ul><li>登陆redis从库</li></ul><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>/usr/local/redis/src/redis-cli <span class="token parameter variable">-p</span> <span class="token number">6379</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>查看redis从库状态</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code>info <span class="token keyword">replication</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>显示结果：</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> info replication
<span class="token comment"># Replication</span>
role:slave
master_host:node0
master_port:6379
master_link_status:up
master_last_io_seconds_ago:6
master_sync_in_progress:0
slave_read_repl_offset:688
slave_repl_offset:688
slave_priority:100
slave_read_only:1
replica_announced:1
connected_slaves:0
master_failover_state:no-failover
master_replid:93041a705f6ea57f30038f54b2e447f2835f79e8
master_replid2:0000000000000000000000000000000000000000
master_repl_offset:688
second_repl_offset:-1
repl_backlog_active:1
repl_backlog_size:1048576
repl_backlog_first_byte_offset:1
repl_backlog_histlen:688
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="数据同步测试" tabindex="-1"><a class="header-anchor" href="#数据同步测试"><span>数据同步测试</span></a></h2><ul><li>主库写入数据</li></ul><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost redis<span class="token punctuation">]</span><span class="token comment"># /usr/local/redis/src/redis-cli -p 6379</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> auth Hello@2023
OK
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token builtin class-name">set</span> name abelit
OK
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> get name
<span class="token string">&quot;abelit&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>从库读取数据</li></ul><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost redis<span class="token punctuation">]</span><span class="token comment"># /usr/local/redis/src/redis-cli -p 6379</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> auth Hello@2023
OK
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> get name
<span class="token string">&quot;abelit&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="关闭redis服务" tabindex="-1"><a class="header-anchor" href="#关闭redis服务"><span>关闭redis服务</span></a></h3><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>/usr/local/redis/src/redis-cli <span class="token parameter variable">-a</span> <span class="token string">&quot;Hello@2023&quot;</span> <span class="token parameter variable">-h</span> node0 <span class="token parameter variable">-p</span> <span class="token number">6379</span> <span class="token function">shutdown</span>
/usr/local/redis/src/redis-cli <span class="token parameter variable">-a</span> <span class="token string">&quot;Hello@2023&quot;</span> <span class="token parameter variable">-h</span> node1 <span class="token parameter variable">-p</span> <span class="token number">6379</span> <span class="token function">shutdown</span>
/usr/local/redis/src/redis-cli <span class="token parameter variable">-a</span> <span class="token string">&quot;Hello@2023&quot;</span> <span class="token parameter variable">-h</span> node2 <span class="token parameter variable">-p</span> <span class="token number">6379</span> <span class="token function">shutdown</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="启动redis服务" tabindex="-1"><a class="header-anchor" href="#启动redis服务"><span>启动redis服务</span></a></h3><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>/usr/local/redis/src/redis-server /usr/local/redis/redis.conf

<span class="token function">netstat</span>  -antlp<span class="token operator">|</span><span class="token function">grep</span> :6379
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="哨兵集群搭建" tabindex="-1"><a class="header-anchor" href="#哨兵集群搭建"><span>哨兵集群搭建</span></a></h2><h3 id="配置哨兵" tabindex="-1"><a class="header-anchor" href="#配置哨兵"><span>配置哨兵</span></a></h3><blockquote><p>所有哨兵节点 编辑<code>/usr/local/redis/sentinel.conf</code>配置文件，修改如下内容：</p></blockquote>`,34),y=s("div",{class:"language-conf line-numbers-mode","data-ext":"conf","data-title":"conf"},[s("pre",{class:"language-conf"},[s("code",null,`port 26379
sentinel announce-ip 10.10.13.100
sentinel monitor mymaster 10.10.13.100 6379 2
sentinel down-after-milliseconds mymaster 5000
sentinel failover-timeout mymaster 60000
dir /usr/local/redis/data/sentinel

protected-mode no
daemonize yes
logfile /usr/local/redis/src/sentinel.log
`)]),s("div",{class:"line-numbers","aria-hidden":"true"},[s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"})])],-1),x=s("div",{class:"language-bash line-numbers-mode","data-ext":"sh","data-title":"sh"},[s("pre",{class:"language-bash"},[s("code",null,[s("span",{class:"token function"},"cp"),n(` /usr/local/redis/sentinel.conf /usr/local/redis/sentinel.conf.origin

`),s("span",{class:"token function"},"sed"),n(),s("span",{class:"token parameter variable"},"-i"),n(),s("span",{class:"token string"},"'s/^port 26379/port 26379/g'"),n(` /usr/local/redis/sentinel.conf
`),s("span",{class:"token function"},"sed"),n(),s("span",{class:"token parameter variable"},"-i"),n(),s("span",{class:"token string"},"'s/^dir \\/tmp/dir \\/usr\\/local\\/redis\\/data\\/sentinel/g'"),n(` /usr/local/redis/sentinel.conf
`),s("span",{class:"token function"},"sed"),n(),s("span",{class:"token parameter variable"},"-i"),n(),s("span",{class:"token string"},`'s/^# sentinel announce-ip <ip>/sentinel announce-ip "10.10.13.100"/g'`),n(` /usr/local/redis/sentinel.conf
`),s("span",{class:"token function"},"sed"),n(),s("span",{class:"token parameter variable"},"-i"),n(),s("span",{class:"token string"},"'s/^sentinel monitor mymaster 127.0.0.1 6379 2/sentinel monitor mymaster 10.10.13.100 6379 2/g'"),n(` /usr/local/redis/sentinel.conf
`),s("span",{class:"token function"},"sed"),n(),s("span",{class:"token parameter variable"},"-i"),n(),s("span",{class:"token string"},"'s/^sentinel down-after-milliseconds mymaster 30000/sentinel down-after-milliseconds mymaster 30000/g'"),n(` /usr/local/redis/sentinel.conf
`),s("span",{class:"token function"},"sed"),n(),s("span",{class:"token parameter variable"},"-i"),n(),s("span",{class:"token string"},"'s/^sentinel failover-timeout mymaster 180000/sentinel failover-timeout mymaster 180000/g'"),n(` /usr/local/redis/sentinel.conf

`),s("span",{class:"token function"},"sed"),n(),s("span",{class:"token parameter variable"},"-i"),n(),s("span",{class:"token string"},"'s/^# sentinel auth-pass <master-name> <password>/sentinel auth-pass mymaster Hello@2023/g'"),n(` /usr/local/redis/sentinel.conf
`),s("span",{class:"token function"},"sed"),n(),s("span",{class:"token parameter variable"},"-i"),n(),s("span",{class:"token string"},"'s/^# protected-mode no/protected-mode no/g'"),n(` /usr/local/redis/sentinel.conf
`),s("span",{class:"token function"},"sed"),n(),s("span",{class:"token parameter variable"},"-i"),n(),s("span",{class:"token string"},"'s/^daemonize no/daemonize yes/g'"),n(` /usr/local/redis/sentinel.conf
`),s("span",{class:"token function"},"sed"),n(),s("span",{class:"token parameter variable"},"-i"),n(),s("span",{class:"token string"},`'s/^logfile ""/logfile \\/usr\\/local\\/redis\\/src\\/sentinel.log/g'`),n(` /usr/local/redis/sentinel.conf

`),s("span",{class:"token function"},"cat"),n(" /usr/local/redis/sentinel.conf "),s("span",{class:"token operator"},"|"),n(),s("span",{class:"token function"},"grep"),n(),s("span",{class:"token parameter variable"},"-E"),n(),s("span",{class:"token string"},'"^port|^sentinel|^dir|^daemonize|^protected-mode|^logfile"'),n(`
`)])]),s("div",{class:"line-numbers","aria-hidden":"true"},[s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"})])],-1),q=i(`<div class="hint-container tip"><p class="hint-container-title">参数说明</p><ul><li><code>protected-mode no</code> 关闭保护模式，可以外部访问。</li><li><code>sentinel monitor mymaster 127.0.0.1 6379 2</code> 指定服务器IP地址和端口，并且指定当有<code>2</code>台哨兵认为主机挂了，则对主机进行容灾切换。 注意:三台哨兵这里的ip配置均为主节点ip 和端口</li><li><code>sentinel auth-pass mymaster Hello@2023</code> 当在Redis实例中开启了requirepass，这里就需要提供密码。</li><li><code>sentinel failover-timeout mymaster 180000</code> 故障转移的超时时间，这里设置为三分钟。</li><li><code>snetinel parallel-syncs mymaster 1</code> 主备切换时，最多有多少个slave同时对新的master进行同步，这里设置为默认的1。</li><li><code>sentinel down-after-milliseconds mymaster 30000</code> 这里设置了主机多少秒无响应，则认为挂了。</li><li><code>daemonize yes</code> 设置后台启动。</li></ul></div><h3 id="启动哨兵" tabindex="-1"><a class="header-anchor" href="#启动哨兵"><span>启动哨兵</span></a></h3><blockquote><p>所有哨兵节点</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>/usr/local/redis/src/redis-sentinel /usr/local/redis/sentinel.conf

<span class="token function">netstat</span>  -antlp<span class="token operator">|</span><span class="token function">grep</span> :26379
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="状态查看" tabindex="-1"><a class="header-anchor" href="#状态查看"><span>状态查看</span></a></h3><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>/usr/local/redis/src/redis-cli <span class="token parameter variable">-p</span> <span class="token number">26379</span>

info sentinel
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="主从切换" tabindex="-1"><a class="header-anchor" href="#主从切换"><span>主从切换</span></a></h2><h3 id="手动switchover" tabindex="-1"><a class="header-anchor" href="#手动switchover"><span>手动switchover</span></a></h3><ul><li>停止主库</li></ul><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>/usr/local/redis/src/redis-cli <span class="token parameter variable">-a</span> <span class="token string">&quot;Hello@2023&quot;</span> <span class="token parameter variable">-h</span> node0 <span class="token parameter variable">-p</span> <span class="token number">6379</span> <span class="token function">shutdown</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>把从库设置为主库</li></ul><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>/usr/local/redis/src/redis-cli <span class="token parameter variable">-a</span> <span class="token string">&quot;Hello@2023&quot;</span> <span class="token parameter variable">-h</span> node1 <span class="token parameter variable">-p</span> <span class="token number">6379</span> replicaof NO ONE
/usr/local/redis/src/redis-cli <span class="token parameter variable">-a</span> <span class="token string">&quot;Hello@2023&quot;</span> <span class="token parameter variable">-h</span> node1 <span class="token parameter variable">-p</span> <span class="token number">6379</span> info replication
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>持久化新主库数据</li></ul><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>/usr/local/redis/src/redis-cli <span class="token parameter variable">-a</span> <span class="token string">&quot;Hello@2023&quot;</span> <span class="token parameter variable">-h</span> node1 <span class="token parameter variable">-p</span> <span class="token number">6379</span> save
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>后面两步可实现原主库恢复。</p><ul><li>复制新主库的数据到原主库</li></ul><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">scp</span> /usr/local/redis/data/redis/dump.rdb root@node0:/usr/local/redis/data/redis/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>启动原主库</li></ul><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>/usr/local/redis/src/redis-server /usr/local/redis/redis.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>把新主库转为从库</li></ul><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>/usr/local/redis/src/redis-cli <span class="token parameter variable">-a</span> <span class="token string">&quot;Hello@2023&quot;</span> <span class="token parameter variable">-h</span> node1 <span class="token parameter variable">-p</span> <span class="token number">6379</span> replicaof node0 <span class="token number">6379</span>
/usr/local/redis/src/redis-cli <span class="token parameter variable">-a</span> <span class="token string">&quot;Hello@2023&quot;</span> <span class="token parameter variable">-h</span> node1 <span class="token parameter variable">-p</span> <span class="token number">6379</span> info replication
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="故障切换" tabindex="-1"><a class="header-anchor" href="#故障切换"><span>故障切换</span></a></h3><ul><li>停止主库（模拟主库宕机）</li></ul><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>/usr/local/redis/src/redis-cli <span class="token parameter variable">-a</span> <span class="token string">&quot;Hello@2023&quot;</span> <span class="token parameter variable">-h</span> node0 <span class="token parameter variable">-p</span> <span class="token number">6379</span> <span class="token function">shutdown</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>查看哨兵节点日志信息 找到新的主库</li></ul><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">more</span> /usr/local/redis/src/sentinel.log
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>结果显示：</p><div class="language-log line-numbers-mode" data-ext="log" data-title="log"><pre class="language-log"><code><span class="token punctuation">[</span>root<span class="token operator">@</span>node0 <span class="token operator">~</span><span class="token punctuation">]</span><span class="token operator">#</span> more <span class="token file-path string">/usr/local/redis/src/sentinel.log</span>
<span class="token number">6676</span><span class="token operator">:</span>X <span class="token date number">14 Dec 2023</span> <span class="token time number">14:59:01.736</span> <span class="token operator">#</span> Failed to resolve hostname <span class="token string">&#39;node0&#39;</span>
<span class="token number">6700</span><span class="token operator">:</span>X <span class="token date number">14 Dec 2023</span> <span class="token time number">15:03:02.678</span> <span class="token operator">#</span> oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo
<span class="token number">6700</span><span class="token operator">:</span>X <span class="token date number">14 Dec 2023</span> <span class="token time number">15:03:02.678</span> <span class="token operator">#</span> Redis version<span class="token operator">=</span><span class="token number">6.2.14</span><span class="token punctuation">,</span> bits<span class="token operator">=</span><span class="token number">64</span><span class="token punctuation">,</span> commit<span class="token operator">=</span><span class="token number">00000000</span><span class="token punctuation">,</span> modified<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> pid<span class="token operator">=</span><span class="token number">6700</span><span class="token punctuation">,</span> just started
<span class="token number">6700</span><span class="token operator">:</span>X <span class="token date number">14 Dec 2023</span> <span class="token time number">15:03:02.678</span> <span class="token operator">#</span> Configuration loaded
<span class="token number">6700</span><span class="token operator">:</span>X <span class="token date number">14 Dec 2023</span> <span class="token time number">15:03:02.679</span> <span class="token operator">*</span> Increased maximum number of open files to <span class="token number">10032</span> <span class="token operator">(</span>it was originally set to <span class="token number">1024</span><span class="token operator">)</span><span class="token punctuation">.</span>
<span class="token number">6700</span><span class="token operator">:</span>X <span class="token date number">14 Dec 2023</span> <span class="token time number">15:03:02.679</span> <span class="token operator">*</span> monotonic clock<span class="token operator">:</span> POSIX clock_gettime
<span class="token number">6700</span><span class="token operator">:</span>X <span class="token date number">14 Dec 2023</span> <span class="token time number">15:03:02.680</span> <span class="token operator">*</span> Running mode<span class="token operator">=</span>sentinel<span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">26379</span><span class="token punctuation">.</span>
<span class="token number">6700</span><span class="token operator">:</span>X <span class="token date number">14 Dec 2023</span> <span class="token time number">15:03:02.680</span> <span class="token operator">#</span> <span class="token level warning important">WARNING</span><span class="token operator">:</span> The TCP backlog setting of <span class="token number">511</span> cannot be enforced because <span class="token file-path string">/proc/sys/net/core/somaxconn</span> is set to the lower value of
 <span class="token number">128</span><span class="token punctuation">.</span>
<span class="token number">6700</span><span class="token operator">:</span>X <span class="token date number">14 Dec 2023</span> <span class="token time number">15:03:02.683</span> <span class="token operator">#</span> Sentinel ID is d0f1410427910f306bccd57e4dbc4efe0a7cbce7
<span class="token number">6700</span><span class="token operator">:</span>X <span class="token date number">14 Dec 2023</span> <span class="token time number">15:03:02.683</span> <span class="token operator">#</span> <span class="token operator">+</span>monitor master mymaster <span class="token ip-address constant">10.10.13.100</span> <span class="token number">6379</span> quorum <span class="token number">2</span>
<span class="token number">6700</span><span class="token operator">:</span>X <span class="token date number">14 Dec 2023</span> <span class="token time number">15:03:02.683</span> <span class="token operator">*</span> <span class="token operator">+</span>slave slave <span class="token ip-address constant">10.10.13.101</span><span class="token operator">:</span><span class="token number">6379</span> <span class="token ip-address constant">10.10.13.101</span> <span class="token number">6379</span> <span class="token operator">@</span> mymaster <span class="token ip-address constant">10.10.13.100</span> <span class="token number">6379</span>
<span class="token number">6700</span><span class="token operator">:</span>X <span class="token date number">14 Dec 2023</span> <span class="token time number">15:03:02.686</span> <span class="token operator">*</span> <span class="token operator">+</span>slave slave <span class="token ip-address constant">10.10.13.102</span><span class="token operator">:</span><span class="token number">6379</span> <span class="token ip-address constant">10.10.13.102</span> <span class="token number">6379</span> <span class="token operator">@</span> mymaster <span class="token ip-address constant">10.10.13.100</span> <span class="token number">6379</span>
<span class="token number">6706</span><span class="token operator">:</span>X <span class="token date number">14 Dec 2023</span> <span class="token time number">15:03:07.908</span> <span class="token operator">#</span> oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo
<span class="token number">6706</span><span class="token operator">:</span>X <span class="token date number">14 Dec 2023</span> <span class="token time number">15:03:07.908</span> <span class="token operator">#</span> Redis version<span class="token operator">=</span><span class="token number">6.2.14</span><span class="token punctuation">,</span> bits<span class="token operator">=</span><span class="token number">64</span><span class="token punctuation">,</span> commit<span class="token operator">=</span><span class="token number">00000000</span><span class="token punctuation">,</span> modified<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> pid<span class="token operator">=</span><span class="token number">6706</span><span class="token punctuation">,</span> just started
<span class="token number">6706</span><span class="token operator">:</span>X <span class="token date number">14 Dec 2023</span> <span class="token time number">15:03:07.908</span> <span class="token operator">#</span> Configuration loaded
<span class="token number">6706</span><span class="token operator">:</span>X <span class="token date number">14 Dec 2023</span> <span class="token time number">15:03:07.909</span> <span class="token operator">*</span> Increased maximum number of open files to <span class="token number">10032</span> <span class="token operator">(</span>it was originally set to <span class="token number">1024</span><span class="token operator">)</span><span class="token punctuation">.</span>
<span class="token number">6706</span><span class="token operator">:</span>X <span class="token date number">14 Dec 2023</span> <span class="token time number">15:03:07.909</span> <span class="token operator">*</span> monotonic clock<span class="token operator">:</span> POSIX clock_gettime
<span class="token number">6706</span><span class="token operator">:</span>X <span class="token date number">14 Dec 2023</span> <span class="token time number">15:03:07.909</span> <span class="token operator">#</span> Warning<span class="token operator">:</span> Could not create server TCP listening socket <span class="token operator">*</span><span class="token operator">:</span><span class="token number">26379</span><span class="token operator">:</span> bind<span class="token operator">:</span> Address already in use
<span class="token number">6706</span><span class="token operator">:</span>X <span class="token date number">14 Dec 2023</span> <span class="token time number">15:03:07.909</span> <span class="token operator">#</span> Failed listening on port <span class="token number">26379</span> <span class="token operator">(</span>TCP<span class="token operator">)</span><span class="token punctuation">,</span> aborting<span class="token punctuation">.</span>
<span class="token number">6700</span><span class="token operator">:</span>X <span class="token date number">14 Dec 2023</span> <span class="token time number">15:03:12.117</span> <span class="token operator">*</span> <span class="token operator">+</span>sentinel sentinel aac0a52219307148edfb34cc0db8ce0003c5a311 <span class="token ip-address constant">10.10.13.100</span> <span class="token number">26379</span> <span class="token operator">@</span> mymaster <span class="token ip-address constant">10.10.13.100</span> <span class="token number">6379</span>
<span class="token number">6700</span><span class="token operator">:</span>X <span class="token date number">14 Dec 2023</span> <span class="token time number">15:03:13.716</span> <span class="token operator">*</span> <span class="token operator">+</span>sentinel<span class="token operator">-</span>invalid<span class="token operator">-</span>addr sentinel aac0a52219307148edfb34cc0db8ce0003c5a311 <span class="token ip-address constant">10.10.13.100</span> <span class="token number">26379</span> <span class="token operator">@</span> mymaster <span class="token ip-address constant">10.10.13.100</span> <span class="token number">6379</span>
<span class="token number">6700</span><span class="token operator">:</span>X <span class="token date number">14 Dec 2023</span> <span class="token time number">15:03:13.717</span> <span class="token operator">*</span> <span class="token operator">+</span>sentinel sentinel <span class="token number">1e673cbceb82b2144605ea3851ea332c22e8f22c</span> <span class="token ip-address constant">10.10.13.100</span> <span class="token number">26379</span> <span class="token operator">@</span> mymaster <span class="token ip-address constant">10.10.13.100</span> <span class="token number">6379</span>
<span class="token number">6700</span><span class="token operator">:</span>X <span class="token date number">14 Dec 2023</span> <span class="token time number">15:03:14.155</span> <span class="token operator">*</span> <span class="token operator">+</span>sentinel<span class="token operator">-</span>address<span class="token operator">-</span>switch master mymaster <span class="token ip-address constant">10.10.13.100</span> <span class="token number">6379</span> ip <span class="token ip-address constant">10.10.13.100</span> port <span class="token number">26379</span> for aac0a52219307148edfb34cc0db8ce0003
c5a311
<span class="token number">6700</span><span class="token operator">:</span>X <span class="token date number">14 Dec 2023</span> <span class="token time number">15:03:15.726</span> <span class="token operator">*</span> <span class="token operator">+</span>sentinel<span class="token operator">-</span>invalid<span class="token operator">-</span>addr sentinel <span class="token number">1e673cbceb82b2144605ea3851ea332c22e8f22c</span> <span class="token ip-address constant">10.10.13.100</span> <span class="token number">26379</span> <span class="token operator">@</span> mymaster <span class="token ip-address constant">10.10.13.100</span> <span class="token number">6379</span>
<span class="token number">6700</span><span class="token operator">:</span>X <span class="token date number">14 Dec 2023</span> <span class="token time number">15:03:15.726</span> <span class="token operator">*</span> <span class="token operator">+</span>sentinel sentinel d0f1410427910f306bccd57e4dbc4efe0a7cbce7 <span class="token ip-address constant">10.10.13.100</span> <span class="token number">26379</span> <span class="token operator">@</span> mymaster <span class="token ip-address constant">10.10.13.100</span> <span class="token number">6379</span>
<span class="token number">6700</span><span class="token operator">:</span>X <span class="token date number">14 Dec 2023</span> <span class="token time number">15:03:15.757</span> <span class="token operator">*</span> <span class="token operator">+</span>sentinel<span class="token operator">-</span>address<span class="token operator">-</span>switch master mymaster <span class="token ip-address constant">10.10.13.100</span> <span class="token number">6379</span> ip <span class="token ip-address constant">10.10.13.100</span> port <span class="token number">26379</span> for <span class="token number">1e673cbceb82b2144605ea3851ea332c22</span>
e8f22c
<span class="token number">6700</span><span class="token operator">:</span>X <span class="token date number">14 Dec 2023</span> <span class="token time number">15:06:27.814</span> <span class="token operator">#</span> <span class="token operator">+</span>sdown master mymaster <span class="token ip-address constant">10.10.13.100</span> <span class="token number">6379</span>
<span class="token number">6700</span><span class="token operator">:</span>X <span class="token date number">14 Dec 2023</span> <span class="token time number">15:06:27.915</span> <span class="token operator">#</span> <span class="token operator">+</span>odown master mymaster <span class="token ip-address constant">10.10.13.100</span> <span class="token number">6379</span> <span class="token operator">#</span>quorum <span class="token number">4</span><span class="token operator">/</span><span class="token number">2</span>
<span class="token number">6700</span><span class="token operator">:</span>X <span class="token date number">14 Dec 2023</span> <span class="token time number">15:06:27.915</span> <span class="token operator">#</span> <span class="token operator">+</span>new<span class="token operator">-</span>epoch <span class="token number">1</span>
<span class="token number">6700</span><span class="token operator">:</span>X <span class="token date number">14 Dec 2023</span> <span class="token time number">15:06:27.915</span> <span class="token operator">#</span> <span class="token operator">+</span>try<span class="token operator">-</span>failover master mymaster <span class="token ip-address constant">10.10.13.100</span> <span class="token number">6379</span>
<span class="token number">6700</span><span class="token operator">:</span>X <span class="token date number">14 Dec 2023</span> <span class="token time number">15:06:27.917</span> <span class="token operator">#</span> <span class="token operator">+</span>vote<span class="token operator">-</span>for<span class="token operator">-</span>leader d0f1410427910f306bccd57e4dbc4efe0a7cbce7 <span class="token number">1</span>
<span class="token number">6700</span><span class="token operator">:</span>X <span class="token date number">14 Dec 2023</span> <span class="token time number">15:06:27.918</span> <span class="token operator">#</span> d0f1410427910f306bccd57e4dbc4efe0a7cbce7 voted for d0f1410427910f306bccd57e4dbc4efe0a7cbce7 <span class="token number">1</span>
<span class="token number">6700</span><span class="token operator">:</span>X <span class="token date number">14 Dec 2023</span> <span class="token time number">15:06:27.918</span> <span class="token operator">#</span> aac0a52219307148edfb34cc0db8ce0003c5a311 voted for d0f1410427910f306bccd57e4dbc4efe0a7cbce7 <span class="token number">1</span>
<span class="token number">6700</span><span class="token operator">:</span>X <span class="token date number">14 Dec 2023</span> <span class="token time number">15:06:27.918</span> <span class="token operator">#</span> <span class="token number">1e673cbceb82b2144605ea3851ea332c22e8f22c</span> voted for d0f1410427910f306bccd57e4dbc4efe0a7cbce7 <span class="token number">1</span>
<span class="token number">6700</span><span class="token operator">:</span>X <span class="token date number">14 Dec 2023</span> <span class="token time number">15:06:27.989</span> <span class="token operator">#</span> <span class="token operator">+</span>elected<span class="token operator">-</span>leader master mymaster <span class="token ip-address constant">10.10.13.100</span> <span class="token number">6379</span>
<span class="token number">6700</span><span class="token operator">:</span>X <span class="token date number">14 Dec 2023</span> <span class="token time number">15:06:27.989</span> <span class="token operator">#</span> <span class="token operator">+</span>failover<span class="token operator">-</span>state<span class="token operator">-</span>select<span class="token operator">-</span>slave master mymaster <span class="token ip-address constant">10.10.13.100</span> <span class="token number">6379</span>
<span class="token number">6700</span><span class="token operator">:</span>X <span class="token date number">14 Dec 2023</span> <span class="token time number">15:06:28.060</span> <span class="token operator">#</span> <span class="token operator">+</span>selected<span class="token operator">-</span>slave slave <span class="token ip-address constant">10.10.13.101</span><span class="token operator">:</span><span class="token number">6379</span> <span class="token ip-address constant">10.10.13.101</span> <span class="token number">6379</span> <span class="token operator">@</span> mymaster <span class="token ip-address constant">10.10.13.100</span> <span class="token number">6379</span>
<span class="token number">6700</span><span class="token operator">:</span>X <span class="token date number">14 Dec 2023</span> <span class="token time number">15:06:28.060</span> <span class="token operator">*</span> <span class="token operator">+</span>failover<span class="token operator">-</span>state<span class="token operator">-</span>send<span class="token operator">-</span>slaveof<span class="token operator">-</span>noone slave <span class="token ip-address constant">10.10.13.101</span><span class="token operator">:</span><span class="token number">6379</span> <span class="token ip-address constant">10.10.13.101</span> <span class="token number">6379</span> <span class="token operator">@</span> mymaster <span class="token ip-address constant">10.10.13.100</span> <span class="token number">6379</span>
<span class="token number">6700</span><span class="token operator">:</span>X <span class="token date number">14 Dec 2023</span> <span class="token time number">15:06:28.114</span> <span class="token operator">*</span> <span class="token operator">+</span>failover<span class="token operator">-</span>state<span class="token operator">-</span>wait<span class="token operator">-</span>promotion slave <span class="token ip-address constant">10.10.13.101</span><span class="token operator">:</span><span class="token number">6379</span> <span class="token ip-address constant">10.10.13.101</span> <span class="token number">6379</span> <span class="token operator">@</span> mymaster <span class="token ip-address constant">10.10.13.100</span> <span class="token number">6379</span>
<span class="token number">6700</span><span class="token operator">:</span>X <span class="token date number">14 Dec 2023</span> <span class="token time number">15:06:28.387</span> <span class="token operator">#</span> <span class="token operator">+</span>promoted<span class="token operator">-</span>slave slave <span class="token ip-address constant">10.10.13.101</span><span class="token operator">:</span><span class="token number">6379</span> <span class="token ip-address constant">10.10.13.101</span> <span class="token number">6379</span> <span class="token operator">@</span> mymaster <span class="token ip-address constant">10.10.13.100</span> <span class="token number">6379</span>
<span class="token number">6700</span><span class="token operator">:</span>X <span class="token date number">14 Dec 2023</span> <span class="token time number">15:06:28.387</span> <span class="token operator">#</span> <span class="token operator">+</span>failover<span class="token operator">-</span>state<span class="token operator">-</span>reconf<span class="token operator">-</span>slaves master mymaster <span class="token ip-address constant">10.10.13.100</span> <span class="token number">6379</span>
<span class="token number">6700</span><span class="token operator">:</span>X <span class="token date number">14 Dec 2023</span> <span class="token time number">15:06:28.437</span> <span class="token operator">*</span> <span class="token operator">+</span>slave<span class="token operator">-</span>reconf<span class="token operator">-</span>sent slave <span class="token ip-address constant">10.10.13.102</span><span class="token operator">:</span><span class="token number">6379</span> <span class="token ip-address constant">10.10.13.102</span> <span class="token number">6379</span> <span class="token operator">@</span> mymaster <span class="token ip-address constant">10.10.13.100</span> <span class="token number">6379</span>
<span class="token number">6700</span><span class="token operator">:</span>X <span class="token date number">14 Dec 2023</span> <span class="token time number">15:06:29.398</span> <span class="token operator">*</span> <span class="token operator">+</span>slave<span class="token operator">-</span>reconf<span class="token operator">-</span>inprog slave <span class="token ip-address constant">10.10.13.102</span><span class="token operator">:</span><span class="token number">6379</span> <span class="token ip-address constant">10.10.13.102</span> <span class="token number">6379</span> <span class="token operator">@</span> mymaster <span class="token ip-address constant">10.10.13.100</span> <span class="token number">6379</span>
<span class="token number">6700</span><span class="token operator">:</span>X <span class="token date number">14 Dec 2023</span> <span class="token time number">15:06:29.398</span> <span class="token operator">*</span> <span class="token operator">+</span>slave<span class="token operator">-</span>reconf<span class="token operator">-</span>done slave <span class="token ip-address constant">10.10.13.102</span><span class="token operator">:</span><span class="token number">6379</span> <span class="token ip-address constant">10.10.13.102</span> <span class="token number">6379</span> <span class="token operator">@</span> mymaster <span class="token ip-address constant">10.10.13.100</span> <span class="token number">6379</span>
<span class="token number">6700</span><span class="token operator">:</span>X <span class="token date number">14 Dec 2023</span> <span class="token time number">15:06:29.464</span> <span class="token operator">#</span> <span class="token operator">+</span>failover<span class="token operator">-</span>end master mymaster <span class="token ip-address constant">10.10.13.100</span> <span class="token number">6379</span>
<span class="token number">6700</span><span class="token operator">:</span>X <span class="token date number">14 Dec 2023</span> <span class="token time number">15:06:29.464</span> <span class="token operator">#</span> <span class="token operator">+</span>switch<span class="token operator">-</span>master mymaster <span class="token ip-address constant">10.10.13.100</span> <span class="token number">6379</span> <span class="token ip-address constant">10.10.13.101</span> <span class="token number">6379</span>
<span class="token number">6700</span><span class="token operator">:</span>X <span class="token date number">14 Dec 2023</span> <span class="token time number">15:06:29.464</span> <span class="token operator">*</span> <span class="token operator">+</span>slave slave <span class="token ip-address constant">10.10.13.102</span><span class="token operator">:</span><span class="token number">6379</span> <span class="token ip-address constant">10.10.13.102</span> <span class="token number">6379</span> <span class="token operator">@</span> mymaster <span class="token ip-address constant">10.10.13.101</span> <span class="token number">6379</span>
<span class="token number">6700</span><span class="token operator">:</span>X <span class="token date number">14 Dec 2023</span> <span class="token time number">15:06:29.464</span> <span class="token operator">*</span> <span class="token operator">+</span>slave slave <span class="token ip-address constant">10.10.13.100</span><span class="token operator">:</span><span class="token number">6379</span> <span class="token ip-address constant">10.10.13.100</span> <span class="token number">6379</span> <span class="token operator">@</span> mymaster <span class="token ip-address constant">10.10.13.101</span> <span class="token number">6379</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通过日志<code>+switch-master mymaster 10.10.13.100 6379 10.10.13.101 6379</code>发现主节点切换到<code>10.10.13.101</code></p><ul><li>登陆新的主库 查看是否成功转为主库</li></ul><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>/usr/local/redis/src/redis-cli <span class="token parameter variable">-a</span> <span class="token string">&quot;Hello@2023&quot;</span> <span class="token parameter variable">-h</span> <span class="token number">10.10</span>.13.101 <span class="token parameter variable">-p</span> <span class="token number">6379</span> info replication
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>显示结果：</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@node1 ~<span class="token punctuation">]</span><span class="token comment"># /usr/local/redis/src/redis-cli -a &quot;Hello@2023&quot; -h 10.10.13.101 -p 6379 info replication</span>
Warning: Using a password with <span class="token string">&#39;-a&#39;</span> or <span class="token string">&#39;-u&#39;</span> option on the <span class="token builtin class-name">command</span> line interface may not be safe.
<span class="token comment"># Replication</span>
role:master
connected_slaves:1
slave0:ip<span class="token operator">=</span><span class="token number">10.10</span>.13.102,port<span class="token operator">=</span><span class="token number">6379</span>,state<span class="token operator">=</span>online,offset<span class="token operator">=</span><span class="token number">67176</span>,lag<span class="token operator">=</span><span class="token number">1</span>
master_failover_state:no-failover
master_replid:2c0101c3e6a6ab30115d43330abe67997d2b7d05
master_replid2:959b39064e94eb5ff8ce1bb043ede3dc11520648
master_repl_offset:67315
second_repl_offset:29094
repl_backlog_active:1
repl_backlog_size:1048576
repl_backlog_first_byte_offset:1
repl_backlog_histlen:67315
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>启动原主库:</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>/usr/local/redis/src/redis-server /usr/local/redis/redis.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>再次在新主库上查看集群信息：</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@node1 ~<span class="token punctuation">]</span><span class="token comment"># /usr/local/redis/src/redis-cli -a &quot;Hello@2023&quot;  -p 6379 info replication</span>
Warning: Using a password with <span class="token string">&#39;-a&#39;</span> or <span class="token string">&#39;-u&#39;</span> option on the <span class="token builtin class-name">command</span> line interface may not be safe.
<span class="token comment"># Replication</span>
role:master
connected_slaves:2
slave0:ip<span class="token operator">=</span><span class="token number">10.10</span>.13.102,port<span class="token operator">=</span><span class="token number">6379</span>,state<span class="token operator">=</span>online,offset<span class="token operator">=</span><span class="token number">102187</span>,lag<span class="token operator">=</span><span class="token number">0</span>
slave1:ip<span class="token operator">=</span><span class="token number">10.10</span>.13.100,port<span class="token operator">=</span><span class="token number">6379</span>,state<span class="token operator">=</span>online,offset<span class="token operator">=</span><span class="token number">102465</span>,lag<span class="token operator">=</span><span class="token number">0</span>
master_failover_state:no-failover
master_replid:2c0101c3e6a6ab30115d43330abe67997d2b7d05
master_replid2:959b39064e94eb5ff8ce1bb043ede3dc11520648
master_repl_offset:102465
second_repl_offset:29094
repl_backlog_active:1
repl_backlog_size:1048576
repl_backlog_first_byte_offset:1
repl_backlog_histlen:102465
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>已经看到原主库已经以从库的身份加入集群。</p>`,38);function D(X,w){const t=p("CodeTabs");return c(),d("div",null,[b,r(t,{id:"208",data:[{id:"手动配置"},{id:"自动配置"}],active:0},{title0:a(({value:e,isActive:l})=>[n("手动配置")]),title1:a(({value:e,isActive:l})=>[n("自动配置")]),tab0:a(({value:e,isActive:l})=>[k]),tab1:a(({value:e,isActive:l})=>[v]),_:1}),h,r(t,{id:"223",data:[{id:"手动配置"},{id:"自动配置"}],active:0},{title0:a(({value:e,isActive:l})=>[n("手动配置")]),title1:a(({value:e,isActive:l})=>[n("自动配置")]),tab0:a(({value:e,isActive:l})=>[g]),tab1:a(({value:e,isActive:l})=>[f]),_:1}),_,r(t,{id:"349",data:[{id:"手动配置"},{id:"自动配置"}],active:0},{title0:a(({value:e,isActive:l})=>[n("手动配置")]),title1:a(({value:e,isActive:l})=>[n("自动配置")]),tab0:a(({value:e,isActive:l})=>[y]),tab1:a(({value:e,isActive:l})=>[x]),_:1}),q])}const H=o(m,[["render",D],["__file","redis-ha-master-slave-with-sentinel.html.vue"]]),z=JSON.parse('{"path":"/guide/database/redis/ha/deployment/redis-ha-master-slave-with-sentinel.html","title":"Redis 主从集群+哨兵模式搭建","lang":"zh-CN","frontmatter":{"title":"Redis 主从集群+哨兵模式搭建","description":"主机准备 拓扑架构 主从+哨兵架构图主从+哨兵架构图 主机信息 主机设置 主机名称设置 主机hosts设置 所有节点 关闭防火墙 所有节点 selinux设置 所有节点 安装依赖 安装和配置Redis主从 安装Redis 所有节点 下载redis 安装redis 配置启动服务(可选) 使用systemd管理redis服务 启动redis 主从配置 主库...","head":[["meta",{"property":"og:url","content":"https://github.com/abelit/abelit-datapeacock.git/guide/database/redis/ha/deployment/redis-ha-master-slave-with-sentinel.html"}],["meta",{"property":"og:site_name","content":"数之雀"}],["meta",{"property":"og:title","content":"Redis 主从集群+哨兵模式搭建"}],["meta",{"property":"og:description","content":"主机准备 拓扑架构 主从+哨兵架构图主从+哨兵架构图 主机信息 主机设置 主机名称设置 主机hosts设置 所有节点 关闭防火墙 所有节点 selinux设置 所有节点 安装依赖 安装和配置Redis主从 安装Redis 所有节点 下载redis 安装redis 配置启动服务(可选) 使用systemd管理redis服务 启动redis 主从配置 主库..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-05-11T14:06:18.000Z"}],["meta",{"property":"article:author","content":"Abelit"}],["meta",{"property":"article:modified_time","content":"2024-05-11T14:06:18.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Redis 主从集群+哨兵模式搭建\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2024-05-11T14:06:18.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Abelit\\",\\"url\\":\\"https://github.com/abelit\\"}]}"]]},"headers":[{"level":2,"title":"主机准备","slug":"主机准备","link":"#主机准备","children":[{"level":3,"title":"拓扑架构","slug":"拓扑架构","link":"#拓扑架构","children":[]},{"level":3,"title":"主机信息","slug":"主机信息","link":"#主机信息","children":[]},{"level":3,"title":"主机设置","slug":"主机设置","link":"#主机设置","children":[]},{"level":3,"title":"安装依赖","slug":"安装依赖","link":"#安装依赖","children":[]}]},{"level":2,"title":"安装和配置Redis主从","slug":"安装和配置redis主从","link":"#安装和配置redis主从","children":[{"level":3,"title":"安装Redis","slug":"安装redis","link":"#安装redis","children":[]},{"level":3,"title":"配置启动服务(可选)","slug":"配置启动服务-可选","link":"#配置启动服务-可选","children":[]},{"level":3,"title":"主从配置","slug":"主从配置","link":"#主从配置","children":[]},{"level":3,"title":"启动服务","slug":"启动服务","link":"#启动服务","children":[]}]},{"level":2,"title":"主从管理","slug":"主从管理","link":"#主从管理","children":[{"level":3,"title":"主从状态检查","slug":"主从状态检查","link":"#主从状态检查","children":[]}]},{"level":2,"title":"数据同步测试","slug":"数据同步测试","link":"#数据同步测试","children":[{"level":3,"title":"关闭redis服务","slug":"关闭redis服务","link":"#关闭redis服务","children":[]},{"level":3,"title":"启动redis服务","slug":"启动redis服务","link":"#启动redis服务","children":[]}]},{"level":2,"title":"哨兵集群搭建","slug":"哨兵集群搭建","link":"#哨兵集群搭建","children":[{"level":3,"title":"配置哨兵","slug":"配置哨兵","link":"#配置哨兵","children":[]},{"level":3,"title":"启动哨兵","slug":"启动哨兵","link":"#启动哨兵","children":[]},{"level":3,"title":"状态查看","slug":"状态查看","link":"#状态查看","children":[]}]},{"level":2,"title":"主从切换","slug":"主从切换","link":"#主从切换","children":[{"level":3,"title":"手动switchover","slug":"手动switchover","link":"#手动switchover","children":[]},{"level":3,"title":"故障切换","slug":"故障切换","link":"#故障切换","children":[]}]}],"git":{"createdTime":1715436378000,"updatedTime":1715436378000,"contributors":[{"name":"ableit","email":"ychenid@live.com","commits":1}]},"readingTime":{"minutes":8.93,"words":2679},"filePathRelative":"guide/database/redis/ha/deployment/redis-ha-master-slave-with-sentinel.md","localizedDate":"2024年5月11日","autoDesc":true,"excerpt":"<h2>主机准备</h2>\\n<h3>拓扑架构</h3>\\n<figure><figcaption>主从+哨兵架构图</figcaption></figure>\\n<h3>主机信息</h3>\\n<table>\\n<thead>\\n<tr>\\n<th>编号</th>\\n<th>IP 地址</th>\\n<th>角色</th>\\n<th>操作系统</th>\\n<th>内核版本</th>\\n<th>数据库版本</th>\\n</tr>\\n</thead>\\n<tbody>\\n<tr>\\n<td>1</td>\\n<td>10.10.13.100</td>\\n<td>redis主、sentinel</td>\\n<td>CentOS 7.9</td>\\n<td>3.10.0-1160.el7.x86_64</td>\\n<td>7.0.14/6.2.14</td>\\n</tr>\\n<tr>\\n<td>2</td>\\n<td>10.10.13.101</td>\\n<td>redis从、sentinel</td>\\n<td>CentOS 7.9</td>\\n<td>3.10.0-1160.el7.x86_64</td>\\n<td>7.0.14/6.2.14</td>\\n</tr>\\n<tr>\\n<td>3</td>\\n<td>10.10.13.102</td>\\n<td>redis从、sentinel</td>\\n<td>CentOS 7.9</td>\\n<td>3.10.0-1160.el7.x86_64</td>\\n<td>7.0.14/6.2.14</td>\\n</tr>\\n</tbody>\\n</table>"}');export{H as comp,z as data};
