import{_ as u}from"./plugin-vue_export-helper-DlAUqK2U.js";import{r as o,o as r,c as d,a as s,d as n,b as p,w as a,f as l}from"./app-DR5J2daJ.js";const k="/assets/tgsql_vm_065-C-UT_2U-.png",v="/assets/tgsql_vm_025-DXGHeNCg.png",m="/assets/sql_profile-BK58V-ws.gif",b="/assets/sql_profile_api-BHMXKiDD.gif",_="/assets/tgsql_vm_050-B_XU0KBD.png",S="/assets/tgsql_vm_057-DE1mRE_h.png",g="/assets/tgsql_vm_059-DY16YYzP.png",E="/assets/tgsql_vm_062-CzLWVGOz.png",A="/assets/tgsql_vm_063-5UFGcZak.png",T="/assets/tgsql_vm_061-D5DM6VDa.png",q="/assets/tgsql_vm_064-FUgzjDP9.png",L="/assets/tgsql_vm_026-CQ2zywBw.png",h="/assets/tgsql_vm_029-B4sRv3Fz.png",R="/assets/tgsql_vm_067-X3Q9LE24.png",y="/assets/mm-3198_tgsql_pb_001b-B8puaDDs.png",w={},N=l('<h2 id="自动-sql-调优介绍" tabindex="-1"><a class="header-anchor" href="#自动-sql-调优介绍"><span>自动 SQL 调优介绍</span></a></h2><p>Oracle数据库使用优化器为提交的SQL语句生成执行计划。这优化器以以下模式运行：</p><ul><li>正常模式</li></ul><p>优化器编译SQL并生成执行计划。普通模式为绝大多数SQL语句生成合理的计划。在正常模式下，优化器的运行时间限制非常严格，通常是几分之一秒。</p><ul><li>调优模式</li></ul><p>优化器执行额外的分析来检查是否可以进一步改进在正常模式下生成的计划。优化器输出不是执行计划，而是一系列操作，以及生成明显更好的计划的基本原理和预期收益。当在调优模式下运行时，优化器被称为自动调整优化器。</p><p>在调优模式下，优化器可能需要几分钟的时间来调优单个语句。每次必须对查询进行硬解析时，调用自动调优优化器既耗费时间又耗费资源。自动调优优化器适用于对数据库产生重大影响的复杂且高负载的 SQL 语句。</p><h3 id="自动调优主要功能" tabindex="-1"><a class="header-anchor" href="#自动调优主要功能"><span>自动调优主要功能</span></a></h3><p>自动调优优化器执行以下类型的调优分析：</p><ul><li><p>统计分析 优化器依靠对象统计信息来生成执行计划。如果这些统计信息过时或丢失，则优化器没有所需的必要信息，并且可能会生成不良的执行计划。自动调优优化器检查每个查询对象是否有丢失或过时的统计信息。</p></li><li><p>SQL 分析 SQL 配置文件是一组特定于 SQL 语句的辅助信息。从概念上讲，SQL 配置文件对于 SQL 语句来说就像统计信息对于表或索引一样。数据库可以使用辅助信息来改进执行计划。</p></li><li><p>访问路径分析 由于自动调优优化器不会分析其索引建议如何影响整个 SQL 工作负载，因此它还建议对 SQL 语句以及代表性 SQL 工作负载运行 SQL Access Advisor。</p></li><li><p>SQL结构分析 自动调优优化器可识别 SQL 语句结构中可能导致性能不佳的常见问题。这些可能是句法、语义或设计问题。在每种情况下，自动调优优化器都会提出相关建议来重组语句。</p></li><li><p>执行计划分析 在调整 SQL 语句时，SQL Tuning Advisor 会搜索实时和历史性能数据以查找该语句的替代执行计划。如果存在原始计划以外的计划，则 SQL Tuning Advisor 会报告替代计划的发现结果。</p></li></ul><p>SQL Tuning Advisor 验证替代执行计划并记录任何不可重现的计划。当找到可重现的替代计划时，您可以创建 SQL 计划基线来指示优化器将来选择这些计划。</p><h2 id="sql优化集" tabindex="-1"><a class="header-anchor" href="#sql优化集"><span>SQL优化集</span></a></h2>',12),Q={href:"https://docs.oracle.com/en/database/oracle/oracle-database/19/tgsql/managing-sql-tuning-sets.html",target:"_blank",rel:"noopener noreferrer"},O=l('<p>SQL 调优集 (STS)是一种数据库对象，其中包括一个或多个 SQL 语句及其执行统计信息和执行上下文，并且可能包括用户优先级排名。您可以从不同的 SQL 源（例如 AWR、共享 SQL 区或用户提供的自定义 SQL）将 SQL 语句加载到 SQL 调优集中。STS 包括：</p><ul><li><p>一组SQL语句</p></li><li><p>关联的执行上下文，例如用户模式、应用程序模块名称和操作、绑定值列表以及游标编​​译环境</p></li><li><p>相关的基本执行统计信息，例如已用时间、CPU 时间、缓冲区获取、磁盘读取、处理的行、游标获取、执行次数、完整执行次数、优化器成本和命令类型</p></li><li><p>每个SQL语句的关联执行计划和行源统计信息（可选）</p></li></ul><p><strong>SQL 调优集实现以下目标</strong></p><ul><li><p>向性能调优顾问提供输入</p></li><li><p>您可以使用 STS 作为多个数据库顾问程序的输入，包括 SQL 优化顾问程序、SQL 访问顾问程序和 SQL 性能分析器。</p></li><li><p>在数据库之间传输 SQL</p></li><li><p>将 SQL 调优集从一个数据库导出到另一个数据库，从而能够在数据库之间传输 SQL 工作负载以进行远程性能诊断和调优。当生产数据库上出现执行不理想的 SQL 语句时，开发人员可能不想直接在生产数据库上进行调查和调整。DBA 可以将有问题的 SQL 语句传输到测试数据库，开发人员可以在其中安全地分析和调整它们。</p></li></ul><p>STS调优集: <img src="'+k+'" alt="STS调优集" loading="lazy"></p><p>STS调优集API: <img src="'+v+`" alt="STS调优集API" loading="lazy"></p><h3 id="创建-sql-调优集" tabindex="-1"><a class="header-anchor" href="#创建-sql-调优集"><span>创建 SQL 调优集</span></a></h3><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">BEGIN</span>
  DBMS_SQLTUNE<span class="token punctuation">.</span>CREATE_SQLSET<span class="token punctuation">(</span>
    sqlset_name <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&#39;my_sql_tuning_set&#39;</span><span class="token punctuation">,</span> 
    description  <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&#39;I/O intensive workload&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">END</span><span class="token punctuation">;</span>
<span class="token operator">/</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="查看-sql-调优集状态" tabindex="-1"><a class="header-anchor" href="#查看-sql-调优集状态"><span>查看 SQL 调优集状态</span></a></h3><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">COLUMN</span> NAME FORMAT a20
<span class="token keyword">COLUMN</span> COUNT FORMAT <span class="token number">99999</span>
<span class="token keyword">COLUMN</span> DESCRIPTION FORMAT a11

<span class="token keyword">SELECT</span> NAME<span class="token punctuation">,</span> STATEMENT_COUNT <span class="token keyword">AS</span> <span class="token string">&quot;SQLCNT&quot;</span><span class="token punctuation">,</span> DESCRIPTION
<span class="token keyword">FROM</span>   USER_SQLSET<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="加载-sql-调优集" tabindex="-1"><a class="header-anchor" href="#加载-sql-调优集"><span>加载 SQL 调优集</span></a></h3><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">DECLARE</span>
 baseline_cursor DBMS_SQLTUNE<span class="token punctuation">.</span>SQLSET_CURSOR<span class="token punctuation">;</span>
<span class="token keyword">BEGIN</span>
 <span class="token keyword">OPEN</span> baseline_cursor <span class="token keyword">FOR</span>
    <span class="token keyword">SELECT</span> <span class="token keyword">VALUE</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span>
    <span class="token keyword">FROM</span> <span class="token keyword">TABLE</span> <span class="token punctuation">(</span>DBMS_SQLTUNE<span class="token punctuation">.</span>SELECT_WORKLOAD_REPOSITORY<span class="token punctuation">(</span>
                  <span class="token string">&#39;peak baseline&#39;</span><span class="token punctuation">,</span>
                   <span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
                   <span class="token string">&#39;elapsed_time&#39;</span><span class="token punctuation">,</span>
                   <span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
                   <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span> p<span class="token punctuation">;</span>

    DBMS_SQLTUNE<span class="token punctuation">.</span>LOAD_SQLSET<span class="token punctuation">(</span>
             sqlset_name     <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&#39;my_sql_tuning_set&#39;</span><span class="token punctuation">,</span>
             populate_cursor <span class="token operator">=</span><span class="token operator">&gt;</span> baseline_cursor<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">END</span><span class="token punctuation">;</span>
<span class="token operator">/</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="查询-sql-调优集" tabindex="-1"><a class="header-anchor" href="#查询-sql-调优集"><span>查询 SQL 调优集</span></a></h3>`,13),D=s("div",{class:"language-sql line-numbers-mode","data-ext":"sql","data-title":"sql"},[s("pre",{class:"language-sql"},[s("code",null,[s("span",{class:"token keyword"},"COLUMN"),n(` SQL_TEXT FORMAT a30   
`),s("span",{class:"token keyword"},"COLUMN"),n(` SCH FORMAT a3
`),s("span",{class:"token keyword"},"COLUMN"),n(" ELAPSED FORMAT "),s("span",{class:"token number"},"999999999"),n(`

`),s("span",{class:"token keyword"},"SELECT"),n(" SQL_ID"),s("span",{class:"token punctuation"},","),n(" PARSING_SCHEMA_NAME "),s("span",{class:"token keyword"},"AS"),n(),s("span",{class:"token string"},'"SCH"'),s("span",{class:"token punctuation"},","),n(" SQL_TEXT"),s("span",{class:"token punctuation"},","),n(` 
       ELAPSED_TIME `),s("span",{class:"token keyword"},"AS"),n(),s("span",{class:"token string"},'"ELAPSED"'),s("span",{class:"token punctuation"},","),n(` BUFFER_GETS
`),s("span",{class:"token keyword"},"FROM"),n("   "),s("span",{class:"token keyword"},"TABLE"),s("span",{class:"token punctuation"},"("),n(" DBMS_SQLTUNE"),s("span",{class:"token punctuation"},"."),n("SELECT_SQLSET"),s("span",{class:"token punctuation"},"("),n(),s("span",{class:"token string"},"'my_sql_tuning_set'"),n(),s("span",{class:"token punctuation"},")"),n(),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},";"),n(`
`)])]),s("div",{class:"line-numbers","aria-hidden":"true"},[s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"})])],-1),M=s("div",{class:"language-sql line-numbers-mode","data-ext":"sql","data-title":"sql"},[s("pre",{class:"language-sql"},[s("code",null,[s("span",{class:"token keyword"},"COLUMN"),n(` SQL_TEXT FORMAT a30   
`),s("span",{class:"token keyword"},"COLUMN"),n(` SCH FORMAT a3
`),s("span",{class:"token keyword"},"COLUMN"),n(" BUF_GETS FORMAT "),s("span",{class:"token number"},"99999999"),n(`
`),s("span",{class:"token keyword"},"COLUMN"),n(" DISK_READS FORMAT "),s("span",{class:"token number"},"99999999"),n(`
`),s("span",{class:"token keyword"},"COLUMN"),n(),s("span",{class:"token operator"},"%"),n("_DISK FORMAT "),s("span",{class:"token number"},"9999.99"),n(`
`),s("span",{class:"token keyword"},"SELECT"),n(" sql_id"),s("span",{class:"token punctuation"},","),n(" parsing_schema_name "),s("span",{class:"token keyword"},"as"),n(),s("span",{class:"token string"},'"SCH"'),s("span",{class:"token punctuation"},","),n(" sql_text"),s("span",{class:"token punctuation"},","),n(` 
       buffer_gets `),s("span",{class:"token keyword"},"as"),n(),s("span",{class:"token string"},'"B_GETS"'),s("span",{class:"token punctuation"},","),n(`
       disk_reads `),s("span",{class:"token keyword"},"as"),n(),s("span",{class:"token string"},'"DR"'),s("span",{class:"token punctuation"},","),n(),s("span",{class:"token function"},"ROUND"),s("span",{class:"token punctuation"},"("),n("disk_reads"),s("span",{class:"token operator"},"/"),n("buffer_gets"),s("span",{class:"token operator"},"*"),s("span",{class:"token number"},"100"),s("span",{class:"token punctuation"},","),s("span",{class:"token number"},"2"),s("span",{class:"token punctuation"},")"),n(),s("span",{class:"token string"},'"%_DISK"'),n(`
`),s("span",{class:"token keyword"},"FROM"),n(),s("span",{class:"token keyword"},"TABLE"),s("span",{class:"token punctuation"},"("),n(" DBMS_SQLTUNE"),s("span",{class:"token punctuation"},"."),n("SELECT_SQLSET"),s("span",{class:"token punctuation"},"("),n(` 
            `),s("span",{class:"token string"},"'my_sql_tuning_set'"),s("span",{class:"token punctuation"},","),n(`
            `),s("span",{class:"token string"},"'(disk_reads/buffer_gets) >= 0.50'"),n(),s("span",{class:"token punctuation"},")"),n(),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},";"),n(`
`)])]),s("div",{class:"line-numbers","aria-hidden":"true"},[s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"})])],-1),U=l(`<h3 id="修改sql调优集" tabindex="-1"><a class="header-anchor" href="#修改sql调优集"><span>修改SQL调优集</span></a></h3><ul><li>根据用户指定的条件删除 SQL 语句</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">BEGIN</span>
  DBMS_SQLTUNE<span class="token punctuation">.</span>DELETE_SQLSET<span class="token punctuation">(</span>
      sqlset_name  <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&#39;my_sql_tuning_set&#39;</span><span class="token punctuation">,</span>
      basic_filter <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&#39;executions &lt; 50&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">END</span><span class="token punctuation">;</span>
<span class="token operator">/</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>设置 SQL 语句的属性值</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">BEGIN</span>
  DBMS_SQLSET<span class="token punctuation">.</span>UPDATE_SQLSET <span class="token punctuation">(</span> 
      sqlset_name     <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&#39;SQLT_WKLD_STS&#39;</span>    
<span class="token punctuation">,</span>     sql_id          <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&#39;2cqsw036j5u7r&#39;</span>    
<span class="token punctuation">,</span>     attribute_name  <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&#39;PRIORITY&#39;</span>         
<span class="token punctuation">,</span>     attribute_value <span class="token operator">=</span><span class="token operator">&gt;</span>  <span class="token number">1</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">END</span><span class="token punctuation">;</span>
<span class="token operator">/</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="传输-sql-调优集" tabindex="-1"><a class="header-anchor" href="#传输-sql-调优集"><span>传输 SQL 调优集</span></a></h3><ol><li>使用该CREATE_STGTAB_SQLSET过程创建将导出 SQL 调整集的临时表。</li></ol><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">BEGIN</span>
  DBMS_SQLTUNE<span class="token punctuation">.</span>create_stgtab_sqlset<span class="token punctuation">(</span> 
    table_name  <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&#39;my_10g_staging_table&#39;</span><span class="token punctuation">,</span>
    schema_name <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&#39;dba1&#39;</span><span class="token punctuation">,</span>
    db_version  <span class="token operator">=</span><span class="token operator">&gt;</span> DBMS_SQLTUNE<span class="token punctuation">.</span>STS_STGTAB_10_2_VERSION <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">END</span><span class="token punctuation">;</span>
<span class="token operator">/</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>使用该PACK_STGTAB_SQLSET过程将 SQL 调整集导出到临时表中。</li></ol><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">BEGIN</span>
  DBMS_SQLTUNE<span class="token punctuation">.</span>pack_stgtab_sqlset<span class="token punctuation">(</span>      
    sqlset_name          <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&#39;my_sts&#39;</span><span class="token punctuation">,</span>     
    sqlset_owner         <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&#39;hr&#39;</span><span class="token punctuation">,</span>     
    staging_table_name   <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&#39;my_10g_staging_table&#39;</span><span class="token punctuation">,</span>
    staging_schema_owner <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&#39;dba1&#39;</span><span class="token punctuation">,</span>
    db_version           <span class="token operator">=</span><span class="token operator">&gt;</span> DBMS_SQLTUNE<span class="token punctuation">.</span>STS_STGTAB_10_2_VERSION <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">END</span><span class="token punctuation">;</span>
<span class="token operator">/</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li><p>将临时表移动到将使用所选机制（例如 Oracle Data Pump 或数据库链接）导入 SQL 调优集的数据库。</p></li><li><p>在将导入 SQL 调整集的数据库上，使用过程UNPACK_STGTAB_SQLSET从临时表导入 SQL 调整集。</p></li></ol><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">BEGIN</span>
  DBMS_SQLTUNE<span class="token punctuation">.</span>UNPACK_STGTAB_SQLSET<span class="token punctuation">(</span>
      sqlset_name  <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&#39;%&#39;</span><span class="token punctuation">,</span>
      <span class="token keyword">replace</span>  <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span>
      staging_table_name <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&#39;my_10g_staging_table&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">END</span><span class="token punctuation">;</span>
<span class="token operator">/</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="删除-sql-调优集" tabindex="-1"><a class="header-anchor" href="#删除-sql-调优集"><span>删除 SQL 调优集</span></a></h3><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">BEGIN</span>
  DBMS_SQLTUNE<span class="token punctuation">.</span>DROP_SQLSET<span class="token punctuation">(</span> sqlset_name <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&#39;my_sql_tuning_set&#39;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">END</span><span class="token punctuation">;</span>
<span class="token operator">/</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="sql配置文件" tabindex="-1"><a class="header-anchor" href="#sql配置文件"><span>SQL配置文件</span></a></h2><p>SQL 配置文件是一组特定于 SQL 语句的辅助信息。</p><p>SQL 配置文件包含对自动 SQL 调优期间发现的不良优化器估计的更正。此信息可以改进优化器基数和选择性估计，从而引导优化器选择更好的计划。</p><p>SQL 配置文件不包含有关各个执行计划的信息。相反，优化器在选择计划时具有以下信息来源：</p><ul><li><p>环境，包含数据库配置、绑定变量值、优化器统计信息、数据集等</p></li><li><p>SQL配置文件中的补充统计信息</p></li></ul><p>如果环境或 SQL 配置文件发生变化，优化器可以创建新计划。</p><p>您可以在有或没有 SQL 计划管理的情况下使用 SQL 配置文件。如果您使用 SQL 计划管理，则优化器选择的计划必须是启用的计划基线。如果语句在基线中有多个计划，则配置文件仍然有用，因为它使优化器能够选择基线中成本最低的计划。</p><p>SQL配置文件: <img src="`+m+'" alt="SQL配置文件" loading="lazy"></p><p>SQL配置文件API: <img src="'+b+`" alt="SQL配置文件API" loading="lazy"></p><h3 id="接受sql配置建议" tabindex="-1"><a class="header-anchor" href="#接受sql配置建议"><span>接受SQL配置建议</span></a></h3><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">DECLARE</span>
  my_sqlprofile_name VARCHAR2<span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">BEGIN</span>
  my_sqlprofile_name :<span class="token operator">=</span> DBMS_SQLTUNE<span class="token punctuation">.</span>ACCEPT_SQL_PROFILE <span class="token punctuation">(</span> 
    task_name    <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&#39;my_sql_tuning_task&#39;</span><span class="token punctuation">,</span>
    name         <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&#39;my_sql_profile&#39;</span><span class="token punctuation">,</span>
    profile_type <span class="token operator">=</span><span class="token operator">&gt;</span> DBMS_SQLTUNE<span class="token punctuation">.</span>PX_PROFILE<span class="token punctuation">,</span>
    force_match  <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token boolean">TRUE</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">END</span><span class="token punctuation">;</span>
<span class="token operator">/</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="修改sql配置" tabindex="-1"><a class="header-anchor" href="#修改sql配置"><span>修改SQL配置</span></a></h3><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">BEGIN</span>
  DBMS_SQLTUNE<span class="token punctuation">.</span>ALTER_SQL_PROFILE<span class="token punctuation">(</span>
    name            <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&#39;my_sql_profile&#39;</span><span class="token punctuation">,</span> 
    attribute_name  <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&#39;STATUS&#39;</span><span class="token punctuation">,</span> 
    <span class="token keyword">value</span>           <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&#39;DISABLED&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">END</span><span class="token punctuation">;</span>
<span class="token operator">/</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="删除sql配置" tabindex="-1"><a class="header-anchor" href="#删除sql配置"><span>删除SQL配置</span></a></h3><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">BEGIN</span>
  DBMS_SQLTUNE<span class="token punctuation">.</span>DROP_SQL_PROFILE<span class="token punctuation">(</span> name <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&#39;my_sql_profile&#39;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">END</span><span class="token punctuation">;</span>
<span class="token operator">/</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="传输sql配置" tabindex="-1"><a class="header-anchor" href="#传输sql配置"><span>传输SQL配置</span></a></h3><ol><li>使用该CREATE_STGTAB_SQLPROF过程创建将导出 SQL 配置文件的临时表。</li></ol><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">BEGIN</span>
  DBMS_SQLTUNE<span class="token punctuation">.</span>create_stgtab_sqlprof<span class="token punctuation">(</span> 
    table_name  <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&#39;my_staging_table&#39;</span><span class="token punctuation">,</span>
    schema_name <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&#39;DBA1&#39;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">END</span><span class="token punctuation">;</span>
<span class="token operator">/</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>使用该PACK_STGTAB_SQLPROF过程将 SQL 配置文件导出到临时表中。</li></ol><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">BEGIN</span>
  DBMS_SQLTUNE<span class="token punctuation">.</span>pack_stgtab_sqlprof<span class="token punctuation">(</span>      
    profile_name         <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&#39;my_profile&#39;</span><span class="token punctuation">,</span>   
    staging_table_name   <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&#39;my_staging_table&#39;</span><span class="token punctuation">,</span>
    staging_schema_owner <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&#39;dba1&#39;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">END</span><span class="token punctuation">;</span>
<span class="token operator">/</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li><p>将临时表移动到将使用所选机制（例如 Oracle Data Pump 或数据库链接）导入 SQL 配置文件的数据库。</p></li><li><p>在将导入 SQL 配置文件的数据库上，使用过程UNPACK_STGTAB_SQLPROF从临时表导入 SQL 配置文件。</p></li></ol><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">BEGIN</span>
  DBMS_SQLTUNE<span class="token punctuation">.</span>UNPACK_STGTAB_SQLPROF<span class="token punctuation">(</span>
      <span class="token keyword">replace</span>  <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span>
      staging_table_name <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&#39;my_staging_table&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">END</span><span class="token punctuation">;</span>
<span class="token operator">/</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="sql-tuning-advisor" tabindex="-1"><a class="header-anchor" href="#sql-tuning-advisor"><span>SQL Tuning Advisor</span></a></h2><h3 id="sql-tuning-advisor架构" tabindex="-1"><a class="header-anchor" href="#sql-tuning-advisor架构"><span>SQL Tuning Advisor架构</span></a></h3><figure><img src="`+_+'" alt="SQL Tuning Advisor架构" tabindex="0" loading="lazy"><figcaption>SQL Tuning Advisor架构</figcaption></figure><h4 id="sql-tuning-advisor-的输入" tabindex="-1"><a class="header-anchor" href="#sql-tuning-advisor-的输入"><span>SQL Tuning Advisor 的输入:</span></a></h4><ul><li>自动数据库诊断监视器 (ADDM)</li><li>AWR</li><li>共享SQL区</li><li>SQL调优集</li></ul><h4 id="sql-tuning-advisor-的输出" tabindex="-1"><a class="header-anchor" href="#sql-tuning-advisor-的输出"><span>SQL Tuning Advisor 的输出:</span></a></h4><ul><li>优化执行计划的建议</li><li>建议优化的理由</li><li>预计性能收益</li><li>执行建议的 SQL 语句</li></ul><h4 id="自动调优优化器分析" tabindex="-1"><a class="header-anchor" href="#自动调优优化器分析"><span>自动调优优化器分析</span></a></h4><p>优化器依靠统计数据来生成执行计划。 <img src="'+S+'" alt="自动调优优化器分析" loading="lazy"></p><h5 id="统计分析" tabindex="-1"><a class="header-anchor" href="#统计分析"><span>统计分析</span></a></h5><figure><img src="'+g+'" alt="自动调优优化器的统计分析" tabindex="0" loading="lazy"><figcaption>自动调优优化器的统计分析</figcaption></figure><h5 id="sql-分析" tabindex="-1"><a class="header-anchor" href="#sql-分析"><span>SQL 分析</span></a></h5><p>SQL 分析是自动调优优化器对其自身估计的验证。</p><p>通过检查执行历史记录和测试 SQL，优化器可以确保它具有可用于生成执行计划的最准确的信息。SQL 分析与生成 SQL Tuning Advisor 建议和实施这些建议的步骤相关但又不同。</p><p>SQL Tuning Advisor 可以分析以下类型的语句：</p><ul><li><p>DML 语句（SELECT、INSERT带有SELECT子句、UPDATE、DELETE、以及 的更新或插入操作MERGE）</p></li><li><p>CREATE TABLE语句（仅与AS SELECT子句一起使用）</p></li></ul><p>执行分析后，SQL Tuning Advisor 会建议或不建议实施 SQL 配置文件。</p><figure><img src="'+E+'" alt="SQL分析" tabindex="0" loading="lazy"><figcaption>SQL分析</figcaption></figure><h5 id="访问路径分析" tabindex="-1"><a class="header-anchor" href="#访问路径分析"><span>访问路径分析</span></a></h5><p>访问路径是数据库检索数据的方式。 <img src="'+A+'" alt="访问路径分析" loading="lazy"></p><h5 id="sql结构分析" tabindex="-1"><a class="header-anchor" href="#sql结构分析"><span>SQL结构分析</span></a></h5><p>在结构分析过程中，自动调优优化器会尝试识别可能导致性能不佳的语法、语义或设计问题。目标是识别写得不好的 SQL 语句并建议您如何重组它们。</p><figure><img src="'+T+'" alt="SQL结构分析" tabindex="0" loading="lazy"><figcaption>SQL结构分析</figcaption></figure><p>自动调优优化器识别出以下类别的结构问题：</p><ul><li>SQL 构造函数的使用效率低下</li></ul><p>执行效果欠佳的语句可能正在使用NOT IN代替NOT EXISTS或UNION代替UNION ALL。UNION与 运算符相反，该UNION ALL运算符使用唯一排序来确保结果集中不存在重复行。如果您知道两个查询不会返回重复项，则使用UNION ALL。</p><ul><li>数据类型不匹配</li></ul><p>如果索引列和比较值的数据类型不匹配，则由于隐式数据类型转换，数据库不会使用索引。此外，数据库必须花费额外的资源来转换数据类型，并且某些 SQL 语句可能会因为数据值未正确转换而失败。</p><ul><li>设计错误</li></ul><p>设计错误的一个典型例子是缺少连接条件。如果n是查询块中的表数，则必须存在n -1 个连接条件以避免笛卡尔积。</p><h5 id="替代计划分析" tabindex="-1"><a class="header-anchor" href="#替代计划分析"><span>替代计划分析</span></a></h5><p>在调整 SQL 语句时，SQL Tuning Advisor 会搜索实时和历史性能数据以查找该语句的 替代执行计划。如果存在原始计划以外的计划，则 SQL Tuning Advisor 会报告替代计划的发现结果。 <img src="'+q+'" alt="替代计划分析" loading="lazy"></p><h3 id="自动sql调优" tabindex="-1"><a class="header-anchor" href="#自动sql调优"><span>自动SQL调优</span></a></h3><h4 id="自动-sql-调优的工作原理" tabindex="-1"><a class="header-anchor" href="#自动-sql-调优的工作原理"><span>自动 SQL 调优的工作原理</span></a></h4><p>Oracle 数据库自动对从自动工作负载存储库 (AWR) 中选择的符合调优候选条件的高负载 SQL 语句运行 SQL Tuning Advisor。此任务称为“自动 SQL 调整”，每晚在默认维护窗口中运行。默认情况下，自动 SQL 调优最多运行 1 小时。您可以自定义维护时段的属性，包括开始和结束时间、频率和星期几。</p><figure><img src="'+L+`" alt="自动SQL调优API" tabindex="0" loading="lazy"><figcaption>自动SQL调优API</figcaption></figure><h4 id="自动调优任务" tabindex="-1"><a class="header-anchor" href="#自动调优任务"><span>自动调优任务</span></a></h4><ul><li>查看自动调优任务</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> DBA_AUTOTASK_WINDOW_CLIENTS<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>启动自动调优</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">BEGIN</span>
DBMS_AUTO_TASK_ADMIN<span class="token punctuation">.</span><span class="token keyword">ENABLE</span><span class="token punctuation">(</span>
client_name <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&#39;sql tuning advisor&#39;</span><span class="token punctuation">,</span>
operation <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
window_name <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token boolean">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">END</span><span class="token punctuation">;</span>
<span class="token operator">/</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>停止自动调优</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">BEGIN</span>
DBMS_AUTO_TASK_ADMIN<span class="token punctuation">.</span><span class="token keyword">DISABLE</span><span class="token punctuation">(</span>
client_name <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&#39;sql tuning advisor&#39;</span><span class="token punctuation">,</span>
operation <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
window_name <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token boolean">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">END</span><span class="token punctuation">;</span>
<span class="token operator">/</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>查询自动调优是否启动</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code>COL CLIENT_NAME FORMAT a20

<span class="token keyword">SELECT</span> CLIENT_NAME<span class="token punctuation">,</span> <span class="token keyword">STATUS</span>
<span class="token keyword">FROM</span>   DBA_AUTOTASK_CLIENT
<span class="token keyword">WHERE</span>  CLIENT_NAME <span class="token operator">=</span> <span class="token string">&#39;sql tuning advisor&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>开始自动优化</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">SET</span> SERVEROUTPUT <span class="token keyword">ON</span>
<span class="token keyword">DECLARE</span>
  l_return VARCHAR2<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">BEGIN</span>
  l_return :<span class="token operator">=</span> DBMS_AUTO_SQLTUNE<span class="token punctuation">.</span>execute_auto_tuning_task<span class="token punctuation">;</span>
  DBMS_OUTPUT<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span>l_return<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">END</span><span class="token punctuation">;</span>
<span class="token operator">/</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>设置自动SQL优化参数</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">BEGIN</span>
  DBMS_SQLTUNE<span class="token punctuation">.</span>SET_TUNING_TASK_PARAMETER <span class="token punctuation">(</span>
    task_name <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&#39;SYS_AUTO_SQL_TUNING_TASK&#39;</span>
<span class="token punctuation">,</span>   parameter <span class="token operator">=</span><span class="token operator">&gt;</span> parameter_name
<span class="token punctuation">,</span>   <span class="token keyword">value</span>     <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token keyword">value</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">END</span><span class="token punctuation">;</span>
<span class="token operator">/</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>查看自动SQL优化参数</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code>COL PARAMETER_NAME FORMAT a25 
COL <span class="token keyword">VALUE</span> FORMAT a10   

<span class="token keyword">SELECT</span> PARAMETER_NAME<span class="token punctuation">,</span> PARAMETER_VALUE <span class="token keyword">AS</span> <span class="token string">&quot;VALUE&quot;</span>
<span class="token keyword">FROM</span>   DBA_ADVISOR_PARAMETERS
<span class="token keyword">WHERE</span>  <span class="token punctuation">(</span> <span class="token punctuation">(</span>TASK_NAME <span class="token operator">=</span> <span class="token string">&#39;SYS_AUTO_SQL_TUNING_TASK&#39;</span><span class="token punctuation">)</span> <span class="token operator">AND</span>
         <span class="token punctuation">(</span> <span class="token punctuation">(</span>PARAMETER_NAME <span class="token operator">LIKE</span> <span class="token string">&#39;%PROFILE%&#39;</span><span class="token punctuation">)</span> <span class="token operator">OR</span> 
           <span class="token punctuation">(</span>PARAMETER_NAME <span class="token operator">=</span> <span class="token string">&#39;LOCAL_TIME_LIMIT&#39;</span><span class="token punctuation">)</span> <span class="token operator">OR</span>
           <span class="token punctuation">(</span>PARAMETER_NAME <span class="token operator">=</span> <span class="token string">&#39;EXECUTION_DAYS_TO_EXPIRE&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>查看自动调优结果</li></ul>`,88),I=s("div",{class:"language-sql line-numbers-mode","data-ext":"sql","data-title":"sql"},[s("pre",{class:"language-sql"},[s("code",null,[s("span",{class:"token keyword"},"select"),n(" dbms_sqltune"),s("span",{class:"token punctuation"},"."),n("report_tuning_task"),s("span",{class:"token punctuation"},"("),s("span",{class:"token string"},"'SYS_AUTO_SQL_TUNING_TASK'"),s("span",{class:"token punctuation"},")"),n(),s("span",{class:"token keyword"},"from"),n(" dual"),s("span",{class:"token punctuation"},";"),n(`
`)])]),s("div",{class:"line-numbers","aria-hidden":"true"},[s("div",{class:"line-number"})])],-1),C=s("div",{class:"language-sql line-numbers-mode","data-ext":"sql","data-title":"sql"},[s("pre",{class:"language-sql"},[s("code",null,[n("VARIABLE my_rept CLOB"),s("span",{class:"token punctuation"},";"),n(`
`),s("span",{class:"token keyword"},"BEGIN"),n(`
  :my_rept :`),s("span",{class:"token operator"},"="),n("DBMS_AUTO_SQLTUNE"),s("span",{class:"token punctuation"},"."),n("REPORT_AUTO_TUNING_TASK"),s("span",{class:"token punctuation"},"("),n(`
    begin_exec   `),s("span",{class:"token operator"},"="),s("span",{class:"token operator"},">"),n(),s("span",{class:"token boolean"},"NULL"),s("span",{class:"token punctuation"},","),n(`
    end_exec     `),s("span",{class:"token operator"},"="),s("span",{class:"token operator"},">"),n(),s("span",{class:"token boolean"},"NULL"),s("span",{class:"token punctuation"},","),n(`
    `),s("span",{class:"token keyword"},"type"),n("         "),s("span",{class:"token operator"},"="),s("span",{class:"token operator"},">"),n(),s("span",{class:"token string"},"'TEXT'"),s("span",{class:"token punctuation"},","),n(`
    `),s("span",{class:"token keyword"},"level"),n("        "),s("span",{class:"token operator"},"="),s("span",{class:"token operator"},">"),n(),s("span",{class:"token string"},"'TYPICAL'"),s("span",{class:"token punctuation"},","),n(`
    section      `),s("span",{class:"token operator"},"="),s("span",{class:"token operator"},">"),n(),s("span",{class:"token string"},"'ALL'"),s("span",{class:"token punctuation"},","),n(`
    object_id    `),s("span",{class:"token operator"},"="),s("span",{class:"token operator"},">"),n(),s("span",{class:"token boolean"},"NULL"),s("span",{class:"token punctuation"},","),n(`
    result_limit `),s("span",{class:"token operator"},"="),s("span",{class:"token operator"},">"),n(),s("span",{class:"token boolean"},"NULL"),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},";"),n(`
`),s("span",{class:"token keyword"},"END"),s("span",{class:"token punctuation"},";"),n(`
`),s("span",{class:"token operator"},"/"),n(`

`),s("span",{class:"token keyword"},"PRINT"),n(` :my_rept
`)])]),s("div",{class:"line-numbers","aria-hidden":"true"},[s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"})])],-1),B=s("div",{class:"language-sql line-numbers-mode","data-ext":"sql","data-title":"sql"},[s("pre",{class:"language-sql"},[s("code",null,[s("span",{class:"token keyword"},"SET"),n(" LONG "),s("span",{class:"token number"},"1000000"),n(`
`),s("span",{class:"token keyword"},"SELECT"),n(" DBMS_AUTO_SQLTUNE"),s("span",{class:"token punctuation"},"."),n("report_auto_tuning_task "),s("span",{class:"token keyword"},"FROM"),n("   dual"),s("span",{class:"token punctuation"},";"),n(`
`)])]),s("div",{class:"line-numbers","aria-hidden":"true"},[s("div",{class:"line-number"}),s("div",{class:"line-number"})])],-1),x=l('<h3 id="手动sql调优" tabindex="-1"><a class="header-anchor" href="#手动sql调优"><span>手动SQL调优</span></a></h3><h4 id="手动sql-tuning-advisor介绍" tabindex="-1"><a class="header-anchor" href="#手动sql-tuning-advisor介绍"><span>手动SQL Tuning Advisor介绍</span></a></h4><p>使用DBMS_SQLTUNE包运行 SQL Tuning Advisor 是一个多步骤的过程：</p><ul><li>创建 SQL 调优集（如果调优多个 SQL 语句）</li><li>创建SQL调优任务</li><li>执行SQL调优任务</li><li>显示 SQL 调优任务的结果</li><li>酌情实施建议</li></ul><p>SQL Tuning Advisor API:</p><figure><img src="'+h+'" alt="SQL Tuning Advisor API" tabindex="0" loading="lazy"><figcaption>SQL Tuning Advisor API</figcaption></figure><h4 id="dbms-sqltune-调优任务" tabindex="-1"><a class="header-anchor" href="#dbms-sqltune-调优任务"><span>DBMS_SQLTUNE 调优任务</span></a></h4><ul><li>创建优化任务</li></ul>',8),P=s("div",{class:"language-sql line-numbers-mode","data-ext":"sql","data-title":"sql"},[s("pre",{class:"language-sql"},[s("code",null,[s("span",{class:"token comment"},"-- create sql_tuning_task"),n(`
`),s("span",{class:"token keyword"},"declare"),n(`
my_task_name varchar2`),s("span",{class:"token punctuation"},"("),s("span",{class:"token number"},"100"),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},";"),n(`
`),s("span",{class:"token keyword"},"begin"),n(`
my_task_name :`),s("span",{class:"token operator"},"="),n(" dbms_sqltune"),s("span",{class:"token punctuation"},"."),n("create_tuning_task"),s("span",{class:"token punctuation"},"("),n(`
sql_id    `),s("span",{class:"token operator"},"="),s("span",{class:"token operator"},">"),n(),s("span",{class:"token string"},"'9ycvnajj2m7wt'"),s("span",{class:"token punctuation"},","),n(`
scope       `),s("span",{class:"token operator"},"="),s("span",{class:"token operator"},">"),n(),s("span",{class:"token string"},"'comprehensive'"),s("span",{class:"token punctuation"},","),n(`
time_limit  `),s("span",{class:"token operator"},"="),s("span",{class:"token operator"},">"),n(),s("span",{class:"token number"},"60"),s("span",{class:"token punctuation"},","),n(`
task_name   `),s("span",{class:"token operator"},"="),s("span",{class:"token operator"},">"),n(),s("span",{class:"token string"},"'abelit_sql_tuning_task'"),s("span",{class:"token punctuation"},","),n(`
description `),s("span",{class:"token operator"},"="),s("span",{class:"token operator"},">"),n(),s("span",{class:"token string"},"'abelit task to tune a query'"),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},";"),n(`
`),s("span",{class:"token keyword"},"end"),s("span",{class:"token punctuation"},";"),n(`
`),s("span",{class:"token operator"},"/"),n(`
`)])]),s("div",{class:"line-numbers","aria-hidden":"true"},[s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"})])],-1),f=s("div",{class:"language-sql line-numbers-mode","data-ext":"sql","data-title":"sql"},[s("pre",{class:"language-sql"},[s("code",null,[s("span",{class:"token keyword"},"DECLARE"),n(`
  my_task_name VARCHAR2`),s("span",{class:"token punctuation"},"("),s("span",{class:"token number"},"30"),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},";"),n(`
  my_sqltext   CLOB`),s("span",{class:"token punctuation"},";"),n(`
`),s("span",{class:"token keyword"},"BEGIN"),n(`
  my_sqltext :`),s("span",{class:"token operator"},"="),n(),s("span",{class:"token string"},"'SELECT /*+ ORDERED */ * '"),n("                      "),s("span",{class:"token operator"},"||"),n(`
                `),s("span",{class:"token string"},"'FROM employees e, locations l, departments d '"),n(),s("span",{class:"token operator"},"||"),n(`
                `),s("span",{class:"token string"},"'WHERE e.department_id = d.department_id AND '"),n("  "),s("span",{class:"token operator"},"||"),n(`
                      `),s("span",{class:"token string"},"'l.location_id = d.location_id AND '"),n("      "),s("span",{class:"token operator"},"||"),n(`
                      `),s("span",{class:"token string"},"'e.employee_id < :bnd'"),s("span",{class:"token punctuation"},";"),n(`

  my_task_name :`),s("span",{class:"token operator"},"="),n(" DBMS_SQLTUNE"),s("span",{class:"token punctuation"},"."),n("CREATE_TUNING_TASK "),s("span",{class:"token punctuation"},"("),n(`
          sql_text    `),s("span",{class:"token operator"},"="),s("span",{class:"token operator"},">"),n(` my_sqltext
`),s("span",{class:"token punctuation"},","),n("         bind_list   "),s("span",{class:"token operator"},"="),s("span",{class:"token operator"},">"),n(" sql_binds"),s("span",{class:"token punctuation"},"("),n("anydata"),s("span",{class:"token punctuation"},"."),n("ConvertNumber"),s("span",{class:"token punctuation"},"("),s("span",{class:"token number"},"100"),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},")"),n(`
`),s("span",{class:"token punctuation"},","),n("         user_name   "),s("span",{class:"token operator"},"="),s("span",{class:"token operator"},">"),n(),s("span",{class:"token string"},"'HR'"),n(`
`),s("span",{class:"token punctuation"},","),n("         scope       "),s("span",{class:"token operator"},"="),s("span",{class:"token operator"},">"),n(),s("span",{class:"token string"},"'COMPREHENSIVE'"),n(`
`),s("span",{class:"token punctuation"},","),n("         time_limit  "),s("span",{class:"token operator"},"="),s("span",{class:"token operator"},">"),n(),s("span",{class:"token number"},"60"),n(`
`),s("span",{class:"token punctuation"},","),n("         task_name   "),s("span",{class:"token operator"},"="),s("span",{class:"token operator"},">"),n(),s("span",{class:"token string"},"'STA_SPECIFIC_EMP_TASK'"),n(`
`),s("span",{class:"token punctuation"},","),n("         description "),s("span",{class:"token operator"},"="),s("span",{class:"token operator"},">"),n(),s("span",{class:"token string"},"'Task to tune a query on a specified employee'"),n(`
`),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},";"),n(`
`),s("span",{class:"token keyword"},"END"),s("span",{class:"token punctuation"},";"),n(`
`),s("span",{class:"token operator"},"/"),n(`
`)])]),s("div",{class:"line-numbers","aria-hidden":"true"},[s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"})])],-1),V=l(`<ul><li>查看任务状态</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code>COL TASK_ID FORMAT <span class="token number">999999</span>
COL TASK_NAME FORMAT a25
COL STATUS_MESSAGE FORMAT a33

<span class="token keyword">SELECT</span> TASK_ID<span class="token punctuation">,</span> TASK_NAME<span class="token punctuation">,</span> <span class="token keyword">STATUS</span><span class="token punctuation">,</span> STATUS_MESSAGE
<span class="token keyword">FROM</span>   USER_ADVISOR_LOG<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>执行优化任务</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token comment">-- execute sql_tuning_task</span>
<span class="token keyword">begin</span>
dbms_sqltune<span class="token punctuation">.</span>execute_tuning_task<span class="token punctuation">(</span>task_name <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&#39;abelit_sql_tuning_task&#39;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span>
<span class="token operator">/</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>中断优化任务</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">EXEC</span> DBMS_SQLTUNE<span class="token punctuation">.</span>interrupt_tuning_task <span class="token punctuation">(</span>task_name <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&#39;abelit_sql_tuning_task&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>恢复优化任务</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">EXEC</span> DBMS_SQLTUNE<span class="token punctuation">.</span>resume_tuning_task <span class="token punctuation">(</span>task_name <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&#39;abelit_sql_tuning_task&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>取消优化任务</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">EXEC</span> DBMS_SQLTUNE<span class="token punctuation">.</span>cancel_tuning_task <span class="token punctuation">(</span>task_name <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&#39;abelit_sql_tuning_task&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>重置任务</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">EXEC</span> DBMS_SQLTUNE<span class="token punctuation">.</span>reset_tuning_task <span class="token punctuation">(</span>task_name <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&#39;abelit_sql_tuning_task&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>监控SQL优化任务</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> 
<span class="token keyword">FROM</span>   DBA_ADVISOR_TASKS 
<span class="token keyword">WHERE</span>  task_name <span class="token operator">=</span> <span class="token string">&#39;abelit_sql_tuning_task&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>检查SQL Tuning Advisor进度</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> SOFAR<span class="token punctuation">,</span> TOTALWORK 
<span class="token keyword">FROM</span>   V$ADVISOR_PROGRESS 
<span class="token keyword">WHERE</span>  USER_NAME <span class="token operator">=</span> <span class="token string">&#39;YSDBA&#39;</span> <span class="token operator">AND</span> TASK_NAME <span class="token operator">=</span> <span class="token string">&#39;abelit_sql_tuning_task&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>配置优化任务</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">BEGIN</span>
  DBMS_SQLTUNE<span class="token punctuation">.</span>SET_TUNING_TASK_PARAMETER<span class="token punctuation">(</span>
    task_name <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&#39;abelit_sql_tuning_task&#39;</span><span class="token punctuation">,</span>
    parameter <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&#39;TIME_LIMIT&#39;</span><span class="token punctuation">,</span> <span class="token keyword">value</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">END</span><span class="token punctuation">;</span>
<span class="token operator">/</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>验证任务参数是否更改</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code>COL PARAMETER_NAME FORMAT a25 
COL <span class="token keyword">VALUE</span> FORMAT a15   

<span class="token keyword">SELECT</span> PARAMETER_NAME<span class="token punctuation">,</span> PARAMETER_VALUE <span class="token keyword">AS</span> <span class="token string">&quot;VALUE&quot;</span>
<span class="token keyword">FROM</span>   USER_ADVISOR_PARAMETERS
<span class="token keyword">WHERE</span>  TASK_NAME <span class="token operator">=</span> <span class="token string">&#39;STA_SPECIFIC_EMP_TASK&#39;</span>
<span class="token operator">AND</span>    PARAMETER_VALUE <span class="token operator">!=</span> <span class="token string">&#39;UNUSED&#39;</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> PARAMETER_NAME<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>查看 SQL 调优任务的报告</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token comment">-- report sql_tuning_task</span>
<span class="token keyword">SET</span> LONG <span class="token number">1000</span>
<span class="token keyword">SET</span> LONGCHUNKSIZE <span class="token number">1000</span>
<span class="token keyword">SET</span> LINESIZE <span class="token number">100</span>
<span class="token keyword">SELECT</span> DBMS_SQLTUNE<span class="token punctuation">.</span>REPORT_TUNING_TASK<span class="token punctuation">(</span> <span class="token string">&#39;abelit_sql_tuning_task&#39;</span> <span class="token punctuation">)</span>
<span class="token keyword">FROM</span>   DUAL<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>删除优化任务</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token comment">-- drop sql_tuning_task</span>
<span class="token keyword">begin</span>
dbms_sqltune<span class="token punctuation">.</span>drop_tuning_task<span class="token punctuation">(</span><span class="token string">&#39;abelit_sql_tuning_task&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span>
<span class="token operator">/</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>接受优化器建议</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">execute</span> dbms_sqltune<span class="token punctuation">.</span>accept_sql_profile<span class="token punctuation">(</span>task_name <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&#39;abelit_sql_tuning_task&#39;</span><span class="token punctuation">,</span> task_owner <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&#39;TEST&#39;</span><span class="token punctuation">,</span> <span class="token keyword">replace</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>删除优化器建议</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">exec</span> dbms_sqltune<span class="token punctuation">.</span>drop_sql_profile<span class="token punctuation">(</span><span class="token string">&#39;SYS_SQLPROF_016813a0a8e70001&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="sql-access-advisor" tabindex="-1"><a class="header-anchor" href="#sql-access-advisor"><span>SQL Access Advisor</span></a></h2><p>SQL Access Advisor是一种诊断软件，可通过推荐要创建、删除或保留的索引、物化视图、物化视图日志或分区来识别并帮助解决 SQL 性能问题。</p><h3 id="sql-access-advisor-的用途" tabindex="-1"><a class="header-anchor" href="#sql-access-advisor-的用途"><span>SQL Access Advisor 的用途</span></a></h3><p>SQL Access Advisor 会为指定的工作负载推荐一组正确的物化视图、物化视图日志、分区和索引。</p><p>在调整数据库以实现复杂的数据密集型查询的最佳性能时，物化视图、分区和索引至关重要。SQL Access Advisor 将实际工作负载作为输入，或从架构中导出假设的工作负载。然后，顾问会推荐访问结构以实现更快的执行路径。该顾问具有以下优势：</p><ul><li>不需要您具备专业知识</li><li>根据优化器中的规则做出决策</li><li>涵盖单个顾问中 SQL 访问的所有方面</li><li>在云控制中提供简单、用户友好的GUI向导</li><li>生成用于实施建议的脚本</li></ul><h3 id="sql-access-advisor-架构" tabindex="-1"><a class="header-anchor" href="#sql-access-advisor-架构"><span>SQL Access Advisor 架构</span></a></h3><figure><img src="`+R+'" alt="SQL 访问顾问架构" tabindex="0" loading="lazy"><figcaption>SQL 访问顾问架构</figcaption></figure><h4 id="sql-access-advisor-的输入" tabindex="-1"><a class="header-anchor" href="#sql-access-advisor-的输入"><span>SQL Access Advisor 的输入</span></a></h4><ul><li>共享SQL区</li></ul><p>数据库使用共享 SQL 区域来分析当前位于的最近的 SQL 语句V$SQL。</p><ul><li>SQL调优集</li></ul><p>SQL 调优集(STS)是存储 SQL 语句及其执行上下文的数据库对象。当一组SQL语句作为输入时，数据库必须首先构建并使用STS。</p><ul><li>假设工作量</li></ul><p>您可以通过分析维度和约束从架构创建假设工作负载。当您最初设计应用程序时，此选项非常有用。</p><h4 id="sql-access-advisor-输出建议" tabindex="-1"><a class="header-anchor" href="#sql-access-advisor-输出建议"><span>SQL Access Advisor 输出建议</span></a></h4><ul><li>索引</li></ul><p>SQL Access Advisor 索引建议包括位图索引、基于函数的索引和 B 树索引。与其他索引技术相比，位图索引可以缩短多种类型的即席查询的响应时间并减少存储要求。B 树索引最常用于数据仓库中来索引唯一或接近唯一的键。SQL Access Advisor 物化视图建议包括快速可刷新和完全可刷新物化视图，用于一般重写或精确文本匹配重写。</p><ul><li>物化视图</li></ul><p>SQL Access Advisor 使用该TUNE_MVIEW过程还建议如何优化物化视图，以便它们可以快速刷新并利用一般查询重写。</p><ul><li>物化视图日志</li></ul><p>物化视图日志是物化视图主站点或主物化视图站点上的一个表，记录对主表或主物化视图的所有 DML 更改。仅当物化视图的主实例具有物化视图日志时，才可以快速刷新物化视图。</p><ul><li>分区</li></ul><p>SQL Access Advisor 可以建议对现有的未分区基表进行分区以提高性能。此外，它可能会推荐本身已分区的新索引和物化视图。</p><h3 id="sql-access-advisor-基础任务" tabindex="-1"><a class="header-anchor" href="#sql-access-advisor-基础任务"><span>SQL Access Advisor（基础任务）</span></a></h3><figure><img src="'+y+`" alt="使用 SQL Access Advisor" tabindex="0" loading="lazy"><figcaption>使用 SQL Access Advisor</figcaption></figure><ul><li>创建SQL集</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">SET</span> SERVEROUTPUT <span class="token keyword">ON</span><span class="token punctuation">;</span>
VARIABLE task_id NUMBER<span class="token punctuation">;</span>
VARIABLE task_name VARCHAR2<span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
VARIABLE workload_name VARCHAR2<span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">EXECUTE</span> :workload_name :<span class="token operator">=</span> <span class="token string">&#39;MY_STS_WORKLOAD&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">EXECUTE</span> DBMS_SQLTUNE<span class="token punctuation">.</span>CREATE_SQLSET<span class="token punctuation">(</span>:workload_name<span class="token punctuation">,</span> <span class="token string">&#39;test purpose&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>使用用户定义的工作负载填充 SQL 调优集</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> user_workload<span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> user_workload
<span class="token punctuation">(</span>
  username             varchar2<span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment">/* User who executes statement */</span>
  module               varchar2<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">,</span>       <span class="token comment">/* Application module name */</span>
  <span class="token keyword">action</span>               varchar2<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">,</span>       <span class="token comment">/* Application action name */</span>
  elapsed_time         number<span class="token punctuation">,</span>              <span class="token comment">/* Elapsed time for query */</span>
  cpu_time             number<span class="token punctuation">,</span>                  <span class="token comment">/* CPU time for query */</span>
  buffer_gets          number<span class="token punctuation">,</span>       <span class="token comment">/* Buffer gets consumed by query */</span>
  disk_reads           number<span class="token punctuation">,</span>        <span class="token comment">/* Disk reads consumed by query */</span>
  rows_processed       number<span class="token punctuation">,</span>        <span class="token comment">/* # of rows processed by query */</span>
  executions           number<span class="token punctuation">,</span>           <span class="token comment">/* # of times query executed */</span>
  optimizer_cost       number<span class="token punctuation">,</span>            <span class="token comment">/* Optimizer cost for query */</span>
  priority             number<span class="token punctuation">,</span>            <span class="token comment">/* User-priority (1,2 or 3) */</span>
  last_execution_date  <span class="token keyword">date</span><span class="token punctuation">,</span>              <span class="token comment">/* Last time query executed */</span>
  stat_period          number<span class="token punctuation">,</span>         <span class="token comment">/* Window exec time in seconds */</span>
  sql_text             clob                          <span class="token comment">/* Full SQL Text */</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- aggregation with selection</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> user_workload <span class="token punctuation">(</span>username<span class="token punctuation">,</span> module<span class="token punctuation">,</span> <span class="token keyword">action</span><span class="token punctuation">,</span> priority<span class="token punctuation">,</span> sql_text<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">&#39;SH&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;Example1&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;Action&#39;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span>
<span class="token string">&#39;SELECT   t.week_ending_day, p.prod_subcategory, 
          SUM(s.amount_sold) AS dollars, s.channel_id, s.promo_id
 FROM     sales s, times t, products p 
 WHERE    s.time_id = t.time_id
 AND      s.prod_id = p.prod_id 
 AND      s.prod_id &gt; 10 
 AND      s.prod_id &lt; 50
 GROUP BY t.week_ending_day, p.prod_subcategory, s.channel_id, s.promo_id&#39;</span><span class="token punctuation">)</span>
<span class="token operator">/</span>
 
<span class="token comment">-- aggregation with selection</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> user_workload <span class="token punctuation">(</span>username<span class="token punctuation">,</span> module<span class="token punctuation">,</span> <span class="token keyword">action</span><span class="token punctuation">,</span> priority<span class="token punctuation">,</span> sql_text<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">&#39;SH&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;Example1&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;Action&#39;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span>
 <span class="token string">&#39;SELECT   t.calendar_month_desc, SUM(s.amount_sold) AS dollars
  FROM     sales s , times t
  WHERE    s.time_id = t.time_id
  AND      s.time_id BETWEEN TO_DATE(&#39;&#39;01-JAN-2000&#39;&#39;, &#39;&#39;DD-MON-YYYY&#39;&#39;)
  AND      TO_DATE(&#39;&#39;01-JUL-2000&#39;&#39;, &#39;&#39;DD-MON-YYYY&#39;&#39;)
  GROUP BY t.calendar_month_desc&#39;</span><span class="token punctuation">)</span>
<span class="token operator">/</span>
 
<span class="token comment">-- order by</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> user_workload <span class="token punctuation">(</span>username<span class="token punctuation">,</span> module<span class="token punctuation">,</span> <span class="token keyword">action</span><span class="token punctuation">,</span> priority<span class="token punctuation">,</span> sql_text<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">&#39;SH&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;Example1&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;Action&#39;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span>
 <span class="token string">&#39;SELECT   c.country_id, c.cust_city, c.cust_last_name
  FROM     customers c
  WHERE    c.country_id IN (52790, 52789)
  ORDER BY c.country_id, c.cust_city, c.cust_last_name&#39;</span><span class="token punctuation">)</span>
<span class="token operator">/</span>
<span class="token keyword">COMMIT</span><span class="token punctuation">;</span>


<span class="token keyword">DECLARE</span>
  sqlset_cur DBMS_SQLTUNE<span class="token punctuation">.</span>SQLSET_CURSOR<span class="token punctuation">;</span>
<span class="token keyword">BEGIN</span>
  <span class="token keyword">OPEN</span> sqlset_cur <span class="token keyword">FOR</span>
    <span class="token keyword">SELECT</span> SQLSET_ROW<span class="token punctuation">(</span><span class="token boolean">null</span><span class="token punctuation">,</span><span class="token boolean">null</span><span class="token punctuation">,</span> SQL_TEXT<span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token string">&#39;SH&#39;</span><span class="token punctuation">,</span> module<span class="token punctuation">,</span>
                     <span class="token string">&#39;Action&#39;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span>
                     sysdate<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">)</span>
    <span class="token keyword">FROM</span> USER_WORKLOAD<span class="token punctuation">;</span>
  DBMS_SQLTUNE<span class="token punctuation">.</span>LOAD_SQLSET<span class="token punctuation">(</span><span class="token string">&#39;MY_STS_WORKLOAD&#39;</span><span class="token punctuation">,</span> sqlset_cur<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">END</span><span class="token punctuation">;</span>
<span class="token operator">/</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>要创建SQL Access Advisor 任务</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">EXEC</span> :task_name :<span class="token operator">=</span> <span class="token string">&#39;MYTASK&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">EXEC</span> DBMS_ADVISOR<span class="token punctuation">.</span>CREATE_TASK<span class="token punctuation">(</span><span class="token string">&#39;SQL Access Advisor&#39;</span><span class="token punctuation">,</span> :task_id<span class="token punctuation">,</span> :task_name<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>设置任务参数</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">EXEC</span> DBMS_ADVISOR<span class="token punctuation">.</span>SET_TASK_PARAMETER<span class="token punctuation">(</span>:task_name<span class="token punctuation">,</span> <span class="token string">&#39;TIME_LIMIT&#39;</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">EXEC</span> DBMS_ADVISOR<span class="token punctuation">.</span>SET_TASK_PARAMETER<span class="token punctuation">(</span>:task_name<span class="token punctuation">,</span> <span class="token string">&#39;ANALYSIS_SCOPE&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;ALL&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>将任务与工作负载联系起来</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">EXECUTE</span> DBMS_ADVISOR<span class="token punctuation">.</span>ADD_STS_REF<span class="token punctuation">(</span>:task_name<span class="token punctuation">,</span> <span class="token string">&#39;SH&#39;</span><span class="token punctuation">,</span> :workload_name<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>执行 SQL Access Advisor 任务</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">EXECUTE</span> DBMS_ADVISOR<span class="token punctuation">.</span>EXECUTE_TASK<span class="token punctuation">(</span>:task_name<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>查询USER_ADVISOR_LOG以检查任务的状态</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code>COL TASK_ID FORMAT <span class="token number">999</span>
COL TASK_NAME FORMAT a25
COL STATUS_MESSAGE FORMAT a25

<span class="token keyword">SELECT</span> TASK_ID<span class="token punctuation">,</span> TASK_NAME<span class="token punctuation">,</span> <span class="token keyword">STATUS</span><span class="token punctuation">,</span> STATUS_MESSAGE 
<span class="token keyword">FROM</span>   USER_ADVISOR_LOG<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>查看 SQL Access Advisor 任务结果</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code>VARIABLE workload_name VARCHAR2<span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
VARIABLE task_name VARCHAR2<span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">EXECUTE</span> :task_name :<span class="token operator">=</span> <span class="token string">&#39;MYTASK&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">EXECUTE</span> :workload_name :<span class="token operator">=</span> <span class="token string">&#39;MY_STS_WORKLOAD&#39;</span><span class="token punctuation">;</span> 

<span class="token keyword">SELECT</span> REC_ID<span class="token punctuation">,</span> RANK<span class="token punctuation">,</span> BENEFIT
<span class="token keyword">FROM</span>   USER_ADVISOR_RECOMMENDATIONS 
<span class="token keyword">WHERE</span>  TASK_NAME <span class="token operator">=</span> :task_name
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> RANK<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>确定哪个查询受益于哪个建议</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> SQL_ID<span class="token punctuation">,</span> REC_ID<span class="token punctuation">,</span> PRECOST<span class="token punctuation">,</span> POSTCOST<span class="token punctuation">,</span>
       <span class="token punctuation">(</span>PRECOST<span class="token operator">-</span>POSTCOST<span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">100</span><span class="token operator">/</span>PRECOST <span class="token keyword">AS</span> PERCENT_BENEFIT
<span class="token keyword">FROM</span>   USER_ADVISOR_SQLA_WK_STMTS
<span class="token keyword">WHERE</span>  TASK_NAME <span class="token operator">=</span> :task_name
<span class="token operator">AND</span>    WORKLOAD_NAME <span class="token operator">=</span> :workload_name
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> percent_benefit <span class="token keyword">DESC</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>显示这组建议的不同操作的数量</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token string">&#39;Action Count&#39;</span><span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token keyword">DISTINCT</span> action_id<span class="token punctuation">)</span> cnt
<span class="token keyword">FROM</span>   USER_ADVISOR_ACTIONS 
<span class="token keyword">WHERE</span>  TASK_NAME <span class="token operator">=</span> :task_name<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>显示这组建议的操作</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> REC_ID<span class="token punctuation">,</span> ACTION_ID<span class="token punctuation">,</span> SUBSTR<span class="token punctuation">(</span>COMMAND<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> command
<span class="token keyword">FROM</span>   USER_ADVISOR_ACTIONS 
<span class="token keyword">WHERE</span>  TASK_NAME <span class="token operator">=</span> :task_name
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> rec_id<span class="token punctuation">,</span> action_id<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>显示推荐的属性</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token operator">OR</span> <span class="token keyword">REPLACE</span> <span class="token keyword">PROCEDURE</span> show_recm <span class="token punctuation">(</span>in_task_name <span class="token operator">IN</span> VARCHAR2<span class="token punctuation">)</span> <span class="token operator">IS</span> 
<span class="token keyword">CURSOR</span> curs <span class="token operator">IS</span>
  <span class="token keyword">SELECT</span> <span class="token keyword">DISTINCT</span> action_id<span class="token punctuation">,</span> command<span class="token punctuation">,</span> attr1<span class="token punctuation">,</span> attr2<span class="token punctuation">,</span> attr3<span class="token punctuation">,</span> attr4
  <span class="token keyword">FROM</span> user_advisor_actions
  <span class="token keyword">WHERE</span> task_name <span class="token operator">=</span> in_task_name
  <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> action_id<span class="token punctuation">;</span>
  v_action        number<span class="token punctuation">;</span>
  v_command     VARCHAR2<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  v_attr1       VARCHAR2<span class="token punctuation">(</span><span class="token number">4000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  v_attr2       VARCHAR2<span class="token punctuation">(</span><span class="token number">4000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  v_attr3       VARCHAR2<span class="token punctuation">(</span><span class="token number">4000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  v_attr4       VARCHAR2<span class="token punctuation">(</span><span class="token number">4000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  v_attr5       VARCHAR2<span class="token punctuation">(</span><span class="token number">4000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">BEGIN</span>
  <span class="token keyword">OPEN</span> curs<span class="token punctuation">;</span>
  DBMS_OUTPUT<span class="token punctuation">.</span>PUT_LINE<span class="token punctuation">(</span><span class="token string">&#39;=========================================&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  DBMS_OUTPUT<span class="token punctuation">.</span>PUT_LINE<span class="token punctuation">(</span><span class="token string">&#39;Task_name = &#39;</span> <span class="token operator">||</span> in_task_name<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">LOOP</span>
     <span class="token keyword">FETCH</span> curs <span class="token keyword">INTO</span>  
       v_action<span class="token punctuation">,</span> v_command<span class="token punctuation">,</span> v_attr1<span class="token punctuation">,</span> v_attr2<span class="token punctuation">,</span> v_attr3<span class="token punctuation">,</span> v_attr4 <span class="token punctuation">;</span>
   <span class="token keyword">EXIT</span> <span class="token keyword">when</span> curs<span class="token operator">%</span>NOTFOUND<span class="token punctuation">;</span>
   DBMS_OUTPUT<span class="token punctuation">.</span>PUT_LINE<span class="token punctuation">(</span><span class="token string">&#39;Action ID: &#39;</span> <span class="token operator">||</span> v_action<span class="token punctuation">)</span><span class="token punctuation">;</span>
   DBMS_OUTPUT<span class="token punctuation">.</span>PUT_LINE<span class="token punctuation">(</span><span class="token string">&#39;Command : &#39;</span> <span class="token operator">||</span> v_command<span class="token punctuation">)</span><span class="token punctuation">;</span>
   DBMS_OUTPUT<span class="token punctuation">.</span>PUT_LINE<span class="token punctuation">(</span><span class="token string">&#39;Attr1 (name)      : &#39;</span> <span class="token operator">||</span> SUBSTR<span class="token punctuation">(</span>v_attr1<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   DBMS_OUTPUT<span class="token punctuation">.</span>PUT_LINE<span class="token punctuation">(</span><span class="token string">&#39;Attr2 (tablespace): &#39;</span> <span class="token operator">||</span> SUBSTR<span class="token punctuation">(</span>v_attr2<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   DBMS_OUTPUT<span class="token punctuation">.</span>PUT_LINE<span class="token punctuation">(</span><span class="token string">&#39;Attr3             : &#39;</span> <span class="token operator">||</span> SUBSTR<span class="token punctuation">(</span>v_attr3<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   DBMS_OUTPUT<span class="token punctuation">.</span>PUT_LINE<span class="token punctuation">(</span><span class="token string">&#39;Attr4             : &#39;</span> <span class="token operator">||</span> v_attr4<span class="token punctuation">)</span><span class="token punctuation">;</span>
   DBMS_OUTPUT<span class="token punctuation">.</span>PUT_LINE<span class="token punctuation">(</span><span class="token string">&#39;Attr5             : &#39;</span> <span class="token operator">||</span> v_attr5<span class="token punctuation">)</span><span class="token punctuation">;</span>
   DBMS_OUTPUT<span class="token punctuation">.</span>PUT_LINE<span class="token punctuation">(</span><span class="token string">&#39;----------------------------------------&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
   <span class="token keyword">END</span> <span class="token keyword">LOOP</span><span class="token punctuation">;</span>   
   <span class="token keyword">CLOSE</span> curs<span class="token punctuation">;</span>      
   DBMS_OUTPUT<span class="token punctuation">.</span>PUT_LINE<span class="token punctuation">(</span><span class="token string">&#39;=========END RECOMMENDATIONS============&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">END</span> show_recm<span class="token punctuation">;</span>
<span class="token operator">/</span>

<span class="token keyword">SET</span> SERVEROUTPUT <span class="token keyword">ON</span> SIZE <span class="token number">99999</span>
<span class="token keyword">EXECUTE</span> show_recm<span class="token punctuation">(</span>:task_name<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>生成并任务脚本</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> DIRECTORY ADVISOR_RESULTS <span class="token keyword">AS</span> <span class="token string">&#39;/tmp&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">GRANT</span> <span class="token keyword">READ</span> <span class="token keyword">ON</span> DIRECTORY ADVISOR_RESULTS <span class="token keyword">TO</span> <span class="token keyword">PUBLIC</span><span class="token punctuation">;</span>
<span class="token keyword">GRANT</span> <span class="token keyword">WRITE</span> <span class="token keyword">ON</span> DIRECTORY ADVISOR_RESULTS <span class="token keyword">TO</span> <span class="token keyword">PUBLIC</span><span class="token punctuation">;</span>

<span class="token keyword">EXECUTE</span> DBMS_ADVISOR<span class="token punctuation">.</span>CREATE_FILE<span class="token punctuation">(</span>DBMS_ADVISOR<span class="token punctuation">.</span>GET_TASK_SCRIPT<span class="token punctuation">(</span><span class="token string">&#39;MYTASK&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token string">&#39;ADVISOR_RESULTS&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;advscript.sql&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>执行任务脚本</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code>@<span class="token operator">/</span>tmp<span class="token operator">/</span>advscript<span class="token punctuation">.</span><span class="token keyword">sql</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>执行 SQL Access Advisor 快速调整</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code>VARIABLE t_name VARCHAR2<span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
VARIABLE sq VARCHAR2<span class="token punctuation">(</span><span class="token number">4000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">EXEC</span> :sq :<span class="token operator">=</span> <span class="token string">&#39;SELECT COUNT(*) FROM customers WHERE cust_state_province =&#39;&#39;CA&#39;&#39;&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">EXECUTE</span> :t_name :<span class="token operator">=</span> <span class="token string">&#39;MY_QUICKTUNE_TASK&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">EXEC</span> DBMS_ADVISOR<span class="token punctuation">.</span>QUICK_TUNE<span class="token punctuation">(</span>DBMS_ADVISOR<span class="token punctuation">.</span>SQLACCESS_ADVISOR<span class="token punctuation">,</span>:t_name<span class="token punctuation">,</span>:sq<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="sql-access-advisor-高级任务" tabindex="-1"><a class="header-anchor" href="#sql-access-advisor-高级任务"><span>SQL Access Advisor（高级任务）</span></a></h3><h4 id="要创建任务并将其设置为评估模式" tabindex="-1"><a class="header-anchor" href="#要创建任务并将其设置为评估模式"><span>要创建任务并将其设置为评估模式：</span></a></h4><ul><li>创建任务</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">EXECUTE</span> DBMS_ADVISOR<span class="token punctuation">.</span>EXECUTE_TASK<span class="token punctuation">(</span>:t_name<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>将任务设置为评估模式</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">EXECUTE</span> DBMS_ADVISOR<span class="token punctuation">.</span>SET_TASK_PARAMETER<span class="token punctuation">(</span>:t_name<span class="token punctuation">,</span><span class="token string">&#39;ANALYSIS_SCOPE&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;EVALUATION&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="更新-sql-access-advisor-任务属性" tabindex="-1"><a class="header-anchor" href="#更新-sql-access-advisor-任务属性"><span>更新 SQL Access Advisor 任务属性</span></a></h4><ul><li>更新任务属性</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">EXECUTE</span> DBMS_ADVISOR<span class="token punctuation">.</span>UPDATE_TASK_ATTRIBUTES<span class="token punctuation">(</span><span class="token string">&#39;MYTASK&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;TUNING1&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>将任务设置为只读</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">EXECUTE</span> DBMS_ADVISOR<span class="token punctuation">.</span>UPDATE_TASK_ATTRIBUTES<span class="token punctuation">(</span><span class="token string">&#39;TUNING1&#39;</span><span class="token punctuation">,</span> 
  read_only <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&#39;true&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="创建和使用-sql-access-advisor-任务模板" tabindex="-1"><a class="header-anchor" href="#创建和使用-sql-access-advisor-任务模板"><span>创建和使用 SQL Access Advisor 任务模板</span></a></h4><ul><li>创建任务作为模板</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code>VARIABLE template_id NUMBER<span class="token punctuation">;</span>
VARIABLE template_name VARCHAR2<span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">EXECUTE</span> :template_name :<span class="token operator">=</span> <span class="token string">&#39;MY_TEMPLATE&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">BEGIN</span> 
  DBMS_ADVISOR<span class="token punctuation">.</span>CREATE_TASK <span class="token punctuation">(</span>
    <span class="token string">&#39;SQL Access Advisor&#39;</span>
<span class="token punctuation">,</span>   :template_id
<span class="token punctuation">,</span>   :template_name
<span class="token punctuation">,</span>   is_template <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&#39;true&#39;</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">END</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>设置模板参数</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token comment">-- set naming conventions for recommended indexes/mvs</span>
<span class="token keyword">BEGIN</span> 
  DBMS_ADVISOR<span class="token punctuation">.</span>SET_TASK_PARAMETER <span class="token punctuation">(</span> 
    :template_name
<span class="token punctuation">,</span>   <span class="token string">&#39;INDEX_NAME_TEMPLATE&#39;</span>
<span class="token punctuation">,</span>   <span class="token string">&#39;SH_IDX$$_&lt;SEQ&gt;&#39;</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">END</span><span class="token punctuation">;</span>

<span class="token keyword">BEGIN</span> 
  DBMS_ADVISOR<span class="token punctuation">.</span>SET_TASK_PARAMETER <span class="token punctuation">(</span>
    :template_name
<span class="token punctuation">,</span>   <span class="token string">&#39;MVIEW_NAME_TEMPLATE&#39;</span>
<span class="token punctuation">,</span>   <span class="token string">&#39;SH_MV$$_&lt;SEQ&gt;&#39;</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">END</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>基于预先存在的模板创建任务</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code>VARIABLE task_id NUMBER<span class="token punctuation">;</span>
VARIABLE task_name VARCHAR2<span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">EXECUTE</span> :task_name :<span class="token operator">=</span> <span class="token string">&#39;NEWTASK&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">BEGIN</span> 
  DBMS_ADVISOR<span class="token punctuation">.</span>CREATE_TASK <span class="token punctuation">(</span>
    <span class="token string">&#39;SQL Access Advisor&#39;</span>
<span class="token punctuation">,</span>   :task_id
<span class="token punctuation">,</span>   :task_name
<span class="token punctuation">,</span>   template<span class="token operator">=</span><span class="token operator">&gt;</span><span class="token string">&#39;MY_TEMPLATE&#39;</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">END</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="终止-sql-access-advisor-任务执行" tabindex="-1"><a class="header-anchor" href="#终止-sql-access-advisor-任务执行"><span>终止 SQL Access Advisor 任务执行</span></a></h4><ul><li>1中断 SQL 访问顾问任务</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">EXECUTE</span> DBMS_ADVISOR<span class="token punctuation">.</span>INTERRUPT_TASK <span class="token punctuation">(</span><span class="token string">&#39;MYTASK&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>取消 SQL Access Advisor 任务</li></ul>`,106),K=s("div",{class:"language-sql line-numbers-mode","data-ext":"sql","data-title":"sql"},[s("pre",{class:"language-sql"},[s("code",null,[s("span",{class:"token keyword"},"EXECUTE"),n(" DBMS_ADVISOR"),s("span",{class:"token punctuation"},"."),n("CANCEL_TASK "),s("span",{class:"token punctuation"},"("),s("span",{class:"token string"},"'MYTASK'"),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},";"),n(`
`)])]),s("div",{class:"line-numbers","aria-hidden":"true"},[s("div",{class:"line-number"})])],-1),F=s("div",{class:"language-sql line-numbers-mode","data-ext":"sql","data-title":"sql"},[s("pre",{class:"language-sql"},[s("code",null,[s("span",{class:"token keyword"},"EXECUTE"),n(" DBMS_ADVISOR"),s("span",{class:"token punctuation"},"."),n("RESET_TASK"),s("span",{class:"token punctuation"},"("),s("span",{class:"token string"},"'MYTASK'"),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},";"),n(`
`)])]),s("div",{class:"line-numbers","aria-hidden":"true"},[s("div",{class:"line-number"})])],-1),G=l(`<div class="hint-container warning"><p class="hint-container-title">注意</p><p>DBMS_ADVISOR.CANCEL_TASK有效将任务恢复到取消操作开始之前的状态。因此，取消的任务或数据对象无法重新启动。</p><p>DBMS_ADVISOR.RESET_TASK过程将任务重置为其初始起点，其效果是从任务中删除所有建议和中间数据。</p></div><h4 id="删除-sql-访问顾问任务" tabindex="-1"><a class="header-anchor" href="#删除-sql-访问顾问任务"><span>删除 SQL 访问顾问任务</span></a></h4><ul><li>查询现有的 SQL Access Advisor 任务</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> TASK_NAME 
<span class="token keyword">FROM</span>   USER_ADVISOR_TASKS 
<span class="token keyword">WHERE</span>  ADVISOR_NAME <span class="token operator">=</span> <span class="token string">&#39;SQL Access Advisor&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>删除关联的Workload</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">EXECUTE</span> DBMS_ADVISOR<span class="token punctuation">.</span>DELETE_STS_REF<span class="token punctuation">(</span><span class="token string">&#39;MYTASK&#39;</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token string">&#39;MY_STS_WORKLOAD&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>删除所需的任务</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">EXECUTE</span> DBMS_ADVISOR<span class="token punctuation">.</span>DELETE_TASK<span class="token punctuation">(</span><span class="token string">&#39;MYTASK&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="标记-sql-access-advisor-建议" tabindex="-1"><a class="header-anchor" href="#标记-sql-access-advisor-建议"><span>标记 SQL Access Advisor 建议</span></a></h4><p>使用该DBMS_ADVISOR.MARK_RECOMMENDATION过程选择跳过或排除选定的建议。</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">EXECUTE</span> DBMS_ADVISOR<span class="token punctuation">.</span>MARK_RECOMMENDATION<span class="token punctuation">(</span><span class="token string">&#39;MYTASK&#39;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&#39;REJECT&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="修改-sql-access-advisor-建议" tabindex="-1"><a class="header-anchor" href="#修改-sql-access-advisor-建议"><span>修改 SQL Access Advisor 建议</span></a></h4><p>使用该UPDATE_REC_ATTRIBUTES过程，SQL Access Advisor 在分析过程中为新对象（例如索引和物化视图）命名并分配所有权。</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">BEGIN</span> 
  DBMS_ADVISOR<span class="token punctuation">.</span>UPDATE_REC_ATTRIBUTES <span class="token punctuation">(</span>
    <span class="token string">&#39;MYTASK&#39;</span>
<span class="token punctuation">,</span>   <span class="token number">1</span>
<span class="token punctuation">,</span>   <span class="token number">1</span>
<span class="token punctuation">,</span>   <span class="token string">&#39;TABLESPACE&#39;</span>
<span class="token punctuation">,</span>   <span class="token string">&#39;SH_MVIEWS&#39;</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">END</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,14);function H(Y,X){const c=o("ExternalLinkIcon"),i=o("CodeTabs");return r(),d("div",null,[N,s("p",null,[s("a",Q,[n("参考地址"),p(c)])]),O,p(i,{id:"142",data:[{id:"显示 STS 的内容"},{id:"特定用户"}],active:0},{title0:a(({value:e,isActive:t})=>[n("显示 STS 的内容")]),title1:a(({value:e,isActive:t})=>[n("特定用户")]),tab0:a(({value:e,isActive:t})=>[D]),tab1:a(({value:e,isActive:t})=>[M]),_:1}),U,p(i,{id:"518",data:[{id:"SQL1"},{id:"SQL2"},{id:"SQL3"}],active:0},{title0:a(({value:e,isActive:t})=>[n("SQL1")]),title1:a(({value:e,isActive:t})=>[n("SQL2")]),title2:a(({value:e,isActive:t})=>[n("SQL3")]),tab0:a(({value:e,isActive:t})=>[I]),tab1:a(({value:e,isActive:t})=>[C]),tab2:a(({value:e,isActive:t})=>[B]),_:1}),x,p(i,{id:"581",data:[{id:"基于sql_id"},{id:"基于sql_text"}],active:0},{title0:a(({value:e,isActive:t})=>[n("基于sql_id")]),title1:a(({value:e,isActive:t})=>[n("基于sql_text")]),tab0:a(({value:e,isActive:t})=>[P]),tab1:a(({value:e,isActive:t})=>[f]),_:1}),V,p(i,{id:"1037",data:[{id:"CANCEL_TASK"},{id:"RESET_TASK"}],active:0},{title0:a(({value:e,isActive:t})=>[n("CANCEL_TASK")]),title1:a(({value:e,isActive:t})=>[n("RESET_TASK")]),tab0:a(({value:e,isActive:t})=>[K]),tab1:a(({value:e,isActive:t})=>[F]),_:1}),G])}const Z=u(w,[["render",H],["__file","sqltuning.html.vue"]]),j=JSON.parse('{"path":"/guide/database/oracle/performance/sqltuning.html","title":"SQL优化","lang":"zh-CN","frontmatter":{"title":"SQL优化","description":"自动 SQL 调优介绍 Oracle数据库使用优化器为提交的SQL语句生成执行计划。这优化器以以下模式运行： 正常模式 优化器编译SQL并生成执行计划。普通模式为绝大多数SQL语句生成合理的计划。在正常模式下，优化器的运行时间限制非常严格，通常是几分之一秒。 调优模式 优化器执行额外的分析来检查是否可以进一步改进在正常模式下生成的计划。优化器输出不是执...","head":[["meta",{"property":"og:url","content":"https://github.com/abelit/abelit-datapeacock.git/guide/database/oracle/performance/sqltuning.html"}],["meta",{"property":"og:site_name","content":"数之雀"}],["meta",{"property":"og:title","content":"SQL优化"}],["meta",{"property":"og:description","content":"自动 SQL 调优介绍 Oracle数据库使用优化器为提交的SQL语句生成执行计划。这优化器以以下模式运行： 正常模式 优化器编译SQL并生成执行计划。普通模式为绝大多数SQL语句生成合理的计划。在正常模式下，优化器的运行时间限制非常严格，通常是几分之一秒。 调优模式 优化器执行额外的分析来检查是否可以进一步改进在正常模式下生成的计划。优化器输出不是执..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-05-11T14:06:18.000Z"}],["meta",{"property":"article:author","content":"Abelit"}],["meta",{"property":"article:modified_time","content":"2024-05-11T14:06:18.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"SQL优化\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2024-05-11T14:06:18.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Abelit\\",\\"url\\":\\"https://github.com/abelit\\"}]}"]]},"headers":[{"level":2,"title":"自动 SQL 调优介绍","slug":"自动-sql-调优介绍","link":"#自动-sql-调优介绍","children":[{"level":3,"title":"自动调优主要功能","slug":"自动调优主要功能","link":"#自动调优主要功能","children":[]}]},{"level":2,"title":"SQL优化集","slug":"sql优化集","link":"#sql优化集","children":[{"level":3,"title":"创建 SQL 调优集","slug":"创建-sql-调优集","link":"#创建-sql-调优集","children":[]},{"level":3,"title":"查看 SQL 调优集状态","slug":"查看-sql-调优集状态","link":"#查看-sql-调优集状态","children":[]},{"level":3,"title":"加载 SQL 调优集","slug":"加载-sql-调优集","link":"#加载-sql-调优集","children":[]},{"level":3,"title":"查询 SQL 调优集","slug":"查询-sql-调优集","link":"#查询-sql-调优集","children":[]},{"level":3,"title":"修改SQL调优集","slug":"修改sql调优集","link":"#修改sql调优集","children":[]},{"level":3,"title":"传输 SQL 调优集","slug":"传输-sql-调优集","link":"#传输-sql-调优集","children":[]},{"level":3,"title":"删除 SQL 调优集","slug":"删除-sql-调优集","link":"#删除-sql-调优集","children":[]}]},{"level":2,"title":"SQL配置文件","slug":"sql配置文件","link":"#sql配置文件","children":[{"level":3,"title":"接受SQL配置建议","slug":"接受sql配置建议","link":"#接受sql配置建议","children":[]},{"level":3,"title":"修改SQL配置","slug":"修改sql配置","link":"#修改sql配置","children":[]},{"level":3,"title":"删除SQL配置","slug":"删除sql配置","link":"#删除sql配置","children":[]},{"level":3,"title":"传输SQL配置","slug":"传输sql配置","link":"#传输sql配置","children":[]}]},{"level":2,"title":"SQL Tuning Advisor","slug":"sql-tuning-advisor","link":"#sql-tuning-advisor","children":[{"level":3,"title":"SQL Tuning Advisor架构","slug":"sql-tuning-advisor架构","link":"#sql-tuning-advisor架构","children":[]},{"level":3,"title":"自动SQL调优","slug":"自动sql调优","link":"#自动sql调优","children":[]},{"level":3,"title":"手动SQL调优","slug":"手动sql调优","link":"#手动sql调优","children":[]}]},{"level":2,"title":"SQL Access Advisor","slug":"sql-access-advisor","link":"#sql-access-advisor","children":[{"level":3,"title":"SQL Access Advisor 的用途","slug":"sql-access-advisor-的用途","link":"#sql-access-advisor-的用途","children":[]},{"level":3,"title":"SQL Access Advisor 架构","slug":"sql-access-advisor-架构","link":"#sql-access-advisor-架构","children":[]},{"level":3,"title":"SQL Access Advisor（基础任务）","slug":"sql-access-advisor-基础任务","link":"#sql-access-advisor-基础任务","children":[]},{"level":3,"title":"SQL Access Advisor（高级任务）","slug":"sql-access-advisor-高级任务","link":"#sql-access-advisor-高级任务","children":[]}]}],"git":{"createdTime":1715436378000,"updatedTime":1715436378000,"contributors":[{"name":"ableit","email":"ychenid@live.com","commits":1}]},"readingTime":{"minutes":18.41,"words":5522},"filePathRelative":"guide/database/oracle/performance/sqltuning.md","localizedDate":"2024年5月11日","autoDesc":true,"excerpt":"<h2>自动 SQL 调优介绍</h2>\\n<p>Oracle数据库使用优化器为提交的SQL语句生成执行计划。这优化器以以下模式运行：</p>\\n<ul>\\n<li>正常模式</li>\\n</ul>\\n<p>优化器编译SQL并生成执行计划。普通模式为绝大多数SQL语句生成合理的计划。在正常模式下，优化器的运行时间限制非常严格，通常是几分之一秒。</p>\\n<ul>\\n<li>调优模式</li>\\n</ul>\\n<p>优化器执行额外的分析来检查是否可以进一步改进在正常模式下生成的计划。优化器输出不是执行计划，而是一系列操作，以及生成明显更好的计划的基本原理和预期收益。当在调优模式下运行时，优化器被称为自动调整优化器。</p>"}');export{Z as comp,j as data};
