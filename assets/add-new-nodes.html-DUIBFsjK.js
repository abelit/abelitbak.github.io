import{_ as l}from"./plugin-vue_export-helper-DlAUqK2U.js";import{r as p,o,c as i,a as n,d as s,b as e,f as t}from"./app-DR5J2daJ.js";const c={},u={href:"https://github.com/kubesphere/kubekey",target:"_blank",rel:"noopener noreferrer"},r=n("p",null,"本教程演示了如何将新节点添加到单节点集群。若要水平扩展多节点集群，操作步骤基本相同。",-1),d=n("h2",{id:"准备工作",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#准备工作"},[n("span",null,"准备工作")])],-1),k={href:"https://kubesphere.io/zh/docs/v3.3/quick-start/all-in-one-on-linux/",target:"_blank",rel:"noopener noreferrer"},v={href:"https://kubesphere.io/zh/docs/v3.3/installing-on-linux/introduction/multioverview/#%E6%AD%A5%E9%AA%A4-2%E4%B8%8B%E8%BD%BD-kubekey",target:"_blank",rel:"noopener noreferrer"},m=t(`<h2 id="添加工作节点" tabindex="-1"><a class="header-anchor" href="#添加工作节点"><span>添加工作节点</span></a></h2><ol><li><p>使用 KubeKey 检索集群信息。以下命令会创建配置文件 (<code>sample.yaml</code>)。</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>./kk create config --from-cluster
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ol><div class="hint-container tip"><p class="hint-container-title">提示</p><p>如果您的机器上已有配置文件，就可以跳过此步骤。例如，若要将节点添加到由 KubeKey 设置的多节点集群，如果您没有删除该集群，则可能仍拥有该配置文件。</p></div><ol start="2"><li><p>在配置文件中，将新节点的信息放在 <code>hosts</code> 和 <code>roleGroups</code> 之下。该示例添加了两个新节点（即 <code>node1</code> 和 <code>node2</code>）。这里的 <code>master1</code> 是现有节点。</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>···
spec:
  hosts:
  - <span class="token punctuation">{</span>name: master1, address: <span class="token number">192.168</span>.0.3, internalAddress: <span class="token number">192.168</span>.0.3, user: root, password: Qcloud@123<span class="token punctuation">}</span>
  - <span class="token punctuation">{</span>name: node1, address: <span class="token number">192.168</span>.0.4, internalAddress: <span class="token number">192.168</span>.0.4, user: root, password: Qcloud@123<span class="token punctuation">}</span>
  - <span class="token punctuation">{</span>name: node2, address: <span class="token number">192.168</span>.0.5, internalAddress: <span class="token number">192.168</span>.0.5, user: root, password: Qcloud@123<span class="token punctuation">}</span>
  roleGroups:
    etcd:
    - master1
    control-plane:
    - master1
    worker:
    - node1
    - node2
···
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol>`,4),b={class:"hint-container tip"},h=n("p",{class:"hint-container-title"},"提示",-1),y={href:"https://kubesphere.io/zh/docs/v3.3/installing-on-linux/introduction/multioverview/#2-%E7%BC%96%E8%BE%91%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6",target:"_blank",rel:"noopener noreferrer"},g=n("li",null,[n("p",null,"添加新节点时，请勿修改现有节点的主机名。")],-1),_=n("li",null,[n("p",null,"用自己的主机名替换示例中的主机名。")],-1),f=t(`<ol start="3"><li><p>执行以下命令：</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>./kk <span class="token function">add</span> nodes <span class="token parameter variable">-f</span> sample.yaml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>安装完成后，您将能够在 KubeSphere 的控制台上查看新节点及其信息。在<strong>集群管理</strong>页面，选择左侧菜单<strong>节点</strong>下的<strong>集群节点</strong>，或者执行命令 <code>kubectl get node</code> 以检查更改。</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>$ kubectl get <span class="token function">node</span>
NAME          STATUS   ROLES           AGE   VERSION
master1       Ready    master,worker   20d   v1.17.9
node1         Ready    worker          31h   v1.17.9
node2         Ready    worker          31h   v1.17.9
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><h2 id="添加主节点以实现高可用" tabindex="-1"><a class="header-anchor" href="#添加主节点以实现高可用"><span>添加主节点以实现高可用</span></a></h2>`,2),K={href:"https://www.haproxy.com/",target:"_blank",rel:"noopener noreferrer"},x=t(`<ol><li><p>使用 KubeKey 创建配置文件。</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>./kk create config --from-cluster
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>打开文件，可以看到一些字段预先填充了值。将新节点和负载均衡器的信息添加到文件中。以下示例供您参考：</p><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> kubekey.kubesphere.io/v1alpha1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Cluster
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> sample
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">hosts</span><span class="token punctuation">:</span>
  <span class="token comment"># You should complete the ssh information of the hosts</span>
  <span class="token punctuation">-</span> <span class="token punctuation">{</span><span class="token key atrule">name</span><span class="token punctuation">:</span> master1<span class="token punctuation">,</span> <span class="token key atrule">address</span><span class="token punctuation">:</span> 172.16.0.2<span class="token punctuation">,</span> <span class="token key atrule">internalAddress</span><span class="token punctuation">:</span> 172.16.0.2<span class="token punctuation">,</span> <span class="token key atrule">user</span><span class="token punctuation">:</span> root<span class="token punctuation">,</span> <span class="token key atrule">password</span><span class="token punctuation">:</span> Testing123<span class="token punctuation">}</span>
  <span class="token punctuation">-</span> <span class="token punctuation">{</span><span class="token key atrule">name</span><span class="token punctuation">:</span> master2<span class="token punctuation">,</span> <span class="token key atrule">address</span><span class="token punctuation">:</span> 172.16.0.5<span class="token punctuation">,</span> <span class="token key atrule">internalAddress</span><span class="token punctuation">:</span> 172.16.0.5<span class="token punctuation">,</span> <span class="token key atrule">user</span><span class="token punctuation">:</span> root<span class="token punctuation">,</span> <span class="token key atrule">password</span><span class="token punctuation">:</span> Testing123<span class="token punctuation">}</span>
  <span class="token punctuation">-</span> <span class="token punctuation">{</span><span class="token key atrule">name</span><span class="token punctuation">:</span> master3<span class="token punctuation">,</span> <span class="token key atrule">address</span><span class="token punctuation">:</span> 172.16.0.6<span class="token punctuation">,</span> <span class="token key atrule">internalAddress</span><span class="token punctuation">:</span> 172.16.0.6<span class="token punctuation">,</span> <span class="token key atrule">user</span><span class="token punctuation">:</span> root<span class="token punctuation">,</span> <span class="token key atrule">password</span><span class="token punctuation">:</span> Testing123<span class="token punctuation">}</span>
  <span class="token punctuation">-</span> <span class="token punctuation">{</span><span class="token key atrule">name</span><span class="token punctuation">:</span> worker1<span class="token punctuation">,</span> <span class="token key atrule">address</span><span class="token punctuation">:</span> 172.16.0.3<span class="token punctuation">,</span> <span class="token key atrule">internalAddress</span><span class="token punctuation">:</span> 172.16.0.3<span class="token punctuation">,</span> <span class="token key atrule">user</span><span class="token punctuation">:</span> root<span class="token punctuation">,</span> <span class="token key atrule">password</span><span class="token punctuation">:</span> Testing123<span class="token punctuation">}</span>
  <span class="token punctuation">-</span> <span class="token punctuation">{</span><span class="token key atrule">name</span><span class="token punctuation">:</span> worker2<span class="token punctuation">,</span> <span class="token key atrule">address</span><span class="token punctuation">:</span> 172.16.0.4<span class="token punctuation">,</span> <span class="token key atrule">internalAddress</span><span class="token punctuation">:</span> 172.16.0.4<span class="token punctuation">,</span> <span class="token key atrule">user</span><span class="token punctuation">:</span> root<span class="token punctuation">,</span> <span class="token key atrule">password</span><span class="token punctuation">:</span> Testing123<span class="token punctuation">}</span>
  <span class="token punctuation">-</span> <span class="token punctuation">{</span><span class="token key atrule">name</span><span class="token punctuation">:</span> worker3<span class="token punctuation">,</span> <span class="token key atrule">address</span><span class="token punctuation">:</span> 172.16.0.7<span class="token punctuation">,</span> <span class="token key atrule">internalAddress</span><span class="token punctuation">:</span> 172.16.0.7<span class="token punctuation">,</span> <span class="token key atrule">user</span><span class="token punctuation">:</span> root<span class="token punctuation">,</span> <span class="token key atrule">password</span><span class="token punctuation">:</span> Testing123<span class="token punctuation">}</span>
  <span class="token key atrule">roleGroups</span><span class="token punctuation">:</span>
    <span class="token key atrule">etcd</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> master1
    <span class="token punctuation">-</span> master2
    <span class="token punctuation">-</span> master3
    <span class="token key atrule">control-plane</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> master1
    <span class="token punctuation">-</span> master2
    <span class="token punctuation">-</span> master3
    <span class="token key atrule">worker</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> worker1
    <span class="token punctuation">-</span> worker2
    <span class="token punctuation">-</span> worker3
  <span class="token key atrule">controlPlaneEndpoint</span><span class="token punctuation">:</span>
    <span class="token comment"># If loadbalancer is used, &#39;address&#39; should be set to loadbalancer&#39;s ip.</span>
    <span class="token key atrule">domain</span><span class="token punctuation">:</span> lb.kubesphere.local
    <span class="token key atrule">address</span><span class="token punctuation">:</span> 172.16.0.253
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">6443</span>
  <span class="token key atrule">kubernetes</span><span class="token punctuation">:</span>
    <span class="token key atrule">version</span><span class="token punctuation">:</span> v1.22.12
    <span class="token key atrule">imageRepo</span><span class="token punctuation">:</span> kubesphere
    <span class="token key atrule">clusterName</span><span class="token punctuation">:</span> cluster.local
    <span class="token key atrule">proxyMode</span><span class="token punctuation">:</span> ipvs
    <span class="token key atrule">masqueradeAll</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
    <span class="token key atrule">maxPods</span><span class="token punctuation">:</span> <span class="token number">110</span>
    <span class="token key atrule">nodeCidrMaskSize</span><span class="token punctuation">:</span> <span class="token number">24</span>
  <span class="token key atrule">network</span><span class="token punctuation">:</span>
    <span class="token key atrule">plugin</span><span class="token punctuation">:</span> calico
    <span class="token key atrule">kubePodsCIDR</span><span class="token punctuation">:</span> 10.233.64.0/18
    <span class="token key atrule">kubeServiceCIDR</span><span class="token punctuation">:</span> 10.233.0.0/18
  <span class="token key atrule">registry</span><span class="token punctuation">:</span>
    <span class="token key atrule">privateRegistry</span><span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>请注意 <code>controlPlaneEndpoint</code> 字段。</p><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code>  <span class="token key atrule">controlPlaneEndpoint</span><span class="token punctuation">:</span>
    <span class="token comment"># If you use a load balancer, the address should be set to the load balancer&#39;s ip.</span>
    <span class="token key atrule">domain</span><span class="token punctuation">:</span> lb.kubesphere.local
    <span class="token key atrule">address</span><span class="token punctuation">:</span> 172.16.0.253
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">6443</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>负载均衡器的域名默认为 <code>lb.kubesphere.local</code>，用于内部访问。您可以按需进行更改。</li><li>大多数情况下，您需要为 <code>address</code> 字段提供负载均衡器的<strong>私有 IP 地址</strong>。然而，不同的云厂商可能为负载均衡器进行不同的配置。例如，如果您在阿里云上配置服务器负载均衡 (SLB)，该平台会为 SLB 分配一个公共 IP 地址，这意味着您需要为 <code>address</code> 字段指定公共 IP 地址。</li><li><code>port</code> 字段指代 <code>api-server</code> 的端口。</li></ul></li><li><p>保存文件并执行以下命令以应用配置。</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>./kk <span class="token function">add</span> nodes <span class="token parameter variable">-f</span> sample.yaml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ol>`,1);function w(S,A){const a=p("ExternalLinkIcon");return o(),i("div",null,[n("p",null,[s("KubeSphere 使用一段时间之后，由于工作负载不断增加，您可能需要水平扩展集群。自 KubeSphere v3.0.0 起，您可以使用全新的安装程序 "),n("a",u,[s("KubeKey"),e(a)]),s(" 将新节点添加到集群。从根本上说，该操作是基于 Kubelet 的注册机制。换言之，新节点将自动加入现有的 Kubernetes 集群。KubeSphere 支持混合环境，这意味着新添加的主机操作系统可以是 CentOS 或者 Ubuntu。")]),r,d,n("ul",null,[n("li",null,[n("p",null,[s("您需要一个单节点集群。有关更多信息，请参见"),n("a",k,[s("在 Linux 上以 All-in-One 模式安装 KubeSphere"),e(a)]),s("。")])]),n("li",null,[n("p",null,[s("您需要已经"),n("a",v,[s("下载了 KubeKey"),e(a)]),s("。")])])]),m,n("div",b,[h,n("ul",null,[n("li",null,[n("p",null,[s("有关更多配置文件的信息，请参见"),n("a",y,[s("编辑配置文件"),e(a)]),s("。")])]),g,_])]),f,n("p",null,[s("添加主节点的步骤与添加工作节点的步骤大体一致，不过您需要为集群配置负载均衡器。您可以使用任何云负载均衡器或者硬件负载均衡器（例如 F5）。另外，Keepalived 和 "),n("a",K,[s("HAproxy"),e(a)]),s("、或者 Nginx 也是创建高可用集群的替代方案。")]),x])}const T=l(c,[["render",w],["__file","add-new-nodes.html.vue"]]),N=JSON.parse('{"path":"/guide/cloudnative/kubesphere/install-on-linux/cluster-operation/add-new-nodes.html","title":"添加新节点","lang":"zh-CN","frontmatter":{"title":"添加新节点","description":"KubeSphere 使用一段时间之后，由于工作负载不断增加，您可能需要水平扩展集群。自 KubeSphere v3.0.0 起，您可以使用全新的安装程序 KubeKey 将新节点添加到集群。从根本上说，该操作是基于 Kubelet 的注册机制。换言之，新节点将自动加入现有的 Kubernetes 集群。KubeSphere 支持混合环境，这意味着新添...","head":[["meta",{"property":"og:url","content":"https://github.com/abelit/abelit-datapeacock.git/guide/cloudnative/kubesphere/install-on-linux/cluster-operation/add-new-nodes.html"}],["meta",{"property":"og:site_name","content":"数之雀"}],["meta",{"property":"og:title","content":"添加新节点"}],["meta",{"property":"og:description","content":"KubeSphere 使用一段时间之后，由于工作负载不断增加，您可能需要水平扩展集群。自 KubeSphere v3.0.0 起，您可以使用全新的安装程序 KubeKey 将新节点添加到集群。从根本上说，该操作是基于 Kubelet 的注册机制。换言之，新节点将自动加入现有的 Kubernetes 集群。KubeSphere 支持混合环境，这意味着新添..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-05-11T14:06:18.000Z"}],["meta",{"property":"article:author","content":"Abelit"}],["meta",{"property":"article:modified_time","content":"2024-05-11T14:06:18.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"添加新节点\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2024-05-11T14:06:18.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Abelit\\",\\"url\\":\\"https://github.com/abelit\\"}]}"]]},"headers":[{"level":2,"title":"准备工作","slug":"准备工作","link":"#准备工作","children":[]},{"level":2,"title":"添加工作节点","slug":"添加工作节点","link":"#添加工作节点","children":[]},{"level":2,"title":"添加主节点以实现高可用","slug":"添加主节点以实现高可用","link":"#添加主节点以实现高可用","children":[]}],"git":{"createdTime":1715436378000,"updatedTime":1715436378000,"contributors":[{"name":"ableit","email":"ychenid@live.com","commits":1}]},"readingTime":{"minutes":3.54,"words":1063},"filePathRelative":"guide/cloudnative/kubesphere/install-on-linux/cluster-operation/add-new-nodes.md","localizedDate":"2024年5月11日","autoDesc":true,"excerpt":"<p>KubeSphere 使用一段时间之后，由于工作负载不断增加，您可能需要水平扩展集群。自 KubeSphere v3.0.0 起，您可以使用全新的安装程序 <a href=\\"https://github.com/kubesphere/kubekey\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">KubeKey</a> 将新节点添加到集群。从根本上说，该操作是基于 Kubelet 的注册机制。换言之，新节点将自动加入现有的 Kubernetes 集群。KubeSphere 支持混合环境，这意味着新添加的主机操作系统可以是 CentOS 或者 Ubuntu。</p>"}');export{T as comp,N as data};
