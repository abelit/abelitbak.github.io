import{_ as s}from"./plugin-vue_export-helper-DlAUqK2U.js";import{o as n,c as a,f as e}from"./app-DR5J2daJ.js";const t={},l=e(`<h2 id="system表空间清理" tabindex="-1"><a class="header-anchor" href="#system表空间清理"><span>SYSTEM表空间清理</span></a></h2><h3 id="空间使用信息查询" tabindex="-1"><a class="header-anchor" href="#空间使用信息查询"><span>空间使用信息查询</span></a></h3><ul><li>查看 SYSTEM 表空间表中段的使用情况</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span>
    segment_name<span class="token punctuation">,</span>
    bytes <span class="token operator">/</span> <span class="token number">1024</span> <span class="token operator">/</span> <span class="token number">1024</span> <span class="token operator">/</span> <span class="token number">1024</span> sizegb<span class="token punctuation">,</span>
    segment_type
<span class="token keyword">FROM</span>
    dba_segments
<span class="token keyword">WHERE</span>
    tablespace_name <span class="token operator">=</span> <span class="token string">&#39;SYSTEM&#39;</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span>
    bytes <span class="token keyword">DESC</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>查询system表空间审计表的大小段</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span>
    owner<span class="token punctuation">,</span>
    table_name<span class="token punctuation">,</span>
    <span class="token function">SUM</span><span class="token punctuation">(</span>decode<span class="token punctuation">(</span>seg_type<span class="token punctuation">,</span> <span class="token string">&#39;table&#39;</span><span class="token punctuation">,</span> size_mb<span class="token punctuation">)</span><span class="token punctuation">)</span> datasze_mb<span class="token punctuation">,</span>
    <span class="token function">SUM</span><span class="token punctuation">(</span>decode<span class="token punctuation">(</span>seg_type<span class="token punctuation">,</span> <span class="token string">&#39;index&#39;</span><span class="token punctuation">,</span> size_mb<span class="token punctuation">)</span><span class="token punctuation">)</span> idxsz_mb<span class="token punctuation">,</span>
    <span class="token function">SUM</span><span class="token punctuation">(</span>decode<span class="token punctuation">(</span>seg_type<span class="token punctuation">,</span> <span class="token string">&#39;lob&#39;</span><span class="token punctuation">,</span> size_mb<span class="token punctuation">)</span><span class="token punctuation">)</span>   logsz_mb<span class="token punctuation">,</span>
    <span class="token function">SUM</span><span class="token punctuation">(</span>size_mb<span class="token punctuation">)</span>                            tbszie_mb
<span class="token keyword">FROM</span>
    <span class="token punctuation">(</span> <span class="token comment">---所有表大小</span>
        <span class="token keyword">SELECT</span>
            t<span class="token punctuation">.</span>owner<span class="token punctuation">,</span>
            t<span class="token punctuation">.</span>table_name<span class="token punctuation">,</span>
            <span class="token function">SUM</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>bytes<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1024</span> <span class="token operator">/</span> <span class="token number">1024</span> size_mb<span class="token punctuation">,</span>
            <span class="token string">&#39;table&#39;</span>                    seg_type
        <span class="token keyword">FROM</span>
            dba_segments s<span class="token punctuation">,</span>
            dba_tables   t
        <span class="token keyword">WHERE</span>
                s<span class="token punctuation">.</span>owner <span class="token operator">=</span> t<span class="token punctuation">.</span>owner
            <span class="token operator">AND</span> s<span class="token punctuation">.</span>segment_name <span class="token operator">=</span> t<span class="token punctuation">.</span>table_name
        <span class="token keyword">GROUP</span> <span class="token keyword">BY</span>
            t<span class="token punctuation">.</span>owner<span class="token punctuation">,</span>
            t<span class="token punctuation">.</span>table_name
        <span class="token keyword">UNION</span> <span class="token keyword">ALL</span>
<span class="token comment">---大字段大小</span>
        <span class="token keyword">SELECT</span>
            l<span class="token punctuation">.</span>owner<span class="token punctuation">,</span>
            l<span class="token punctuation">.</span>table_name<span class="token punctuation">,</span>
            <span class="token function">SUM</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>bytes<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1024</span> <span class="token operator">/</span> <span class="token number">1024</span> size_mb<span class="token punctuation">,</span>
            <span class="token string">&#39;lob&#39;</span>                      seg_type
        <span class="token keyword">FROM</span>
            dba_segments s<span class="token punctuation">,</span>
            dba_lobs     l
        <span class="token keyword">WHERE</span>
                s<span class="token punctuation">.</span>owner <span class="token operator">=</span> l<span class="token punctuation">.</span>owner
            <span class="token operator">AND</span> s<span class="token punctuation">.</span>segment_name <span class="token operator">=</span> l<span class="token punctuation">.</span>segment_name
        <span class="token keyword">GROUP</span> <span class="token keyword">BY</span>
            l<span class="token punctuation">.</span>owner<span class="token punctuation">,</span>
            l<span class="token punctuation">.</span>table_name
        <span class="token keyword">UNION</span> <span class="token keyword">ALL</span>
<span class="token comment">---索引段大小</span>
        <span class="token keyword">SELECT</span>
            i<span class="token punctuation">.</span>table_owner<span class="token punctuation">,</span>
            i<span class="token punctuation">.</span>table_name<span class="token punctuation">,</span>
            <span class="token function">SUM</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>bytes<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1024</span> <span class="token operator">/</span> <span class="token number">1024</span> size_mb<span class="token punctuation">,</span>
            <span class="token string">&#39;index&#39;</span>                    seg_type
        <span class="token keyword">FROM</span>
            dba_segments s<span class="token punctuation">,</span>
            dba_indexes  i
        <span class="token keyword">WHERE</span>
                s<span class="token punctuation">.</span>owner <span class="token operator">=</span> i<span class="token punctuation">.</span>owner
            <span class="token operator">AND</span> s<span class="token punctuation">.</span>segment_name <span class="token operator">=</span> i<span class="token punctuation">.</span>index_name
        <span class="token keyword">GROUP</span> <span class="token keyword">BY</span>
            i<span class="token punctuation">.</span>table_owner<span class="token punctuation">,</span>
            i<span class="token punctuation">.</span>table_name
    <span class="token punctuation">)</span>
<span class="token keyword">WHERE</span>
        owner <span class="token operator">=</span> <span class="token string">&#39;SYS&#39;</span>
    <span class="token operator">AND</span> table_name <span class="token operator">=</span> <span class="token string">&#39;AUD$&#39;</span>
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span>
    owner<span class="token punctuation">,</span>
    table_name<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>释放空间 根据查询出来的审计表大小，分段释放空间</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">TRUNCATE</span> <span class="token keyword">TABLE</span> sys<span class="token punctuation">.</span>aud$ reuse storage<span class="token punctuation">;</span>

<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> sys<span class="token punctuation">.</span>aud$ <span class="token keyword">deallocate</span> unused keep <span class="token number">500</span>M<span class="token punctuation">;</span>

<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> sys<span class="token punctuation">.</span>aud$ <span class="token keyword">deallocate</span> unused keep <span class="token number">0</span>M<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>找出目前SYSTEM表空间最大的block_id</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token function">MAX</span><span class="token punctuation">(</span>block_id<span class="token punctuation">)</span>
<span class="token keyword">FROM</span> dba_extents
<span class="token keyword">WHERE</span> tablespace_name <span class="token operator">=</span> <span class="token string">&#39;SYSTEM&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这里查询查询结果是： 153968</p><ul><li>查看数据库快大小</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">show</span> parameter db_block_size<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>这里查询查询结果是： 8192 (8k)</p><ul><li>计算占用空间</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token number">153968</span><span class="token operator">*</span><span class="token number">8192</span><span class="token operator">/</span><span class="token number">1024</span><span class="token operator">/</span><span class="token number">1024</span> <span class="token keyword">from</span> dual<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>这里查询查询结果是： 1202.875M</p><ul><li>收缩表空间 因此目前该表空间只能收缩到1202.875M左右</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">ALTER</span> <span class="token keyword">DATABASE</span> DATAFILE <span class="token string">&#39;/data/hdmtxdb1/datafile/hdmtxdb1/system01.dbf&#39;</span> RESIZE <span class="token number">1250</span>M<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="sysaux表空间清理" tabindex="-1"><a class="header-anchor" href="#sysaux表空间清理"><span>SYSAUX表空间清理</span></a></h2><h3 id="空间使用信息查询-1" tabindex="-1"><a class="header-anchor" href="#空间使用信息查询-1"><span>空间使用信息查询</span></a></h3><ul><li>查看表 SYSAUX 表空间占用情况</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span>
    occupant_name<span class="token punctuation">,</span>
    occupant_desc<span class="token punctuation">,</span>
    space_usage_kbytes <span class="token operator">/</span> <span class="token number">1024</span> mb
<span class="token keyword">FROM</span>
    v$sysaux_occupants
<span class="token keyword">WHERE</span>
    space_usage_kbytes <span class="token operator">&gt;</span> <span class="token number">0</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span>
    space_usage_kbytes <span class="token keyword">DESC</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>查看 SYSAUX 表空间表中段的使用情况</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span>
    segment_name<span class="token punctuation">,</span>
    bytes <span class="token operator">/</span> <span class="token number">1024</span> <span class="token operator">/</span> <span class="token number">1024</span> <span class="token operator">/</span> <span class="token number">1024</span> sizegb<span class="token punctuation">,</span>
    segment_type
<span class="token keyword">FROM</span>
    dba_segments
<span class="token keyword">WHERE</span>
    tablespace_name <span class="token operator">=</span> <span class="token string">&#39;SYSAUX&#39;</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span>
    bytes <span class="token keyword">DESC</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>查看awr的保存期限</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">select</span> retention <span class="token keyword">from</span> dba_hist_wr_control<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>查询awr快照信息</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token function">min</span><span class="token punctuation">(</span>snap_id<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">max</span><span class="token punctuation">(</span>snap_id<span class="token punctuation">)</span> <span class="token keyword">from</span> dba_hist_snapshot<span class="token punctuation">;</span>
<span class="token keyword">select</span> dbid<span class="token punctuation">,</span><span class="token function">min</span><span class="token punctuation">(</span>snap_id<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">max</span><span class="token punctuation">(</span>snap_id<span class="token punctuation">)</span> <span class="token keyword">from</span> dba_hist_snapshot <span class="token keyword">group</span> <span class="token keyword">by</span> dbid<span class="token punctuation">;</span>

<span class="token keyword">select</span> <span class="token function">min</span><span class="token punctuation">(</span>snap_id<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">max</span><span class="token punctuation">(</span>snap_id<span class="token punctuation">)</span> <span class="token keyword">from</span> sys<span class="token punctuation">.</span>WRM$_SNAPSHOT <span class="token keyword">where</span> begin_interval_time <span class="token operator">&lt;</span> sysdate <span class="token operator">-</span> <span class="token number">7</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>修改awr的保存期限和移动窗口（按需）</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token comment">-- 间隔60分钟，也就是8*24*60=11520</span>
<span class="token keyword">execute</span> dbms_workload_repository<span class="token punctuation">.</span>modify_snapshot_settings <span class="token punctuation">(</span><span class="token keyword">interval</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">60</span><span class="token punctuation">,</span> retention <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">8</span><span class="token operator">*</span><span class="token number">24</span><span class="token operator">*</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token comment">-- 上面这个语句设置的时间要配合MOVING_WINDOW_SIZE参数</span>
<span class="token keyword">exec</span> DBMS_WORKLOAD_REPOSITORY<span class="token punctuation">.</span>modify_baseline_window_size<span class="token punctuation">(</span> window_size <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>查看窗口信息</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> moving_window_size
<span class="token keyword">FROM</span> dba_hist_baseline
<span class="token keyword">WHERE</span> baseline_type <span class="token operator">=</span> <span class="token string">&#39;MOVING_WINDOW&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="通过truncate清理" tabindex="-1"><a class="header-anchor" href="#通过truncate清理"><span>通过truncate清理</span></a></h3><ul><li>生成<code>truncate</code>语句</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token keyword">DISTINCT</span>
    <span class="token string">&#39;truncate table &#39;</span>
    <span class="token operator">||</span> segment_name
    <span class="token operator">||</span> <span class="token string">&#39;;&#39;</span><span class="token punctuation">,</span>
    s<span class="token punctuation">.</span>bytes <span class="token operator">/</span> <span class="token number">1024</span> <span class="token operator">/</span> <span class="token number">1024</span>
<span class="token keyword">FROM</span>
    dba_segments s
<span class="token keyword">WHERE</span>
    s<span class="token punctuation">.</span>segment_name <span class="token operator">LIKE</span> <span class="token string">&#39;WRH$%&#39;</span>
    <span class="token operator">AND</span> segment_type <span class="token operator">IN</span> <span class="token punctuation">(</span> <span class="token string">&#39;TABLE PARTITION&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;TABLE&#39;</span> <span class="token punctuation">)</span>
    <span class="token operator">AND</span> s<span class="token punctuation">.</span>bytes <span class="token operator">/</span> <span class="token number">1024</span> <span class="token operator">/</span> <span class="token number">1024</span> <span class="token operator">&gt;</span> <span class="token number">100</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span>
    s<span class="token punctuation">.</span>bytes <span class="token operator">/</span> <span class="token number">1024</span> <span class="token operator">/</span> <span class="token number">1024</span> <span class="token operator">/</span> <span class="token number">1024</span> <span class="token keyword">DESC</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>查询快照信息</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token function">MIN</span><span class="token punctuation">(</span>SNAP_ID<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">MAX</span><span class="token punctuation">(</span>SNAP_ID<span class="token punctuation">)</span> <span class="token keyword">FROM</span> DBA_HIST_SNAPSHOT<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>创建临时表，保存近8天的数据</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">table</span> abelit<span class="token punctuation">.</span>ash_20231025 <span class="token keyword">as</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> sys<span class="token punctuation">.</span>WRH$_ACTIVE_SESSION_HISTORY <span class="token keyword">where</span> SAMPLE_TIME <span class="token operator">&gt;=</span> sysdate <span class="token operator">-</span> <span class="token number">9</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>禁用AWR</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">exec</span> dbms_workload_repository<span class="token punctuation">.</span>modify_snapshot_settings<span class="token punctuation">(</span><span class="token keyword">interval</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>执行清理</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">truncate</span> <span class="token keyword">table</span> WRH$_ACTIVE_SESSION_HISTORY<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>恢复数据</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">insert</span> <span class="token keyword">into</span> sys<span class="token punctuation">.</span>WRH$_ACTIVE_SESSION_HISTORY <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> abelit<span class="token punctuation">.</span>ash_20231025<span class="token punctuation">;</span>
<span class="token keyword">commit</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>查看索引状态</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span>
    index_owner<span class="token punctuation">,</span>
    index_name<span class="token punctuation">,</span>
    partition_name<span class="token punctuation">,</span>
    <span class="token keyword">status</span><span class="token punctuation">,</span>
    tablespace_name<span class="token punctuation">,</span>
    last_analyzed
<span class="token keyword">FROM</span>
    dba_ind_partitions
<span class="token keyword">WHERE</span>
    index_name <span class="token operator">IN</span> <span class="token punctuation">(</span>
        <span class="token keyword">SELECT</span>
            index_name
        <span class="token keyword">FROM</span>
            dba_indexes
        <span class="token keyword">WHERE</span>
            table_name <span class="token operator">IN</span> <span class="token punctuation">(</span> <span class="token string">&#39;WRH$_ACTIVE_SESSION_HISTORY&#39;</span> <span class="token punctuation">)</span>
            <span class="token operator">AND</span> table_owner <span class="token operator">=</span> <span class="token string">&#39;SYS&#39;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>如果索引失效重建索引（测试的时候是没有失效的，索引为本地索引）</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">alter</span> <span class="token keyword">index</span> sys<span class="token punctuation">.</span>WRH$_ACTIVE_SESSION_HISTORY_PK rebuild parallel <span class="token number">8</span> nologging<span class="token punctuation">;</span>
<span class="token keyword">alter</span> <span class="token keyword">index</span> sys<span class="token punctuation">.</span>WRH$_ACTIVE_SESSION_HISTORY_PK noparallel<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>启动AWR</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">exec</span> dbms_workload_repository<span class="token punctuation">.</span>modify_snapshot_settings<span class="token punctuation">(</span><span class="token keyword">interval</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>测试awr和ash可能正常生成</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token comment">---手动生成snapshot</span>
<span class="token keyword">exec</span> dbms_workload_repository<span class="token punctuation">.</span>create_snapshot<span class="token punctuation">;</span>
@?<span class="token operator">/</span>rdbms<span class="token operator">/</span>admin<span class="token operator">/</span>awrrpt
@?<span class="token operator">/</span>rdbms<span class="token operator">/</span>admin<span class="token operator">/</span>ashrpt
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>删除备份表</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">drop</span> <span class="token keyword">table</span> abelit<span class="token punctuation">.</span>ash_20231025 <span class="token keyword">purge</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="通过内置包过程清理" tabindex="-1"><a class="header-anchor" href="#通过内置包过程清理"><span>通过内置包过程清理</span></a></h3><p>使用dbms_workload_repository.drop_snapshot_range可以删除历史数据.通过v$session看到执行的SQL是delete，这种做法无法降低高水位线。</p><ul><li>清理快照信息</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">exec</span> DBMS_WORKLOAD_REPOSITORY<span class="token punctuation">.</span>DROP_SNAPSHOT_RANGE<span class="token punctuation">(</span>low_snap_id <span class="token operator">=</span><span class="token operator">&gt;</span><span class="token number">17151</span><span class="token punctuation">,</span>high_snap_id <span class="token operator">=</span><span class="token operator">&gt;</span><span class="token number">17184</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li><a href="#%E9%99%8D%E4%BD%8Esysaux%E9%AB%98%E6%B0%B4%E4%BD%8D%E7%BA%BF">降低表空间水位线</a></li></ul><h3 id="通过delete清理" tabindex="-1"><a class="header-anchor" href="#通过delete清理"><span>通过delete清理</span></a></h3><ul><li>查询</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span>
    <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> orphaned_ash_rows
<span class="token keyword">FROM</span>
    wrh$_active_session_history a
<span class="token keyword">WHERE</span>
    <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> <span class="token punctuation">(</span>
        <span class="token keyword">SELECT</span>
            <span class="token number">1</span>
        <span class="token keyword">FROM</span>
            sys<span class="token punctuation">.</span>wrm$_snapshot
        <span class="token keyword">WHERE</span>
                snap_id <span class="token operator">=</span> a<span class="token punctuation">.</span>snap_id
            <span class="token operator">AND</span> dbid <span class="token operator">=</span> a<span class="token punctuation">.</span>dbid
            <span class="token operator">AND</span> instance_number <span class="token operator">=</span> a<span class="token punctuation">.</span>instance_number
    <span class="token punctuation">)</span>
        <span class="token operator">AND</span> snap_id <span class="token operator">&lt;=</span> <span class="token number">1000</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>清理</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">alter</span> <span class="token keyword">table</span> wrh$_active_session_history parallel <span class="token number">4</span><span class="token punctuation">;</span>
<span class="token keyword">alter</span> <span class="token keyword">session</span> <span class="token keyword">force</span> parallel dml<span class="token punctuation">;</span>

<span class="token keyword">DELETE</span> <span class="token comment">/*+ parallel(a,4) */</span> <span class="token keyword">FROM</span> wrh$_active_session_history a
<span class="token keyword">WHERE</span>
    <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> <span class="token punctuation">(</span>
        <span class="token keyword">SELECT</span>
            <span class="token number">1</span>
        <span class="token keyword">FROM</span>
            wrm$_snapshot
        <span class="token keyword">WHERE</span>
                snap_id <span class="token operator">=</span> a<span class="token punctuation">.</span>snap_id
            <span class="token operator">AND</span> dbid <span class="token operator">=</span> a<span class="token punctuation">.</span>dbid
            <span class="token operator">AND</span> instance_number <span class="token operator">=</span> a<span class="token punctuation">.</span>instance_number
    <span class="token punctuation">)</span>
        <span class="token operator">AND</span> snap_id <span class="token operator">&lt;=</span> <span class="token number">1000</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><a href="#%E9%99%8D%E4%BD%8Esysaux%E9%AB%98%E6%B0%B4%E4%BD%8D%E7%BA%BF">降低表空间水位线</a></li></ul><h3 id="降低sysaux高水位线" tabindex="-1"><a class="header-anchor" href="#降低sysaux高水位线"><span>降低SYSAUX高水位线</span></a></h3><p>因<code>WRH$_ACTIVE_SESSION_HISTORY</code>表使用了分区表，当移动改表时，需要移动改表的各个分区。</p><ul><li>查看<code>WRH$_ACTIVE_SESSION_HISTORY</code>的分区信息</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">select</span> segment_name<span class="token punctuation">,</span>partition_name<span class="token punctuation">,</span>bytes<span class="token operator">/</span><span class="token number">1024</span><span class="token operator">/</span><span class="token number">1024</span><span class="token operator">/</span><span class="token number">1024</span> sizegb <span class="token keyword">from</span> dba_segments <span class="token keyword">where</span> segment_name<span class="token operator">=</span><span class="token string">&#39;WRH$_ACTIVE_SESSION_HISTORY&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>移动表或表分区</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">alter</span> <span class="token keyword">table</span> WRH$_ACTIVE_SESSION_HISTORY move <span class="token keyword">partition</span> WRH$_ACTIVE_3925668609_0<span class="token punctuation">;</span>
<span class="token keyword">alter</span> <span class="token keyword">table</span> WRH$_ACTIVE_SESSION_HISTORY move <span class="token keyword">partition</span> WRH$_ACTIVE_SES_MXDB_MXSN<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>或使用：</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token string">&#39;alter table &#39;</span><span class="token operator">||</span>segment_name<span class="token operator">||</span><span class="token string">&#39;  move tablespace SYSAUX;&#39;</span> <span class="token keyword">from</span> dba_segments <span class="token keyword">where</span> tablespace_name <span class="token operator">=</span> <span class="token string">&#39;SYSAUX&#39;</span>
<span class="token operator">and</span> segment_name <span class="token operator">like</span> <span class="token string">&#39;WRH%&#39;</span> <span class="token operator">and</span> segment_type<span class="token operator">=</span><span class="token string">&#39;TABLE&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">alter</span> <span class="token keyword">table</span> WRH$_ACTIVE_SESSION_HISTORY move <span class="token keyword">tablespace</span> SYSAUX<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>查看表的索引信息</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span>
    owner<span class="token punctuation">,</span>
    index_name<span class="token punctuation">,</span>
    table_name<span class="token punctuation">,</span>
    last_analyzed
<span class="token keyword">FROM</span>
    dba_indexes
<span class="token keyword">WHERE</span>
    table_name <span class="token operator">=</span> <span class="token string">&#39;WRH$_ACTIVE_SESSION_HISTORY&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>查看索引的分区信息</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span>
    index_owner<span class="token punctuation">,</span>
    index_name<span class="token punctuation">,</span>
    partition_name<span class="token punctuation">,</span>
    <span class="token keyword">status</span><span class="token punctuation">,</span>
    tablespace_name<span class="token punctuation">,</span>
    last_analyzed
<span class="token keyword">FROM</span>
    dba_ind_partitions
<span class="token keyword">WHERE</span>
    index_name <span class="token operator">=</span> <span class="token string">&#39;WRH$_ACTIVE_SESSION_HISTORY_PK&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>重建分区索引</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">alter</span> <span class="token keyword">index</span> WRH$_ACTIVE_SESSION_HISTORY_PK rebuild <span class="token keyword">partition</span> WRH$_ACTIVE_3925668609_0<span class="token punctuation">;</span>
<span class="token keyword">alter</span> <span class="token keyword">index</span> WRH$_ACTIVE_SESSION_HISTORY_PK rebuild <span class="token keyword">partition</span> WRH$_ACTIVE_SES_MXDB_MXSN<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>或使用：</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token string">&#39;alter index &#39;</span><span class="token operator">||</span>segment_name<span class="token operator">||</span><span class="token string">&#39;  rebuild online parallel (degree 14);&#39;</span> <span class="token keyword">from</span> dba_segments <span class="token keyword">where</span> tablespace_name <span class="token operator">=</span> <span class="token string">&#39;SYSAUX&#39;</span>
<span class="token operator">and</span> segment_name <span class="token operator">like</span> <span class="token string">&#39;WRH%&#39;</span> <span class="token operator">and</span> segment_type<span class="token operator">=</span><span class="token string">&#39;INDEX&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">alter</span> <span class="token keyword">index</span> WRH$_ACTIVE_SESSION_HISTORY_PK rebuild online parallel <span class="token punctuation">(</span>degree <span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="清除logminer数据" tabindex="-1"><a class="header-anchor" href="#清除logminer数据"><span>清除logminer数据</span></a></h3><p>因为logminer数据占用的sysaux表空间，一般是由于执行了一些大的dml操作，导致产生了大量的日志。目前没有一个好的办法去直接收回这些空间，但是可以将这些数据迁移到别的表空间。</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">tablespace</span> LOGMNRTBS datafile <span class="token string">&#39;/path/logmgrtbs01.dbf&#39;</span> size <span class="token number">128</span>M autoextend <span class="token keyword">on</span> maxsize unlimited<span class="token punctuation">;</span>
<span class="token keyword">EXECUTE</span> DBMS_LOGMNR_D<span class="token punctuation">.</span>SET_TABLESPACE <span class="token punctuation">(</span><span class="token string">&#39;LOGMNRTBS&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="sysaux自动空间清理" tabindex="-1"><a class="header-anchor" href="#sysaux自动空间清理"><span>SYSAUX自动空间清理</span></a></h3><h4 id="修改统计信息的保持时间" tabindex="-1"><a class="header-anchor" href="#修改统计信息的保持时间"><span>修改统计信息的保持时间</span></a></h4><p>默认为31天，这里修改为7天，过期的统计信息会自动被删除</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">select</span> dbms_stats<span class="token punctuation">.</span>get_stats_history_retention <span class="token keyword">from</span> dual<span class="token punctuation">;</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">exec</span> dbms_stats<span class="token punctuation">.</span>alter_stats_history_retention<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="修改awr快照的保存时间" tabindex="-1"><a class="header-anchor" href="#修改awr快照的保存时间"><span>修改AWR快照的保存时间</span></a></h4><p>默认为7天(72460),每小时收集一次</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">begin</span> 
	dbms_workload_repository<span class="token punctuation">.</span>modify_snapshot_settings <span class="token punctuation">(</span> 
	<span class="token keyword">interval</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">60</span><span class="token punctuation">,</span> 
	retention <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">10080</span><span class="token punctuation">,</span> 
	topnsql <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">100</span> 
	<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">end</span><span class="token punctuation">;</span> 
<span class="token operator">/</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="删除awr快照" tabindex="-1"><a class="header-anchor" href="#删除awr快照"><span>删除AWR快照</span></a></h4><ul><li>查询最最小和最大快照ID</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token function">min</span><span class="token punctuation">(</span>snap_id<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">max</span><span class="token punctuation">(</span>snap_id<span class="token punctuation">)</span> <span class="token keyword">from</span> dba_hist_snapshot<span class="token punctuation">;</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>查看数据库的DBID</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">select</span> dbid <span class="token keyword">from</span> v$<span class="token keyword">database</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>通过最小、最大快照ID和DBID，删除AWR快照</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">begin</span> 
	dbms_workload_repository<span class="token punctuation">.</span>drop_snapshot_range<span class="token punctuation">(</span> 
	low_snap_id <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">9</span><span class="token punctuation">,</span> 
	high_snap_id <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">215</span><span class="token punctuation">,</span> 
	dbid <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">1732650929</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">end</span><span class="token punctuation">;</span>
<span class="token operator">/</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,101),p=[l];function o(i,c){return n(),a("div",null,p)}const u=s(t,[["render",o],["__file","clean.html.vue"]]),k=JSON.parse(`{"path":"/guide/database/oracle/tablespace/clean.html","title":"表空间清理","lang":"zh-CN","frontmatter":{"title":"表空间清理","description":"SYSTEM表空间清理 空间使用信息查询 查看 SYSTEM 表空间表中段的使用情况 查询system表空间审计表的大小段 释放空间 根据查询出来的审计表大小，分段释放空间 找出目前SYSTEM表空间最大的block_id 这里查询查询结果是： 153968 查看数据库快大小 这里查询查询结果是： 8192 (8k) 计算占用空间 这里查询查询结果是：...","head":[["meta",{"property":"og:url","content":"https://github.com/abelit/abelit-datapeacock.git/guide/database/oracle/tablespace/clean.html"}],["meta",{"property":"og:site_name","content":"数之雀"}],["meta",{"property":"og:title","content":"表空间清理"}],["meta",{"property":"og:description","content":"SYSTEM表空间清理 空间使用信息查询 查看 SYSTEM 表空间表中段的使用情况 查询system表空间审计表的大小段 释放空间 根据查询出来的审计表大小，分段释放空间 找出目前SYSTEM表空间最大的block_id 这里查询查询结果是： 153968 查看数据库快大小 这里查询查询结果是： 8192 (8k) 计算占用空间 这里查询查询结果是：..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-05-11T14:06:18.000Z"}],["meta",{"property":"article:author","content":"Abelit"}],["meta",{"property":"article:modified_time","content":"2024-05-11T14:06:18.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"表空间清理\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2024-05-11T14:06:18.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Abelit\\",\\"url\\":\\"https://github.com/abelit\\"}]}"]]},"headers":[{"level":2,"title":"SYSTEM表空间清理","slug":"system表空间清理","link":"#system表空间清理","children":[{"level":3,"title":"空间使用信息查询","slug":"空间使用信息查询","link":"#空间使用信息查询","children":[]}]},{"level":2,"title":"SYSAUX表空间清理","slug":"sysaux表空间清理","link":"#sysaux表空间清理","children":[{"level":3,"title":"空间使用信息查询","slug":"空间使用信息查询-1","link":"#空间使用信息查询-1","children":[]},{"level":3,"title":"通过truncate清理","slug":"通过truncate清理","link":"#通过truncate清理","children":[]},{"level":3,"title":"通过内置包过程清理","slug":"通过内置包过程清理","link":"#通过内置包过程清理","children":[]},{"level":3,"title":"通过delete清理","slug":"通过delete清理","link":"#通过delete清理","children":[]},{"level":3,"title":"降低SYSAUX高水位线","slug":"降低sysaux高水位线","link":"#降低sysaux高水位线","children":[]},{"level":3,"title":"清除logminer数据","slug":"清除logminer数据","link":"#清除logminer数据","children":[]},{"level":3,"title":"SYSAUX自动空间清理","slug":"sysaux自动空间清理","link":"#sysaux自动空间清理","children":[]}]}],"git":{"createdTime":1715436378000,"updatedTime":1715436378000,"contributors":[{"name":"ableit","email":"ychenid@live.com","commits":1}]},"readingTime":{"minutes":4.68,"words":1404},"filePathRelative":"guide/database/oracle/tablespace/clean.md","localizedDate":"2024年5月11日","autoDesc":true,"excerpt":"<h2>SYSTEM表空间清理</h2>\\n<h3>空间使用信息查询</h3>\\n<ul>\\n<li>查看 SYSTEM 表空间表中段的使用情况</li>\\n</ul>\\n<div class=\\"language-sql\\" data-ext=\\"sql\\" data-title=\\"sql\\"><pre class=\\"language-sql\\"><code><span class=\\"token keyword\\">SELECT</span>\\n    segment_name<span class=\\"token punctuation\\">,</span>\\n    bytes <span class=\\"token operator\\">/</span> <span class=\\"token number\\">1024</span> <span class=\\"token operator\\">/</span> <span class=\\"token number\\">1024</span> <span class=\\"token operator\\">/</span> <span class=\\"token number\\">1024</span> sizegb<span class=\\"token punctuation\\">,</span>\\n    segment_type\\n<span class=\\"token keyword\\">FROM</span>\\n    dba_segments\\n<span class=\\"token keyword\\">WHERE</span>\\n    tablespace_name <span class=\\"token operator\\">=</span> <span class=\\"token string\\">'SYSTEM'</span>\\n<span class=\\"token keyword\\">ORDER</span> <span class=\\"token keyword\\">BY</span>\\n    bytes <span class=\\"token keyword\\">DESC</span><span class=\\"token punctuation\\">;</span>\\n</code></pre></div>"}`);export{u as comp,k as data};
