import{_ as n}from"./plugin-vue_export-helper-DlAUqK2U.js";import{o as s,c as a,f as t}from"./app-DR5J2daJ.js";const p={},e=t(`<h2 id="awr查询" tabindex="-1"><a class="header-anchor" href="#awr查询"><span>AWR查询</span></a></h2><h3 id="会话统计" tabindex="-1"><a class="header-anchor" href="#会话统计"><span>会话统计</span></a></h3><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span>
    to_char<span class="token punctuation">(</span>
        snap<span class="token punctuation">.</span>end_interval_time<span class="token punctuation">,</span> <span class="token string">&#39;YYYY-MM-DD HH24:MI:SS&#39;</span>
    <span class="token punctuation">)</span>          snap_time<span class="token punctuation">,</span>
    stat<span class="token punctuation">.</span><span class="token keyword">value</span> session_count
<span class="token keyword">FROM</span>
    dba_hist_sysstat  stat<span class="token punctuation">,</span>
    dba_hist_snapshot snap
<span class="token keyword">WHERE</span>
    stat<span class="token punctuation">.</span>snap_id <span class="token operator">=</span> snap<span class="token punctuation">.</span>snap_id
    <span class="token operator">AND</span> stat<span class="token punctuation">.</span>dbid <span class="token operator">=</span> snap<span class="token punctuation">.</span>dbid
    <span class="token operator">AND</span> stat<span class="token punctuation">.</span>instance_number <span class="token operator">=</span> snap<span class="token punctuation">.</span>instance_number
    <span class="token operator">AND</span> stat<span class="token punctuation">.</span>stat_name <span class="token operator">=</span> <span class="token string">&#39;logons current&#39;</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span>
    to_char<span class="token punctuation">(</span>
        snap<span class="token punctuation">.</span>end_interval_time<span class="token punctuation">,</span> <span class="token string">&#39;YYYY-MM-DD HH24:MI:SS&#39;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="sql统计" tabindex="-1"><a class="header-anchor" href="#sql统计"><span>SQL统计</span></a></h3><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span>   <span class="token punctuation">(</span><span class="token keyword">SELECT</span> sql_id<span class="token punctuation">,</span>
               Substr<span class="token punctuation">(</span>a<span class="token punctuation">.</span>sql_text<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">)</span> sql_text<span class="token punctuation">,</span>
               parsing_schema_name<span class="token punctuation">,</span>
               Trunc<span class="token punctuation">(</span>a<span class="token punctuation">.</span>disk_reads<span class="token operator">/</span>Decode<span class="token punctuation">(</span>a<span class="token punctuation">.</span>executions<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>a<span class="token punctuation">.</span>executions<span class="token punctuation">)</span><span class="token punctuation">)</span> reads_per_execution<span class="token punctuation">,</span> 
               a<span class="token punctuation">.</span>buffer_gets<span class="token punctuation">,</span> 
               a<span class="token punctuation">.</span>disk_reads<span class="token punctuation">,</span> 
               a<span class="token punctuation">.</span>executions<span class="token punctuation">,</span> 
               a<span class="token punctuation">.</span>sorts<span class="token punctuation">,</span>
               a<span class="token punctuation">.</span>address
        <span class="token keyword">FROM</span>   v$sqlarea a
        <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> reads_per_execution <span class="token keyword">DESC</span><span class="token punctuation">)</span>
<span class="token keyword">WHERE</span>  rownum <span class="token operator">&lt;=</span> <span class="token operator">&amp;&amp;</span>row_num<span class="token punctuation">;</span>

<span class="token keyword">SELECT</span>
    sql_id<span class="token punctuation">,</span>
    plan_hash_value<span class="token punctuation">,</span>
    end_interval_time<span class="token punctuation">,</span>
    executions_delta<span class="token punctuation">,</span>
    elapsed_time_delta <span class="token operator">/</span> <span class="token punctuation">(</span> nonzeroexecutions <span class="token operator">*</span> <span class="token number">1000</span> <span class="token punctuation">)</span>                    <span class="token string">&quot;Elapsed Average ms&quot;</span><span class="token punctuation">,</span>
    cpu_time_delta <span class="token operator">/</span> <span class="token punctuation">(</span> nonzeroexecutions <span class="token operator">*</span> <span class="token number">1000</span> <span class="token punctuation">)</span>                        <span class="token string">&quot;CPU Average ms&quot;</span><span class="token punctuation">,</span>
    iowait_delta <span class="token operator">/</span> <span class="token punctuation">(</span> nonzeroexecutions <span class="token operator">*</span> <span class="token number">1000</span> <span class="token punctuation">)</span>                          <span class="token string">&quot;IO Average ms&quot;</span><span class="token punctuation">,</span>
    clwait_delta <span class="token operator">/</span> <span class="token punctuation">(</span> nonzeroexecutions <span class="token operator">*</span> <span class="token number">1000</span> <span class="token punctuation">)</span>                          <span class="token string">&quot;Cluster Average ms&quot;</span><span class="token punctuation">,</span>
    apwait_delta <span class="token operator">/</span> <span class="token punctuation">(</span> nonzeroexecutions <span class="token operator">*</span> <span class="token number">1000</span> <span class="token punctuation">)</span>                          <span class="token string">&quot;Application Average ms&quot;</span><span class="token punctuation">,</span>
    ccwait_delta <span class="token operator">/</span> <span class="token punctuation">(</span> nonzeroexecutions <span class="token operator">*</span> <span class="token number">1000</span> <span class="token punctuation">)</span>                          <span class="token string">&quot;Concurrency Average ms&quot;</span><span class="token punctuation">,</span>
    buffer_gets_delta <span class="token operator">/</span> nonzeroexecutions                                <span class="token string">&quot;Average buffer gets&quot;</span><span class="token punctuation">,</span>
    disk_reads_delta <span class="token operator">/</span> nonzeroexecutions                                 <span class="token string">&quot;Average disk reads&quot;</span><span class="token punctuation">,</span>
    trunc<span class="token punctuation">(</span>physical_write_bytes_delta <span class="token operator">/</span><span class="token punctuation">(</span><span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> nonzeroexecutions<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token string">&quot;Average disk write megabytes&quot;</span><span class="token punctuation">,</span>
    rows_processed_delta <span class="token operator">/</span> nonzeroexecutions                             <span class="token string">&quot;Average rows processed&quot;</span>
<span class="token keyword">FROM</span>
    <span class="token punctuation">(</span>
        <span class="token keyword">SELECT</span>
            ss<span class="token punctuation">.</span>snap_id<span class="token punctuation">,</span>
            ss<span class="token punctuation">.</span>sql_id<span class="token punctuation">,</span>
            ss<span class="token punctuation">.</span>plan_hash_value<span class="token punctuation">,</span>
            sn<span class="token punctuation">.</span>end_interval_time<span class="token punctuation">,</span>
            ss<span class="token punctuation">.</span>executions_delta<span class="token punctuation">,</span>
            <span class="token keyword">CASE</span> ss<span class="token punctuation">.</span>executions_delta
            <span class="token keyword">WHEN</span> <span class="token number">0</span> <span class="token keyword">THEN</span>
            <span class="token number">1</span>
            <span class="token keyword">ELSE</span>
            ss<span class="token punctuation">.</span>executions_delta
            <span class="token keyword">END</span> nonzeroexecutions<span class="token punctuation">,</span>
            elapsed_time_delta<span class="token punctuation">,</span>
            cpu_time_delta<span class="token punctuation">,</span>
            iowait_delta<span class="token punctuation">,</span>
            clwait_delta<span class="token punctuation">,</span>
            apwait_delta<span class="token punctuation">,</span>
            ccwait_delta<span class="token punctuation">,</span>
            buffer_gets_delta<span class="token punctuation">,</span>
            disk_reads_delta<span class="token punctuation">,</span>
            physical_write_bytes_delta<span class="token punctuation">,</span>
            rows_processed_delta
        <span class="token keyword">FROM</span>
            dba_hist_sqlstat  ss<span class="token punctuation">,</span>
            dba_hist_snapshot sn
        <span class="token keyword">WHERE</span>
            ss<span class="token punctuation">.</span>sql_id <span class="token operator">=</span> <span class="token string">&#39;&amp;sql_id&#39;</span>
            <span class="token operator">AND</span> ss<span class="token punctuation">.</span>snap_id <span class="token operator">=</span> sn<span class="token punctuation">.</span>snap_id
            <span class="token operator">AND</span> ss<span class="token punctuation">.</span>instance_number <span class="token operator">=</span> sn<span class="token punctuation">.</span>instance_number
    <span class="token punctuation">)</span>
<span class="token keyword">WHERE</span>
    elapsed_time_delta <span class="token operator">&gt;</span> <span class="token number">0</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span>
    snap_id<span class="token punctuation">,</span>
    sql_id<span class="token punctuation">;</span>


<span class="token keyword">SELECT</span>
    to_char<span class="token punctuation">(</span>
        sn<span class="token punctuation">.</span>end_interval_time<span class="token punctuation">,</span> <span class="token string">&#39;YYYY-MM-DD HH24:MI&#39;</span>
    <span class="token punctuation">)</span>                                                                  <span class="token string">&quot;Interval Minute&quot;</span><span class="token punctuation">,</span>
    ss<span class="token punctuation">.</span>sql_id<span class="token punctuation">,</span>
    ss<span class="token punctuation">.</span>plan_hash_value<span class="token punctuation">,</span>
    <span class="token function">SUM</span><span class="token punctuation">(</span>ss<span class="token punctuation">.</span>executions_delta<span class="token punctuation">)</span>                                           <span class="token string">&quot;Executions&quot;</span><span class="token punctuation">,</span>
    <span class="token function">SUM</span><span class="token punctuation">(</span>elapsed_time_delta<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span> <span class="token function">SUM</span><span class="token punctuation">(</span>executions_delta<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1000</span> <span class="token punctuation">)</span> <span class="token string">&quot;Elapsed Average ms&quot;</span><span class="token punctuation">,</span>
    <span class="token function">SUM</span><span class="token punctuation">(</span>cpu_time_delta<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span> <span class="token function">SUM</span><span class="token punctuation">(</span>executions_delta<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1000</span> <span class="token punctuation">)</span>     <span class="token string">&quot;CPU Average ms&quot;</span><span class="token punctuation">,</span>
    <span class="token function">SUM</span><span class="token punctuation">(</span>iowait_delta<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span> <span class="token function">SUM</span><span class="token punctuation">(</span>executions_delta<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1000</span> <span class="token punctuation">)</span>       <span class="token string">&quot;IO Average ms&quot;</span><span class="token punctuation">,</span>
    <span class="token function">SUM</span><span class="token punctuation">(</span>clwait_delta<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span> <span class="token function">SUM</span><span class="token punctuation">(</span>executions_delta<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1000</span> <span class="token punctuation">)</span>       <span class="token string">&quot;Cluster Average ms&quot;</span><span class="token punctuation">,</span>
    <span class="token function">SUM</span><span class="token punctuation">(</span>apwait_delta<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span> <span class="token function">SUM</span><span class="token punctuation">(</span>executions_delta<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1000</span> <span class="token punctuation">)</span>       <span class="token string">&quot;Application Average ms&quot;</span><span class="token punctuation">,</span>
    <span class="token function">SUM</span><span class="token punctuation">(</span>ccwait_delta<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span> <span class="token function">SUM</span><span class="token punctuation">(</span>executions_delta<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1000</span> <span class="token punctuation">)</span>       <span class="token string">&quot;Concurrency Average ms&quot;</span><span class="token punctuation">,</span>
    <span class="token function">SUM</span><span class="token punctuation">(</span>buffer_gets_delta<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span> <span class="token function">SUM</span><span class="token punctuation">(</span>executions_delta<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">)</span>             <span class="token string">&quot;Average buffer gets&quot;</span><span class="token punctuation">,</span>
    <span class="token function">SUM</span><span class="token punctuation">(</span>disk_reads_delta<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span> <span class="token function">SUM</span><span class="token punctuation">(</span>executions_delta<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">)</span>              <span class="token string">&quot;Average disk reads&quot;</span><span class="token punctuation">,</span>
    <span class="token function">SUM</span><span class="token punctuation">(</span>rows_processed_delta<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span> <span class="token function">SUM</span><span class="token punctuation">(</span>executions_delta<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">)</span>          <span class="token string">&quot;Average rows processed&quot;</span>
<span class="token keyword">FROM</span>
    dba_hist_sqlstat  ss<span class="token punctuation">,</span>
    dba_hist_snapshot sn
<span class="token keyword">WHERE</span>
    ss<span class="token punctuation">.</span>sql_id <span class="token operator">=</span> <span class="token string">&#39;&amp;sql_id&#39;</span>
    <span class="token operator">AND</span> ss<span class="token punctuation">.</span>snap_id <span class="token operator">=</span> sn<span class="token punctuation">.</span>snap_id
    <span class="token operator">AND</span> ss<span class="token punctuation">.</span>instance_number <span class="token operator">=</span> sn<span class="token punctuation">.</span>instance_number
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span>
    to_char<span class="token punctuation">(</span>
        sn<span class="token punctuation">.</span>end_interval_time<span class="token punctuation">,</span> <span class="token string">&#39;YYYY-MM-DD HH24:MI&#39;</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
    ss<span class="token punctuation">.</span>sql_id<span class="token punctuation">,</span>
    ss<span class="token punctuation">.</span>plan_hash_value
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span>
    to_char<span class="token punctuation">(</span>
        sn<span class="token punctuation">.</span>end_interval_time<span class="token punctuation">,</span> <span class="token string">&#39;YYYY-MM-DD HH24:MI&#39;</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
    ss<span class="token punctuation">.</span>sql_id<span class="token punctuation">,</span>
    ss<span class="token punctuation">.</span>plan_hash_value<span class="token punctuation">;</span>

<span class="token keyword">SELECT</span>
    to_char<span class="token punctuation">(</span>
        sn<span class="token punctuation">.</span>end_interval_time<span class="token punctuation">,</span> <span class="token string">&#39;YYYY-MM-DD&#39;</span>
    <span class="token punctuation">)</span>                                                                  <span class="token string">&quot;Day&quot;</span><span class="token punctuation">,</span>
    ss<span class="token punctuation">.</span>sql_id<span class="token punctuation">,</span>
    ss<span class="token punctuation">.</span>plan_hash_value<span class="token punctuation">,</span>
    <span class="token function">SUM</span><span class="token punctuation">(</span>ss<span class="token punctuation">.</span>executions_delta<span class="token punctuation">)</span>                                           <span class="token string">&quot;Executions&quot;</span><span class="token punctuation">,</span>
    <span class="token function">SUM</span><span class="token punctuation">(</span>elapsed_time_delta<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span> <span class="token function">SUM</span><span class="token punctuation">(</span>executions_delta<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1000</span> <span class="token punctuation">)</span> <span class="token string">&quot;Elapsed Average ms&quot;</span><span class="token punctuation">,</span>
    <span class="token function">SUM</span><span class="token punctuation">(</span>cpu_time_delta<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span> <span class="token function">SUM</span><span class="token punctuation">(</span>executions_delta<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1000</span> <span class="token punctuation">)</span>     <span class="token string">&quot;CPU Average ms&quot;</span><span class="token punctuation">,</span>
    <span class="token function">SUM</span><span class="token punctuation">(</span>iowait_delta<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span> <span class="token function">SUM</span><span class="token punctuation">(</span>executions_delta<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1000</span> <span class="token punctuation">)</span>       <span class="token string">&quot;IO Average ms&quot;</span><span class="token punctuation">,</span>
    <span class="token function">SUM</span><span class="token punctuation">(</span>clwait_delta<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span> <span class="token function">SUM</span><span class="token punctuation">(</span>executions_delta<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1000</span> <span class="token punctuation">)</span>       <span class="token string">&quot;Cluster Average ms&quot;</span><span class="token punctuation">,</span>
    <span class="token function">SUM</span><span class="token punctuation">(</span>apwait_delta<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span> <span class="token function">SUM</span><span class="token punctuation">(</span>executions_delta<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1000</span> <span class="token punctuation">)</span>       <span class="token string">&quot;Application Average ms&quot;</span><span class="token punctuation">,</span>
    <span class="token function">SUM</span><span class="token punctuation">(</span>ccwait_delta<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span> <span class="token function">SUM</span><span class="token punctuation">(</span>executions_delta<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1000</span> <span class="token punctuation">)</span>       <span class="token string">&quot;Concurrency Average ms&quot;</span><span class="token punctuation">,</span>
    <span class="token function">SUM</span><span class="token punctuation">(</span>buffer_gets_delta<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span> <span class="token function">SUM</span><span class="token punctuation">(</span>executions_delta<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">)</span>             <span class="token string">&quot;Average buffer gets&quot;</span><span class="token punctuation">,</span>
    <span class="token function">SUM</span><span class="token punctuation">(</span>disk_reads_delta<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span> <span class="token function">SUM</span><span class="token punctuation">(</span>executions_delta<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">)</span>              <span class="token string">&quot;Average disk reads&quot;</span><span class="token punctuation">,</span>
    <span class="token function">SUM</span><span class="token punctuation">(</span>rows_processed_delta<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span> <span class="token function">SUM</span><span class="token punctuation">(</span>executions_delta<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">)</span>          <span class="token string">&quot;Average rows processed&quot;</span>
<span class="token keyword">FROM</span>
    dba_hist_sqlstat  ss<span class="token punctuation">,</span>
    dba_hist_snapshot sn
<span class="token keyword">WHERE</span>
    ss<span class="token punctuation">.</span>sql_id <span class="token operator">=</span> <span class="token string">&#39;&amp;sql_id&#39;</span>
    <span class="token operator">AND</span> ss<span class="token punctuation">.</span>snap_id <span class="token operator">=</span> sn<span class="token punctuation">.</span>snap_id
    <span class="token operator">AND</span> ss<span class="token punctuation">.</span>instance_number <span class="token operator">=</span> sn<span class="token punctuation">.</span>instance_number
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span>
    to_char<span class="token punctuation">(</span>
        sn<span class="token punctuation">.</span>end_interval_time<span class="token punctuation">,</span> <span class="token string">&#39;YYYY-MM-DD&#39;</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
    ss<span class="token punctuation">.</span>sql_id<span class="token punctuation">,</span>
    ss<span class="token punctuation">.</span>plan_hash_value
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span>
    to_char<span class="token punctuation">(</span>
        sn<span class="token punctuation">.</span>end_interval_time<span class="token punctuation">,</span> <span class="token string">&#39;YYYY-MM-DD&#39;</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
    ss<span class="token punctuation">.</span>sql_id<span class="token punctuation">,</span>
    ss<span class="token punctuation">.</span>plan_hash_value<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="段统计" tabindex="-1"><a class="header-anchor" href="#段统计"><span>段统计</span></a></h2><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span>
    so<span class="token punctuation">.</span>owner<span class="token punctuation">,</span>
    so<span class="token punctuation">.</span>object_name<span class="token punctuation">,</span>
    so<span class="token punctuation">.</span>object_type<span class="token punctuation">,</span>
    sn<span class="token punctuation">.</span>end_interval_time<span class="token punctuation">,</span>
    ss<span class="token punctuation">.</span>logical_reads_delta<span class="token punctuation">,</span>
    ss<span class="token punctuation">.</span>buffer_busy_waits_delta<span class="token punctuation">,</span>
    ss<span class="token punctuation">.</span>db_block_changes_delta<span class="token punctuation">,</span>
    ss<span class="token punctuation">.</span>physical_reads_delta<span class="token punctuation">,</span>
    ss<span class="token punctuation">.</span>physical_writes_delta<span class="token punctuation">,</span>
    ss<span class="token punctuation">.</span>physical_reads_direct_delta<span class="token punctuation">,</span>
    ss<span class="token punctuation">.</span>physical_writes_direct_delta<span class="token punctuation">,</span>
    ss<span class="token punctuation">.</span>itl_waits_delta<span class="token punctuation">,</span>
    ss<span class="token punctuation">.</span>row_lock_waits_delta<span class="token punctuation">,</span>
    ss<span class="token punctuation">.</span>gc_cr_blocks_served_delta<span class="token punctuation">,</span>
    ss<span class="token punctuation">.</span>gc_cu_blocks_served_delta<span class="token punctuation">,</span>
    ss<span class="token punctuation">.</span>gc_buffer_busy_delta<span class="token punctuation">,</span>
    ss<span class="token punctuation">.</span>gc_cr_blocks_received_delta<span class="token punctuation">,</span>
    ss<span class="token punctuation">.</span>gc_cu_blocks_received_delta<span class="token punctuation">,</span>
    ss<span class="token punctuation">.</span>space_used_delta<span class="token punctuation">,</span>
    ss<span class="token punctuation">.</span>space_allocated_delta<span class="token punctuation">,</span>
    ss<span class="token punctuation">.</span>table_scans_delta<span class="token punctuation">,</span>
    ss<span class="token punctuation">.</span>chain_row_excess_delta<span class="token punctuation">,</span>
    ss<span class="token punctuation">.</span>physical_read_requests_delta<span class="token punctuation">,</span>
    ss<span class="token punctuation">.</span>physical_write_requests_delta<span class="token punctuation">,</span>
    ss<span class="token punctuation">.</span>optimized_physical_reads_delta
<span class="token keyword">FROM</span>
    dba_hist_seg_stat     ss<span class="token punctuation">,</span>
    dba_hist_snapshot     sn<span class="token punctuation">,</span>
    dba_hist_seg_stat_obj so
<span class="token keyword">WHERE</span>
    so<span class="token punctuation">.</span>owner <span class="token operator">=</span> <span class="token string">&#39;&amp;ower&#39;</span>
    <span class="token operator">AND</span> so<span class="token punctuation">.</span>object_name <span class="token operator">=</span> <span class="token string">&#39;&amp;object_name&#39;</span>
    <span class="token operator">AND</span> so<span class="token punctuation">.</span>subobject_name <span class="token operator">IS</span> <span class="token boolean">NULL</span>
<span class="token comment">--    AND so.object_type = &#39;TABLE&#39;</span>
    <span class="token operator">AND</span> so<span class="token punctuation">.</span>dbid <span class="token operator">=</span> ss<span class="token punctuation">.</span>dbid
    <span class="token operator">AND</span> so<span class="token punctuation">.</span>ts<span class="token comment"># = ss.ts#</span>
    <span class="token operator">AND</span> so<span class="token punctuation">.</span>obj<span class="token comment"># = ss.obj#</span>
    <span class="token operator">AND</span> so<span class="token punctuation">.</span>dataobj<span class="token comment"># = ss.dataobj#</span>
    <span class="token operator">AND</span> ss<span class="token punctuation">.</span>snap_id <span class="token operator">=</span> sn<span class="token punctuation">.</span>snap_id
    <span class="token operator">AND</span> ss<span class="token punctuation">.</span>instance_number <span class="token operator">=</span> sn<span class="token punctuation">.</span>instance_number
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span>
    ss<span class="token punctuation">.</span>snap_id<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="空间统计" tabindex="-1"><a class="header-anchor" href="#空间统计"><span>空间统计</span></a></h2><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span>
    snap<span class="token punctuation">.</span>end_interval_time<span class="token punctuation">,</span>
    <span class="token function">SUM</span><span class="token punctuation">(</span>tsu<span class="token punctuation">.</span>tablespace_size <span class="token operator">*</span> dt<span class="token punctuation">.</span>block_size<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token punctuation">)</span>     total_gigabytes<span class="token punctuation">,</span>
    <span class="token function">SUM</span><span class="token punctuation">(</span>tsu<span class="token punctuation">.</span>tablespace_usedsize <span class="token operator">*</span> dt<span class="token punctuation">.</span>block_size<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token punctuation">)</span> used_gigabytes
<span class="token keyword">FROM</span>
    dba_hist_tbspc_space_usage tsu<span class="token punctuation">,</span>
    dba_hist_snapshot          snap<span class="token punctuation">,</span>
    v$<span class="token keyword">tablespace</span>               vt<span class="token punctuation">,</span>
    dba_tablespaces            dt
<span class="token keyword">WHERE</span>
    tsu<span class="token punctuation">.</span>snap_id <span class="token operator">=</span> snap<span class="token punctuation">.</span>snap_id
    <span class="token operator">AND</span> tsu<span class="token punctuation">.</span>dbid <span class="token operator">=</span> snap<span class="token punctuation">.</span>dbid
    <span class="token operator">AND</span> snap<span class="token punctuation">.</span>instance_number <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token operator">AND</span> tsu<span class="token punctuation">.</span>tablespace_id <span class="token operator">=</span> vt<span class="token punctuation">.</span>ts<span class="token comment">#</span>
    <span class="token operator">AND</span> vt<span class="token punctuation">.</span>name <span class="token operator">=</span> dt<span class="token punctuation">.</span>tablespace_name
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span>
    snap<span class="token punctuation">.</span>end_interval_time
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span>
    snap<span class="token punctuation">.</span>end_interval_time<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="系统负载" tabindex="-1"><a class="header-anchor" href="#系统负载"><span>系统负载</span></a></h2><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">WITH</span> t <span class="token keyword">AS</span> <span class="token punctuation">(</span>
    <span class="token keyword">SELECT</span>
        busy_v<span class="token punctuation">.</span>snap_id<span class="token punctuation">,</span>
        busy_v<span class="token punctuation">.</span><span class="token keyword">value</span> busy_time<span class="token punctuation">,</span>
        idle_v<span class="token punctuation">.</span><span class="token keyword">value</span> idle_time<span class="token punctuation">,</span>
        load_v<span class="token punctuation">.</span><span class="token keyword">value</span> <span class="token keyword">load</span>
    <span class="token keyword">FROM</span>
        dba_hist_osstat busy_v<span class="token punctuation">,</span>
        dba_hist_osstat idle_v<span class="token punctuation">,</span>
        dba_hist_osstat load_v
    <span class="token keyword">WHERE</span>
        busy_v<span class="token punctuation">.</span>snap_id <span class="token operator">=</span> idle_v<span class="token punctuation">.</span>snap_id
        <span class="token operator">AND</span> busy_v<span class="token punctuation">.</span>dbid <span class="token operator">=</span> idle_v<span class="token punctuation">.</span>dbid
        <span class="token operator">AND</span> busy_v<span class="token punctuation">.</span>instance_number <span class="token operator">=</span> idle_v<span class="token punctuation">.</span>instance_number
        <span class="token operator">AND</span> load_v<span class="token punctuation">.</span>snap_id <span class="token operator">=</span> idle_v<span class="token punctuation">.</span>snap_id
        <span class="token operator">AND</span> load_v<span class="token punctuation">.</span>dbid <span class="token operator">=</span> idle_v<span class="token punctuation">.</span>dbid
        <span class="token operator">AND</span> load_v<span class="token punctuation">.</span>instance_number <span class="token operator">=</span> idle_v<span class="token punctuation">.</span>instance_number
        <span class="token operator">AND</span> busy_v<span class="token punctuation">.</span>stat_name <span class="token operator">=</span> <span class="token string">&#39;BUSY_TIME&#39;</span>
        <span class="token operator">AND</span> idle_v<span class="token punctuation">.</span>stat_name <span class="token operator">=</span> <span class="token string">&#39;IDLE_TIME&#39;</span>
        <span class="token operator">AND</span> load_v<span class="token punctuation">.</span>stat_name <span class="token operator">=</span> <span class="token string">&#39;LOAD&#39;</span>
<span class="token punctuation">)</span>
<span class="token keyword">SELECT</span>
    to_char<span class="token punctuation">(</span>
        tb2<span class="token punctuation">.</span>end_interval_time<span class="token punctuation">,</span> <span class="token string">&#39;YYYY-MM-DD HH24:MI:SS&#39;</span>
    <span class="token punctuation">)</span>                                                           <span class="token string">&quot;End snapshot time&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span> <span class="token number">100</span> <span class="token operator">*</span> tb1<span class="token punctuation">.</span>busy_time <span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span> tb1<span class="token punctuation">.</span>busy_time <span class="token operator">+</span> tb1<span class="token punctuation">.</span>idle_time <span class="token punctuation">)</span> host_cpu_percent_used<span class="token punctuation">,</span>
    tb1<span class="token punctuation">.</span><span class="token keyword">load</span>                                                    host_cpu_load
<span class="token keyword">FROM</span>
    <span class="token punctuation">(</span>
        <span class="token keyword">SELECT</span>
            t2<span class="token punctuation">.</span>snap_id<span class="token punctuation">,</span>
            <span class="token punctuation">(</span> t2<span class="token punctuation">.</span>busy_time <span class="token operator">-</span> t1<span class="token punctuation">.</span>busy_time <span class="token punctuation">)</span> busy_time<span class="token punctuation">,</span>
            <span class="token punctuation">(</span> t2<span class="token punctuation">.</span>idle_time <span class="token operator">-</span> t1<span class="token punctuation">.</span>idle_time <span class="token punctuation">)</span> idle_time<span class="token punctuation">,</span>
            t2<span class="token punctuation">.</span><span class="token keyword">load</span>
        <span class="token keyword">FROM</span>
            t t1<span class="token punctuation">,</span>
            t t2
        <span class="token keyword">WHERE</span>
            t1<span class="token punctuation">.</span>snap_id <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">=</span> t2<span class="token punctuation">.</span>snap_id
    <span class="token punctuation">)</span>                 tb1<span class="token punctuation">,</span>
    dba_hist_snapshot tb2
<span class="token keyword">WHERE</span>
    tb1<span class="token punctuation">.</span>snap_id <span class="token operator">=</span> tb2<span class="token punctuation">.</span>snap_id
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span>
    tb1<span class="token punctuation">.</span>snap_id<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="等待事件" tabindex="-1"><a class="header-anchor" href="#等待事件"><span>等待事件</span></a></h2><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span>
    sn<span class="token punctuation">.</span>end_interval_time<span class="token punctuation">,</span>
    <span class="token punctuation">(</span> <span class="token keyword">after</span><span class="token punctuation">.</span>total_waits <span class="token operator">-</span> before<span class="token punctuation">.</span>total_waits <span class="token punctuation">)</span>                                                          <span class="token string">&quot;number of waits&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span> <span class="token keyword">after</span><span class="token punctuation">.</span>time_waited_micro <span class="token operator">-</span> before<span class="token punctuation">.</span>time_waited_micro <span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span> <span class="token keyword">after</span><span class="token punctuation">.</span>total_waits <span class="token operator">-</span> before<span class="token punctuation">.</span>total_waits <span class="token punctuation">)</span> <span class="token string">&quot;ave microseconds&quot;</span><span class="token punctuation">,</span>
    before<span class="token punctuation">.</span>event_name                                                                                   <span class="token string">&quot;wait name&quot;</span>
<span class="token keyword">FROM</span>
    dba_hist_system_event before<span class="token punctuation">,</span>
    dba_hist_system_event <span class="token keyword">after</span><span class="token punctuation">,</span>
    dba_hist_snapshot     sn
<span class="token keyword">WHERE</span>
<span class="token comment">--    before.event_name = &#39;&amp;&amp;WAITNAME&#39;</span>
    <span class="token keyword">after</span><span class="token punctuation">.</span>event_name <span class="token operator">=</span> before<span class="token punctuation">.</span>event_name
    <span class="token operator">AND</span> <span class="token keyword">after</span><span class="token punctuation">.</span>snap_id <span class="token operator">=</span> before<span class="token punctuation">.</span>snap_id <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token operator">AND</span> <span class="token keyword">after</span><span class="token punctuation">.</span>instance_number <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token operator">AND</span> before<span class="token punctuation">.</span>instance_number <span class="token operator">=</span> <span class="token keyword">after</span><span class="token punctuation">.</span>instance_number
    <span class="token operator">AND</span> <span class="token keyword">after</span><span class="token punctuation">.</span>snap_id <span class="token operator">=</span> sn<span class="token punctuation">.</span>snap_id
    <span class="token operator">AND</span> <span class="token keyword">after</span><span class="token punctuation">.</span>instance_number <span class="token operator">=</span> sn<span class="token punctuation">.</span>instance_number
    <span class="token operator">AND</span> <span class="token punctuation">(</span> <span class="token keyword">after</span><span class="token punctuation">.</span>total_waits <span class="token operator">-</span> before<span class="token punctuation">.</span>total_waits <span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token operator">&amp;&amp;</span>minimumwaits
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span>
    <span class="token keyword">after</span><span class="token punctuation">.</span>snap_id<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="系统统计信息" tabindex="-1"><a class="header-anchor" href="#系统统计信息"><span>系统统计信息</span></a></h2><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span>
    to_char<span class="token punctuation">(</span>
        sn<span class="token punctuation">.</span>end_interval_time<span class="token punctuation">,</span> <span class="token string">&#39;YYYY-MM-DD HH24:MI:SS&#39;</span>
    <span class="token punctuation">)</span>                          <span class="token string">&quot;End snapshot time&quot;</span><span class="token punctuation">,</span>
    before<span class="token punctuation">.</span>stat_name<span class="token punctuation">,</span>
    <span class="token keyword">after</span><span class="token punctuation">.</span><span class="token keyword">value</span><span class="token punctuation">,</span>
    before<span class="token punctuation">.</span><span class="token keyword">value</span>               value_difference<span class="token punctuation">,</span>
    <span class="token keyword">after</span><span class="token punctuation">.</span><span class="token keyword">value</span> <span class="token operator">-</span> before<span class="token punctuation">.</span><span class="token keyword">value</span> value_difference
<span class="token keyword">FROM</span>
    dba_hist_sysstat  before<span class="token punctuation">,</span>
    dba_hist_sysstat  <span class="token keyword">after</span><span class="token punctuation">,</span>
    dba_hist_snapshot sn
<span class="token keyword">WHERE</span>
<span class="token comment">--    before.stat_name = &#39;bytes received via SQL*Net from client&#39;</span>
    before<span class="token punctuation">.</span>stat_name <span class="token operator">=</span> <span class="token keyword">after</span><span class="token punctuation">.</span>stat_name
    <span class="token operator">AND</span> before<span class="token punctuation">.</span>instance_number <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token operator">AND</span> before<span class="token punctuation">.</span>instance_number <span class="token operator">=</span> sn<span class="token punctuation">.</span>instance_number
    <span class="token operator">AND</span> before<span class="token punctuation">.</span>instance_number <span class="token operator">=</span> <span class="token keyword">after</span><span class="token punctuation">.</span>instance_number
    <span class="token operator">AND</span> before<span class="token punctuation">.</span>snap_id <span class="token operator">=</span> sn<span class="token punctuation">.</span>snap_id
    <span class="token operator">AND</span> before<span class="token punctuation">.</span>snap_id <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">=</span> <span class="token keyword">after</span><span class="token punctuation">.</span>snap_id
    <span class="token operator">AND</span> before<span class="token punctuation">.</span>dbid <span class="token operator">=</span> sn<span class="token punctuation">.</span>dbid
    <span class="token operator">AND</span> before<span class="token punctuation">.</span>dbid <span class="token operator">=</span> <span class="token keyword">after</span><span class="token punctuation">.</span>dbid
    <span class="token operator">AND</span> <span class="token keyword">after</span><span class="token punctuation">.</span><span class="token keyword">value</span> <span class="token operator">&gt;=</span> before<span class="token punctuation">.</span><span class="token keyword">value</span>
    <span class="token operator">AND</span> sn<span class="token punctuation">.</span>end_interval_time <span class="token operator">&gt;=</span> TO_DATE<span class="token punctuation">(</span><span class="token string">&#39;&amp;start_time&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;YYYY-MM-DD HH24:MI:SS&#39;</span><span class="token punctuation">)</span>
    <span class="token operator">AND</span> sn<span class="token punctuation">.</span>end_interval_time <span class="token operator">&lt;=</span> TO_DATE<span class="token punctuation">(</span><span class="token string">&#39;&amp;end_time&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;YYYY-MM-DD HH24:MI:SS&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span>
    before<span class="token punctuation">.</span>stat_name<span class="token punctuation">,</span>
    sn<span class="token punctuation">.</span>snap_id<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="io" tabindex="-1"><a class="header-anchor" href="#io"><span>IO</span></a></h2><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span>
    to_char<span class="token punctuation">(</span>
        sn<span class="token punctuation">.</span>end_interval_time<span class="token punctuation">,</span> <span class="token string">&#39;YYYY-MM-DD HH24:MI:SS&#39;</span>
    <span class="token punctuation">)</span>                                                                                                                 <span class="token string">&quot;End snapshot time&quot;</span>
    <span class="token punctuation">,</span>
    <span class="token function">SUM</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">after</span><span class="token punctuation">.</span>phyblkrd <span class="token operator">-</span> before<span class="token punctuation">.</span>phyblkrd<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token keyword">after</span><span class="token punctuation">.</span>block_size<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token punctuation">)</span>                                      megabytes_read<span class="token punctuation">,</span>
    <span class="token function">SUM</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">after</span><span class="token punctuation">.</span>phyblkwrt <span class="token operator">-</span> before<span class="token punctuation">.</span>phyblkwrt<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token keyword">after</span><span class="token punctuation">.</span>block_size<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token punctuation">)</span>                                    megabytes_written
    <span class="token punctuation">,</span>
    <span class="token function">SUM</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">after</span><span class="token punctuation">.</span>phyblkrd <span class="token operator">-</span> before<span class="token punctuation">.</span>phyblkrd <span class="token operator">+</span> <span class="token keyword">after</span><span class="token punctuation">.</span>phyblkwrt <span class="token operator">-</span> before<span class="token punctuation">.</span>phyblkwrt<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token keyword">after</span><span class="token punctuation">.</span>block_size<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token punctuation">)</span> total_megabytes
    <span class="token punctuation">,</span>
    trunc<span class="token punctuation">(</span><span class="token number">10000</span> <span class="token operator">*</span> <span class="token function">SUM</span><span class="token punctuation">(</span><span class="token keyword">after</span><span class="token punctuation">.</span>readtim <span class="token operator">-</span> before<span class="token punctuation">.</span>readtim<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token function">SUM</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token keyword">after</span><span class="token punctuation">.</span>phyrds <span class="token operator">+</span> <span class="token operator">-</span> before<span class="token punctuation">.</span>phyrds<span class="token punctuation">)</span><span class="token punctuation">)</span>                      <span class="token string">&quot;ave read time (mu)&quot;</span>
    <span class="token punctuation">,</span>
    trunc<span class="token punctuation">(</span><span class="token number">10000</span> <span class="token operator">*</span> <span class="token function">SUM</span><span class="token punctuation">(</span><span class="token keyword">after</span><span class="token punctuation">.</span>writetim <span class="token operator">-</span> before<span class="token punctuation">.</span>writetim<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token function">SUM</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token keyword">after</span><span class="token punctuation">.</span>phywrts <span class="token operator">+</span> <span class="token operator">-</span> before<span class="token punctuation">.</span>phywrts<span class="token punctuation">)</span><span class="token punctuation">)</span>                  <span class="token string">&quot;ave write time (mu)&quot;</span>
<span class="token keyword">FROM</span>
    dba_hist_filestatxs before<span class="token punctuation">,</span>
    dba_hist_filestatxs <span class="token keyword">after</span><span class="token punctuation">,</span>
    dba_hist_snapshot   sn
<span class="token keyword">WHERE</span>
    <span class="token keyword">after</span><span class="token punctuation">.</span><span class="token keyword">file</span><span class="token comment"># = before.file#</span>
    <span class="token operator">AND</span> <span class="token keyword">after</span><span class="token punctuation">.</span>snap_id <span class="token operator">=</span> before<span class="token punctuation">.</span>snap_id <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token operator">AND</span> before<span class="token punctuation">.</span>instance_number <span class="token operator">=</span> <span class="token keyword">after</span><span class="token punctuation">.</span>instance_number
    <span class="token operator">AND</span> <span class="token keyword">after</span><span class="token punctuation">.</span>snap_id <span class="token operator">=</span> sn<span class="token punctuation">.</span>snap_id
    <span class="token operator">AND</span> <span class="token keyword">after</span><span class="token punctuation">.</span>instance_number <span class="token operator">=</span> sn<span class="token punctuation">.</span>instance_number
    <span class="token operator">AND</span> <span class="token keyword">after</span><span class="token punctuation">.</span>phyblkrd <span class="token operator">&gt;=</span> before<span class="token punctuation">.</span>phyblkrd
    <span class="token operator">AND</span> <span class="token keyword">after</span><span class="token punctuation">.</span>phyblkwrt <span class="token operator">&gt;=</span> before<span class="token punctuation">.</span>phyblkwrt
    <span class="token operator">AND</span> <span class="token keyword">after</span><span class="token punctuation">.</span>readtim <span class="token operator">&gt;=</span> before<span class="token punctuation">.</span>readtim
    <span class="token operator">AND</span> <span class="token keyword">after</span><span class="token punctuation">.</span>writetim <span class="token operator">&gt;=</span> before<span class="token punctuation">.</span>writetim
    <span class="token operator">AND</span> <span class="token keyword">after</span><span class="token punctuation">.</span>phyrds <span class="token operator">&gt;=</span> before<span class="token punctuation">.</span>phyrds
    <span class="token operator">AND</span> <span class="token keyword">after</span><span class="token punctuation">.</span>phywrts <span class="token operator">&gt;=</span> before<span class="token punctuation">.</span>phywrts
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span>
    to_char<span class="token punctuation">(</span>
        sn<span class="token punctuation">.</span>end_interval_time<span class="token punctuation">,</span> <span class="token string">&#39;YYYY-MM-DD HH24:MI:SS&#39;</span>
    <span class="token punctuation">)</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span>
    to_char<span class="token punctuation">(</span>
        sn<span class="token punctuation">.</span>end_interval_time<span class="token punctuation">,</span> <span class="token string">&#39;YYYY-MM-DD HH24:MI:SS&#39;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="文件io" tabindex="-1"><a class="header-anchor" href="#文件io"><span>文件IO</span></a></h2><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span>
    to_char<span class="token punctuation">(</span>
        sn<span class="token punctuation">.</span>end_interval_time<span class="token punctuation">,</span> <span class="token string">&#39;YYYY-MM-DD HH24:MI:SS&#39;</span>
    <span class="token punctuation">)</span>                                                                                                                                         <span class="token string">&quot;End snapshot time&quot;</span>
    <span class="token punctuation">,</span>
    <span class="token function">SUM</span><span class="token punctuation">(</span><span class="token keyword">after</span><span class="token punctuation">.</span>phyrds <span class="token operator">+</span> <span class="token keyword">after</span><span class="token punctuation">.</span>phywrts <span class="token operator">-</span> before<span class="token punctuation">.</span>phywrts <span class="token operator">-</span> before<span class="token punctuation">.</span>phyrds<span class="token punctuation">)</span>                                                                        <span class="token string">&quot;number of IOs&quot;</span>
    <span class="token punctuation">,</span>
    trunc<span class="token punctuation">(</span><span class="token number">10</span> <span class="token operator">*</span> <span class="token function">SUM</span><span class="token punctuation">(</span><span class="token keyword">after</span><span class="token punctuation">.</span>readtim <span class="token operator">+</span> <span class="token keyword">after</span><span class="token punctuation">.</span>writetim <span class="token operator">-</span> before<span class="token punctuation">.</span>writetim <span class="token operator">-</span> before<span class="token punctuation">.</span>readtim<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token function">SUM</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token keyword">after</span><span class="token punctuation">.</span>phyrds <span class="token operator">+</span> <span class="token keyword">after</span><span class="token punctuation">.</span>phywrts <span class="token operator">-</span> before<span class="token punctuation">.</span>phywrts <span class="token operator">-</span> before<span class="token punctuation">.</span>phyrds
    <span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token string">&quot;ave IO time (ms)&quot;</span><span class="token punctuation">,</span>
    trunc<span class="token punctuation">(</span><span class="token punctuation">(</span>
        <span class="token keyword">SELECT</span>
            <span class="token keyword">value</span>
        <span class="token keyword">FROM</span>
            v$parameter
        <span class="token keyword">WHERE</span>
            name <span class="token operator">=</span> <span class="token string">&#39;db_block_size&#39;</span>
    <span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token function">SUM</span><span class="token punctuation">(</span><span class="token keyword">after</span><span class="token punctuation">.</span>phyblkrd <span class="token operator">+</span> <span class="token keyword">after</span><span class="token punctuation">.</span>phyblkwrt <span class="token operator">-</span> before<span class="token punctuation">.</span>phyblkrd <span class="token operator">-</span> before<span class="token punctuation">.</span>phyblkwrt<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token function">SUM</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token keyword">after</span><span class="token punctuation">.</span>phyrds <span class="token operator">+</span> <span class="token keyword">after</span><span class="token punctuation">.</span>phywrts <span class="token operator">-</span> before<span class="token punctuation">.</span>phywrts <span class="token operator">-</span> before<span class="token punctuation">.</span>phyrds
    <span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token string">&quot;ave IO size (bytes)&quot;</span>
<span class="token keyword">FROM</span>
    dba_hist_filestatxs before<span class="token punctuation">,</span>
    dba_hist_filestatxs <span class="token keyword">after</span><span class="token punctuation">,</span>
    dba_hist_snapshot   sn
<span class="token keyword">WHERE</span>
    <span class="token keyword">after</span><span class="token punctuation">.</span><span class="token keyword">file</span><span class="token comment"># = before.file#</span>
    <span class="token operator">AND</span> <span class="token keyword">after</span><span class="token punctuation">.</span>snap_id <span class="token operator">=</span> before<span class="token punctuation">.</span>snap_id <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token operator">AND</span> before<span class="token punctuation">.</span>instance_number <span class="token operator">=</span> <span class="token keyword">after</span><span class="token punctuation">.</span>instance_number
    <span class="token operator">AND</span> <span class="token keyword">after</span><span class="token punctuation">.</span>snap_id <span class="token operator">=</span> sn<span class="token punctuation">.</span>snap_id
    <span class="token operator">AND</span> <span class="token keyword">after</span><span class="token punctuation">.</span>instance_number <span class="token operator">=</span> sn<span class="token punctuation">.</span>instance_number
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span>
    to_char<span class="token punctuation">(</span>
        sn<span class="token punctuation">.</span>end_interval_time<span class="token punctuation">,</span> <span class="token string">&#39;YYYY-MM-DD HH24:MI:SS&#39;</span>
    <span class="token punctuation">)</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span>
    to_char<span class="token punctuation">(</span>
        sn<span class="token punctuation">.</span>end_interval_time<span class="token punctuation">,</span> <span class="token string">&#39;YYYY-MM-DD HH24:MI:SS&#39;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,19),o=[e];function c(l,i){return s(),a("div",null,o)}const k=n(p,[["render",c],["__file","awr.html.vue"]]),d=JSON.parse(`{"path":"/guide/database/oracle/awr.html","title":"AWR","lang":"zh-CN","frontmatter":{"title":"AWR","description":"AWR查询 会话统计 SQL统计 段统计 空间统计 系统负载 等待事件 系统统计信息 IO 文件IO","head":[["meta",{"property":"og:url","content":"https://github.com/abelit/abelit-datapeacock.git/guide/database/oracle/awr.html"}],["meta",{"property":"og:site_name","content":"数之雀"}],["meta",{"property":"og:title","content":"AWR"}],["meta",{"property":"og:description","content":"AWR查询 会话统计 SQL统计 段统计 空间统计 系统负载 等待事件 系统统计信息 IO 文件IO"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-05-11T14:06:18.000Z"}],["meta",{"property":"article:author","content":"Abelit"}],["meta",{"property":"article:modified_time","content":"2024-05-11T14:06:18.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"AWR\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2024-05-11T14:06:18.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Abelit\\",\\"url\\":\\"https://github.com/abelit\\"}]}"]]},"headers":[{"level":2,"title":"AWR查询","slug":"awr查询","link":"#awr查询","children":[{"level":3,"title":"会话统计","slug":"会话统计","link":"#会话统计","children":[]},{"level":3,"title":"SQL统计","slug":"sql统计","link":"#sql统计","children":[]}]},{"level":2,"title":"段统计","slug":"段统计","link":"#段统计","children":[]},{"level":2,"title":"空间统计","slug":"空间统计","link":"#空间统计","children":[]},{"level":2,"title":"系统负载","slug":"系统负载","link":"#系统负载","children":[]},{"level":2,"title":"等待事件","slug":"等待事件","link":"#等待事件","children":[]},{"level":2,"title":"系统统计信息","slug":"系统统计信息","link":"#系统统计信息","children":[]},{"level":2,"title":"IO","slug":"io","link":"#io","children":[]},{"level":2,"title":"文件IO","slug":"文件io","link":"#文件io","children":[]}],"git":{"createdTime":1715436378000,"updatedTime":1715436378000,"contributors":[{"name":"ableit","email":"ychenid@live.com","commits":1}]},"readingTime":{"minutes":3.64,"words":1091},"filePathRelative":"guide/database/oracle/awr.md","localizedDate":"2024年5月11日","autoDesc":true,"excerpt":"<h2>AWR查询</h2>\\n<h3>会话统计</h3>\\n<div class=\\"language-sql\\" data-ext=\\"sql\\" data-title=\\"sql\\"><pre class=\\"language-sql\\"><code><span class=\\"token keyword\\">SELECT</span>\\n    to_char<span class=\\"token punctuation\\">(</span>\\n        snap<span class=\\"token punctuation\\">.</span>end_interval_time<span class=\\"token punctuation\\">,</span> <span class=\\"token string\\">'YYYY-MM-DD HH24:MI:SS'</span>\\n    <span class=\\"token punctuation\\">)</span>          snap_time<span class=\\"token punctuation\\">,</span>\\n    stat<span class=\\"token punctuation\\">.</span><span class=\\"token keyword\\">value</span> session_count\\n<span class=\\"token keyword\\">FROM</span>\\n    dba_hist_sysstat  stat<span class=\\"token punctuation\\">,</span>\\n    dba_hist_snapshot snap\\n<span class=\\"token keyword\\">WHERE</span>\\n    stat<span class=\\"token punctuation\\">.</span>snap_id <span class=\\"token operator\\">=</span> snap<span class=\\"token punctuation\\">.</span>snap_id\\n    <span class=\\"token operator\\">AND</span> stat<span class=\\"token punctuation\\">.</span>dbid <span class=\\"token operator\\">=</span> snap<span class=\\"token punctuation\\">.</span>dbid\\n    <span class=\\"token operator\\">AND</span> stat<span class=\\"token punctuation\\">.</span>instance_number <span class=\\"token operator\\">=</span> snap<span class=\\"token punctuation\\">.</span>instance_number\\n    <span class=\\"token operator\\">AND</span> stat<span class=\\"token punctuation\\">.</span>stat_name <span class=\\"token operator\\">=</span> <span class=\\"token string\\">'logons current'</span>\\n<span class=\\"token keyword\\">ORDER</span> <span class=\\"token keyword\\">BY</span>\\n    to_char<span class=\\"token punctuation\\">(</span>\\n        snap<span class=\\"token punctuation\\">.</span>end_interval_time<span class=\\"token punctuation\\">,</span> <span class=\\"token string\\">'YYYY-MM-DD HH24:MI:SS'</span>\\n    <span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>\\n</code></pre></div>"}`);export{k as comp,d as data};
