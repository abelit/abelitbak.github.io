import{_ as i}from"./mongodb-replication-pnxoiu53rz-BbvfOOSv.js";import{_ as c}from"./plugin-vue_export-helper-DlAUqK2U.js";import{r,o as u,c as d,b as o,w as a,f as l,a as n,d as s}from"./app-DR5J2daJ.js";const k="/assets/sharded-cluster-production-architecture.bakedsvg-bUk90SGi.svg",v={},m=l('<h2 id="副本集集群" tabindex="-1"><a class="header-anchor" href="#副本集集群"><span>副本集集群</span></a></h2><h3 id="主机准备" tabindex="-1"><a class="header-anchor" href="#主机准备"><span>主机准备</span></a></h3><h4 id="架构图" tabindex="-1"><a class="header-anchor" href="#架构图"><span>架构图</span></a></h4><figure><img src="'+i+`" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h4 id="主机信息" tabindex="-1"><a class="header-anchor" href="#主机信息"><span>主机信息</span></a></h4><table><thead><tr><th>IP 地址</th><th>角色</th><th>操作系统</th><th>内核版本</th><th>软件及版本</th></tr></thead><tbody><tr><td>10.10.12.212</td><td>MongoDB 主</td><td>CentOS 7.9</td><td>3.10.0-1160.el7.x86_64</td><td>MongoDB 7.0</td></tr><tr><td>10.10.12.213</td><td>MongoDB 从</td><td>CentOS 7.9</td><td>3.10.0-1160.el7.x86_64</td><td>MongoDB 7.0</td></tr><tr><td>10.10.12.214</td><td>MongoDB 从</td><td>CentOS 7.9</td><td>3.10.0-1160.el7.x86_64</td><td>MongoDB 7.0</td></tr></tbody></table><h4 id="主机配置" tabindex="-1"><a class="header-anchor" href="#主机配置"><span>主机配置</span></a></h4><ul><li>主机名称设置</li></ul><blockquote><p>所有节点</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment"># 节点1</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;dataforum-db1&quot;</span> <span class="token operator">&gt;</span> /etc/hostname
hostnamectl set-hostname dataforum-db1

<span class="token comment"># 节点2</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;dataforum-db2&quot;</span> <span class="token operator">&gt;</span> /etc/hostname
hostnamectl set-hostname dataforum-db2

<span class="token comment"># 节点3</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;dataforum-db3&quot;</span> <span class="token operator">&gt;</span> /etc/hostname
hostnamectl set-hostname dataforum-db3
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>主机<code>hosts</code>设置</li></ul><blockquote><p>所有节点</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">cat</span> <span class="token operator">&lt;&lt;</span> <span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">&gt;&gt;</span> /etc/hosts</span>
10.10.12.212 dataforum-db1
10.10.12.213 dataforum-db2
10.10.12.214 dataforum-db3
EOF</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>关闭防火墙</li></ul><blockquote><p>所有节点</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>systemctl stop firewalld
systemctl disable firewalld
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>Selinux设置</li></ul><blockquote><p>所有节点</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>setenforce <span class="token number">0</span>
<span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">&quot;s/^SELINUX=enforcing/SELINUX=disabled/g&quot;</span> /etc/selinux/config
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="安装mongodb" tabindex="-1"><a class="header-anchor" href="#安装mongodb"><span>安装MongoDB</span></a></h3><h4 id="配置包管理器" tabindex="-1"><a class="header-anchor" href="#配置包管理器"><span>配置包管理器</span></a></h4><blockquote><p>所有节点</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">cat</span> <span class="token operator">&gt;</span> /etc/yum.repos.d/mongodb-org-7.0.repo <span class="token operator">&lt;&lt;</span><span class="token string">EOF
[mongodb-org-7.0]
name=MongoDB Repository
baseurl=https://repo.mongodb.org/yum/redhat/\\<span class="token variable">$releasever</span>/mongodb-org/7.0/x86_64/
gpgcheck=1
enabled=1
gpgkey=https://www.mongodb.org/static/pgp/server-7.0.asc
EOF</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="安装mongo包" tabindex="-1"><a class="header-anchor" href="#安装mongo包"><span>安装Mongo包</span></a></h4><blockquote><p>所有节点</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">sudo</span> yum <span class="token function">install</span> <span class="token parameter variable">-y</span> mongodb-org
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="启动mongo" tabindex="-1"><a class="header-anchor" href="#启动mongo"><span>启动Mongo</span></a></h4><blockquote><p>所有节点</p></blockquote><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>sudo systemctl start mongod
sudo systemctl enable mongod

sudo systemctl status mongod
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="配置集群" tabindex="-1"><a class="header-anchor" href="#配置集群"><span>配置集群</span></a></h3><ul><li>配置mongo支持复制</li></ul><blockquote><p>所有节点</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">&#39;s/#replication:/replication: \\n  oplogSizeMB: 20 \\n  replSetName: abelitres0/g&#39;</span> /etc/mongod.conf
<span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">&#39;s/bindIp: 127.0.0.1/bindIp: 0.0.0.0/g&#39;</span> /etc/mongod.conf

<span class="token function">sudo</span> systemctl restart mongod
<span class="token function">sudo</span> systemctl status mongod
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>登陆mongodb实例</li></ul><blockquote><p>节点1</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>mongosh
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>启动副本集</li></ul><blockquote><p>节点1</p></blockquote><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>use admin

rs<span class="token punctuation">.</span><span class="token function">initiate</span><span class="token punctuation">(</span> <span class="token punctuation">{</span>
   <span class="token literal-property property">_id</span> <span class="token operator">:</span> <span class="token string">&quot;abelitres0&quot;</span><span class="token punctuation">,</span>
   <span class="token literal-property property">members</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span> <span class="token literal-property property">_id</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token literal-property property">host</span><span class="token operator">:</span> <span class="token string">&quot;dataforum-db1:27017&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span> <span class="token literal-property property">_id</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">host</span><span class="token operator">:</span> <span class="token string">&quot;dataforum-db2:27017&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span> <span class="token literal-property property">_id</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token literal-property property">host</span><span class="token operator">:</span> <span class="token string">&quot;dataforum-db3:27017&quot;</span> <span class="token punctuation">}</span>
   <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>查看副本集配置</li></ul><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>rs<span class="token punctuation">.</span><span class="token function">conf</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>查询结果：</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>abelitres0 <span class="token punctuation">[</span>direct<span class="token operator">:</span> primary<span class="token punctuation">]</span> admin<span class="token operator">&gt;</span> rs<span class="token punctuation">.</span><span class="token function">conf</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token literal-property property">_id</span><span class="token operator">:</span> <span class="token string">&#39;abelitres0&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">version</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token literal-property property">term</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token literal-property property">members</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">_id</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token literal-property property">host</span><span class="token operator">:</span> <span class="token string">&#39;dataforum-db1:27017&#39;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">arbiterOnly</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token literal-property property">buildIndexes</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token literal-property property">hidden</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token literal-property property">priority</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token literal-property property">tags</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">secondaryDelaySecs</span><span class="token operator">:</span> <span class="token function">Long</span><span class="token punctuation">(</span><span class="token string">&quot;0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">votes</span><span class="token operator">:</span> <span class="token number">1</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">_id</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token literal-property property">host</span><span class="token operator">:</span> <span class="token string">&#39;dataforum-db2:27017&#39;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">arbiterOnly</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token literal-property property">buildIndexes</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token literal-property property">hidden</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token literal-property property">priority</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token literal-property property">tags</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">secondaryDelaySecs</span><span class="token operator">:</span> <span class="token function">Long</span><span class="token punctuation">(</span><span class="token string">&quot;0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">votes</span><span class="token operator">:</span> <span class="token number">1</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">_id</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
      <span class="token literal-property property">host</span><span class="token operator">:</span> <span class="token string">&#39;dataforum-db3:27017&#39;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">arbiterOnly</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token literal-property property">buildIndexes</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token literal-property property">hidden</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token literal-property property">priority</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token literal-property property">tags</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">secondaryDelaySecs</span><span class="token operator">:</span> <span class="token function">Long</span><span class="token punctuation">(</span><span class="token string">&quot;0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">votes</span><span class="token operator">:</span> <span class="token number">1</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">protocolVersion</span><span class="token operator">:</span> <span class="token function">Long</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token literal-property property">writeConcernMajorityJournalDefault</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token literal-property property">settings</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">chainingAllowed</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">heartbeatIntervalMillis</span><span class="token operator">:</span> <span class="token number">2000</span><span class="token punctuation">,</span>
    <span class="token literal-property property">heartbeatTimeoutSecs</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
    <span class="token literal-property property">electionTimeoutMillis</span><span class="token operator">:</span> <span class="token number">10000</span><span class="token punctuation">,</span>
    <span class="token literal-property property">catchUpTimeoutMillis</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token literal-property property">catchUpTakeoverDelayMillis</span><span class="token operator">:</span> <span class="token number">30000</span><span class="token punctuation">,</span>
    <span class="token literal-property property">getLastErrorModes</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">getLastErrorDefaults</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">w</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">wtimeout</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">replicaSetId</span><span class="token operator">:</span> <span class="token function">ObjectId</span><span class="token punctuation">(</span><span class="token string">&quot;64e86febf94a1d8fb3311526&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>查看副本集中主节点</li></ul><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>rs<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>查询结果：</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>abelitres0 <span class="token punctuation">[</span>direct<span class="token operator">:</span> primary<span class="token punctuation">]</span> admin<span class="token operator">&gt;</span> rs<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token literal-property property">set</span><span class="token operator">:</span> <span class="token string">&#39;abelitres0&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">date</span><span class="token operator">:</span> <span class="token function">ISODate</span><span class="token punctuation">(</span><span class="token string">&quot;2023-08-25T09:11:01.784Z&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token literal-property property">myState</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token literal-property property">term</span><span class="token operator">:</span> <span class="token function">Long</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token literal-property property">syncSourceHost</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">syncSourceId</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token literal-property property">heartbeatIntervalMillis</span><span class="token operator">:</span> <span class="token function">Long</span><span class="token punctuation">(</span><span class="token string">&quot;2000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token literal-property property">majorityVoteCount</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  <span class="token literal-property property">writeMajorityCount</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  <span class="token literal-property property">votingMembersCount</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
  <span class="token literal-property property">writableVotingMembersCount</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
  <span class="token literal-property property">optimes</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">lastCommittedOpTime</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">ts</span><span class="token operator">:</span> <span class="token function">Timestamp</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">t</span><span class="token operator">:</span> <span class="token number">1692954653</span><span class="token punctuation">,</span> <span class="token literal-property property">i</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token literal-property property">t</span><span class="token operator">:</span> <span class="token function">Long</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">lastCommittedWallTime</span><span class="token operator">:</span> <span class="token function">ISODate</span><span class="token punctuation">(</span><span class="token string">&quot;2023-08-25T09:10:53.894Z&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">readConcernMajorityOpTime</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">ts</span><span class="token operator">:</span> <span class="token function">Timestamp</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">t</span><span class="token operator">:</span> <span class="token number">1692954653</span><span class="token punctuation">,</span> <span class="token literal-property property">i</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token literal-property property">t</span><span class="token operator">:</span> <span class="token function">Long</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">appliedOpTime</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">ts</span><span class="token operator">:</span> <span class="token function">Timestamp</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">t</span><span class="token operator">:</span> <span class="token number">1692954653</span><span class="token punctuation">,</span> <span class="token literal-property property">i</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token literal-property property">t</span><span class="token operator">:</span> <span class="token function">Long</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">durableOpTime</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">ts</span><span class="token operator">:</span> <span class="token function">Timestamp</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">t</span><span class="token operator">:</span> <span class="token number">1692954653</span><span class="token punctuation">,</span> <span class="token literal-property property">i</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token literal-property property">t</span><span class="token operator">:</span> <span class="token function">Long</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">lastAppliedWallTime</span><span class="token operator">:</span> <span class="token function">ISODate</span><span class="token punctuation">(</span><span class="token string">&quot;2023-08-25T09:10:53.894Z&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">lastDurableWallTime</span><span class="token operator">:</span> <span class="token function">ISODate</span><span class="token punctuation">(</span><span class="token string">&quot;2023-08-25T09:10:53.894Z&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">lastStableRecoveryTimestamp</span><span class="token operator">:</span> <span class="token function">Timestamp</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">t</span><span class="token operator">:</span> <span class="token number">1692954603</span><span class="token punctuation">,</span> <span class="token literal-property property">i</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token literal-property property">electionCandidateMetrics</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">lastElectionReason</span><span class="token operator">:</span> <span class="token string">&#39;electionTimeout&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">lastElectionDate</span><span class="token operator">:</span> <span class="token function">ISODate</span><span class="token punctuation">(</span><span class="token string">&quot;2023-08-25T09:10:13.861Z&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">electionTerm</span><span class="token operator">:</span> <span class="token function">Long</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">lastCommittedOpTimeAtElection</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">ts</span><span class="token operator">:</span> <span class="token function">Timestamp</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">t</span><span class="token operator">:</span> <span class="token number">1692954603</span><span class="token punctuation">,</span> <span class="token literal-property property">i</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token literal-property property">t</span><span class="token operator">:</span> <span class="token function">Long</span><span class="token punctuation">(</span><span class="token string">&quot;-1&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">lastSeenOpTimeAtElection</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">ts</span><span class="token operator">:</span> <span class="token function">Timestamp</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">t</span><span class="token operator">:</span> <span class="token number">1692954603</span><span class="token punctuation">,</span> <span class="token literal-property property">i</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token literal-property property">t</span><span class="token operator">:</span> <span class="token function">Long</span><span class="token punctuation">(</span><span class="token string">&quot;-1&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">numVotesNeeded</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token literal-property property">priorityAtElection</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token literal-property property">electionTimeoutMillis</span><span class="token operator">:</span> <span class="token function">Long</span><span class="token punctuation">(</span><span class="token string">&quot;10000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">numCatchUpOps</span><span class="token operator">:</span> <span class="token function">Long</span><span class="token punctuation">(</span><span class="token string">&quot;0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">newTermStartDate</span><span class="token operator">:</span> <span class="token function">ISODate</span><span class="token punctuation">(</span><span class="token string">&quot;2023-08-25T09:10:13.884Z&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">wMajorityWriteAvailabilityDate</span><span class="token operator">:</span> <span class="token function">ISODate</span><span class="token punctuation">(</span><span class="token string">&quot;2023-08-25T09:10:14.392Z&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">members</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">_id</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;dataforum-db1:27017&#39;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">health</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token literal-property property">state</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token literal-property property">stateStr</span><span class="token operator">:</span> <span class="token string">&#39;PRIMARY&#39;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">uptime</span><span class="token operator">:</span> <span class="token number">109</span><span class="token punctuation">,</span>
      <span class="token literal-property property">optime</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">ts</span><span class="token operator">:</span> <span class="token function">Timestamp</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">t</span><span class="token operator">:</span> <span class="token number">1692954653</span><span class="token punctuation">,</span> <span class="token literal-property property">i</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token literal-property property">t</span><span class="token operator">:</span> <span class="token function">Long</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">optimeDate</span><span class="token operator">:</span> <span class="token function">ISODate</span><span class="token punctuation">(</span><span class="token string">&quot;2023-08-25T09:10:53.000Z&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">lastAppliedWallTime</span><span class="token operator">:</span> <span class="token function">ISODate</span><span class="token punctuation">(</span><span class="token string">&quot;2023-08-25T09:10:53.894Z&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">lastDurableWallTime</span><span class="token operator">:</span> <span class="token function">ISODate</span><span class="token punctuation">(</span><span class="token string">&quot;2023-08-25T09:10:53.894Z&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">syncSourceHost</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">syncSourceId</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token literal-property property">infoMessage</span><span class="token operator">:</span> <span class="token string">&#39;Could not find member to sync from&#39;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">electionTime</span><span class="token operator">:</span> <span class="token function">Timestamp</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">t</span><span class="token operator">:</span> <span class="token number">1692954613</span><span class="token punctuation">,</span> <span class="token literal-property property">i</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">electionDate</span><span class="token operator">:</span> <span class="token function">ISODate</span><span class="token punctuation">(</span><span class="token string">&quot;2023-08-25T09:10:13.000Z&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">configVersion</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token literal-property property">configTerm</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token literal-property property">self</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token literal-property property">lastHeartbeatMessage</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">_id</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;dataforum-db2:27017&#39;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">health</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token literal-property property">state</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
      <span class="token literal-property property">stateStr</span><span class="token operator">:</span> <span class="token string">&#39;SECONDARY&#39;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">uptime</span><span class="token operator">:</span> <span class="token number">58</span><span class="token punctuation">,</span>
      <span class="token literal-property property">optime</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">ts</span><span class="token operator">:</span> <span class="token function">Timestamp</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">t</span><span class="token operator">:</span> <span class="token number">1692954653</span><span class="token punctuation">,</span> <span class="token literal-property property">i</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token literal-property property">t</span><span class="token operator">:</span> <span class="token function">Long</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">optimeDurable</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">ts</span><span class="token operator">:</span> <span class="token function">Timestamp</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">t</span><span class="token operator">:</span> <span class="token number">1692954653</span><span class="token punctuation">,</span> <span class="token literal-property property">i</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token literal-property property">t</span><span class="token operator">:</span> <span class="token function">Long</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">optimeDate</span><span class="token operator">:</span> <span class="token function">ISODate</span><span class="token punctuation">(</span><span class="token string">&quot;2023-08-25T09:10:53.000Z&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">optimeDurableDate</span><span class="token operator">:</span> <span class="token function">ISODate</span><span class="token punctuation">(</span><span class="token string">&quot;2023-08-25T09:10:53.000Z&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">lastAppliedWallTime</span><span class="token operator">:</span> <span class="token function">ISODate</span><span class="token punctuation">(</span><span class="token string">&quot;2023-08-25T09:10:53.894Z&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">lastDurableWallTime</span><span class="token operator">:</span> <span class="token function">ISODate</span><span class="token punctuation">(</span><span class="token string">&quot;2023-08-25T09:10:53.894Z&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">lastHeartbeat</span><span class="token operator">:</span> <span class="token function">ISODate</span><span class="token punctuation">(</span><span class="token string">&quot;2023-08-25T09:10:59.869Z&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">lastHeartbeatRecv</span><span class="token operator">:</span> <span class="token function">ISODate</span><span class="token punctuation">(</span><span class="token string">&quot;2023-08-25T09:11:00.869Z&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">pingMs</span><span class="token operator">:</span> <span class="token function">Long</span><span class="token punctuation">(</span><span class="token string">&quot;0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">lastHeartbeatMessage</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">syncSourceHost</span><span class="token operator">:</span> <span class="token string">&#39;dataforum-db1:27017&#39;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">syncSourceId</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token literal-property property">infoMessage</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">configVersion</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token literal-property property">configTerm</span><span class="token operator">:</span> <span class="token number">1</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">_id</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;dataforum-db3:27017&#39;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">health</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token literal-property property">state</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
      <span class="token literal-property property">stateStr</span><span class="token operator">:</span> <span class="token string">&#39;SECONDARY&#39;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">uptime</span><span class="token operator">:</span> <span class="token number">58</span><span class="token punctuation">,</span>
      <span class="token literal-property property">optime</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">ts</span><span class="token operator">:</span> <span class="token function">Timestamp</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">t</span><span class="token operator">:</span> <span class="token number">1692954653</span><span class="token punctuation">,</span> <span class="token literal-property property">i</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token literal-property property">t</span><span class="token operator">:</span> <span class="token function">Long</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">optimeDurable</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">ts</span><span class="token operator">:</span> <span class="token function">Timestamp</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">t</span><span class="token operator">:</span> <span class="token number">1692954653</span><span class="token punctuation">,</span> <span class="token literal-property property">i</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token literal-property property">t</span><span class="token operator">:</span> <span class="token function">Long</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">optimeDate</span><span class="token operator">:</span> <span class="token function">ISODate</span><span class="token punctuation">(</span><span class="token string">&quot;2023-08-25T09:10:53.000Z&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">optimeDurableDate</span><span class="token operator">:</span> <span class="token function">ISODate</span><span class="token punctuation">(</span><span class="token string">&quot;2023-08-25T09:10:53.000Z&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">lastAppliedWallTime</span><span class="token operator">:</span> <span class="token function">ISODate</span><span class="token punctuation">(</span><span class="token string">&quot;2023-08-25T09:10:53.894Z&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">lastDurableWallTime</span><span class="token operator">:</span> <span class="token function">ISODate</span><span class="token punctuation">(</span><span class="token string">&quot;2023-08-25T09:10:53.894Z&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">lastHeartbeat</span><span class="token operator">:</span> <span class="token function">ISODate</span><span class="token punctuation">(</span><span class="token string">&quot;2023-08-25T09:10:59.869Z&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">lastHeartbeatRecv</span><span class="token operator">:</span> <span class="token function">ISODate</span><span class="token punctuation">(</span><span class="token string">&quot;2023-08-25T09:11:00.869Z&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">pingMs</span><span class="token operator">:</span> <span class="token function">Long</span><span class="token punctuation">(</span><span class="token string">&quot;0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">lastHeartbeatMessage</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">syncSourceHost</span><span class="token operator">:</span> <span class="token string">&#39;dataforum-db1:27017&#39;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">syncSourceId</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token literal-property property">infoMessage</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">configVersion</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token literal-property property">configTerm</span><span class="token operator">:</span> <span class="token number">1</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">ok</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token string-property property">&#39;$clusterTime&#39;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">clusterTime</span><span class="token operator">:</span> <span class="token function">Timestamp</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">t</span><span class="token operator">:</span> <span class="token number">1692954653</span><span class="token punctuation">,</span> <span class="token literal-property property">i</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">signature</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">hash</span><span class="token operator">:</span> <span class="token function">Binary</span><span class="token punctuation">(</span>Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;0000000000000000000000000000000000000000&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;hex&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">keyId</span><span class="token operator">:</span> <span class="token function">Long</span><span class="token punctuation">(</span><span class="token string">&quot;0&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">operationTime</span><span class="token operator">:</span> <span class="token function">Timestamp</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">t</span><span class="token operator">:</span> <span class="token number">1692954653</span><span class="token punctuation">,</span> <span class="token literal-property property">i</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="副本集群测试" tabindex="-1"><a class="header-anchor" href="#副本集群测试"><span>副本集群测试</span></a></h3><h4 id="同步数据测试" tabindex="-1"><a class="header-anchor" href="#同步数据测试"><span>同步数据测试</span></a></h4><ul><li>在主节点上建库和集合</li></ul><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>mongosh
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>use abelitdb

db<span class="token punctuation">.</span><span class="token function">createCollection</span><span class="token punctuation">(</span><span class="token string">&#39;movies&#39;</span><span class="token punctuation">)</span>

show dbs

show collections

db<span class="token punctuation">.</span>movies<span class="token punctuation">.</span><span class="token function">insertOne</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&quot;The Favourite&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">genres</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">&quot;Drama&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;History&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">runtime</span><span class="token operator">:</span> <span class="token number">121</span><span class="token punctuation">,</span>
    <span class="token literal-property property">rated</span><span class="token operator">:</span> <span class="token string">&quot;R&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">year</span><span class="token operator">:</span> <span class="token number">2018</span><span class="token punctuation">,</span>
    <span class="token literal-property property">directors</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">&quot;Yorgos Lanthimos&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">cast</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">&quot;Olivia Colman&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Emma Stone&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Rachel Weisz&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;movie&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>

db<span class="token punctuation">.</span>movies<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span> <span class="token punctuation">{</span> <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&quot;The Favourite&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">)</span>


db<span class="token punctuation">.</span>movies<span class="token punctuation">.</span><span class="token function">insertMany</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
   <span class="token punctuation">{</span>
      <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&quot;Jurassic World: Fallen Kingdom&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">genres</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">&quot;Action&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Sci-Fi&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token literal-property property">runtime</span><span class="token operator">:</span> <span class="token number">130</span><span class="token punctuation">,</span>
      <span class="token literal-property property">rated</span><span class="token operator">:</span> <span class="token string">&quot;PG-13&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">year</span><span class="token operator">:</span> <span class="token number">2018</span><span class="token punctuation">,</span>
      <span class="token literal-property property">directors</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">&quot;J. A. Bayona&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token literal-property property">cast</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">&quot;Chris Pratt&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Bryce Dallas Howard&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Rafe Spall&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;movie&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&quot;Tag&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">genres</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">&quot;Comedy&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Action&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token literal-property property">runtime</span><span class="token operator">:</span> <span class="token number">105</span><span class="token punctuation">,</span>
      <span class="token literal-property property">rated</span><span class="token operator">:</span> <span class="token string">&quot;R&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">year</span><span class="token operator">:</span> <span class="token number">2018</span><span class="token punctuation">,</span>
      <span class="token literal-property property">directors</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">&quot;Jeff Tomsic&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token literal-property property">cast</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">&quot;Annabelle Wallis&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Jeremy Renner&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Jon Hamm&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;movie&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>

db<span class="token punctuation">.</span>movies<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>在从节点上查看数据同步情况</li></ul><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>rs<span class="token punctuation">.</span><span class="token function">secondaryOk</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
show dbs     
show collections
db<span class="token punctuation">.</span>movies<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="故障转移" tabindex="-1"><a class="header-anchor" href="#故障转移"><span>故障转移</span></a></h3><h4 id="主库宕机" tabindex="-1"><a class="header-anchor" href="#主库宕机"><span>主库宕机</span></a></h4><ul><li>在主上查看所有机器的权重</li></ul><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>rs<span class="token punctuation">.</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="hint-container tip"><p class="hint-container-title">提示</p><p>默认所有的机器权重都为1，如果任何一个权重设置为比其他的高，则该台机器立马会切换为primary角色，所以要我们预设三台机器的权重。</p></div><ul><li>设置权重</li></ul><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>cfg<span class="token operator">=</span>rs<span class="token punctuation">.</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
cfg<span class="token punctuation">.</span>members<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>priority <span class="token operator">=</span> <span class="token number">3</span>
cfg<span class="token punctuation">.</span>members<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>priority <span class="token operator">=</span> <span class="token number">2</span>
rs<span class="token punctuation">.</span><span class="token function">reconfig</span><span class="token punctuation">(</span>cfg<span class="token punctuation">)</span>
rs<span class="token punctuation">.</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>禁掉主上的mongod服务，模拟主宕机</li></ul><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>iptables <span class="token parameter variable">-I</span> INPUT <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">--dport</span> <span class="token number">27017</span> <span class="token parameter variable">-j</span> DROP
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>rs<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="主库恢复-原" tabindex="-1"><a class="header-anchor" href="#主库恢复-原"><span>主库恢复（原）</span></a></h4><p>在原主库恢复后，检测新主写入的数据是否同步</p><ul><li>新主上建库和集合</li></ul><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>use cydb
db<span class="token punctuation">.</span><span class="token function">createCollection</span><span class="token punctuation">(</span><span class="token string">&#39;films&#39;</span><span class="token punctuation">)</span>
show dbs
show collections

db<span class="token punctuation">.</span>films<span class="token punctuation">.</span><span class="token function">insertOne</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&quot;The Favourite&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">genres</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">&quot;Drama&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;History&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">runtime</span><span class="token operator">:</span> <span class="token number">121</span><span class="token punctuation">,</span>
    <span class="token literal-property property">rated</span><span class="token operator">:</span> <span class="token string">&quot;R&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">year</span><span class="token operator">:</span> <span class="token number">2018</span><span class="token punctuation">,</span>
    <span class="token literal-property property">directors</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">&quot;Yorgos Lanthimos&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">cast</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">&quot;Olivia Colman&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Emma Stone&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Rachel Weisz&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;movie&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>

db<span class="token punctuation">.</span>films<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span> <span class="token punctuation">{</span> <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&quot;The Favourite&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>删除规则，恢复原主</li></ul><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>iptables <span class="token parameter variable">-D</span> INPUT <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">--dport</span> <span class="token number">27017</span> <span class="token parameter variable">-j</span> DROP
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>登入原主，查看数据库信息(mongosh)</li></ul><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>use cydb

show dbs
show collections

db<span class="token punctuation">.</span>films<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span> <span class="token punctuation">{</span> <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&quot;The Favourite&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="分片集群" tabindex="-1"><a class="header-anchor" href="#分片集群"><span>分片集群</span></a></h2><h3 id="主机准备-1" tabindex="-1"><a class="header-anchor" href="#主机准备-1"><span>主机准备</span></a></h3><h4 id="架构图-1" tabindex="-1"><a class="header-anchor" href="#架构图-1"><span>架构图</span></a></h4><p>MongoDB分片集群，英文名称为： Sharded Cluster, 旨在通过横向扩展，来提高数据吞吐性能、增大数据存储量。</p><figure><img src="`+k+`" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>分片集群由三个组件：“mongos”, “config server”, “shard” 组成。</p><ul><li>mongos:数据库请求路由。负责接收所有客户端应用程序的连接查询请求，并将请求路由到集群内部对应的分片上。&quot;mongos&quot;可以有1个或多个。</li><li>config server: 配置服务，负责保存集群的元数据信息，比如集群的分片信息、用户信息。 MongoDB 3.4 版本以后，“config server” 必须是副本集！</li><li>shard: 分片存储。将数据分片存储在多个服务器上。 有点类似关系数据库&quot;分区表&quot;的概念，只不过分区表是将数据分散存储在多个文件中，而sharding将数据分散存储在多个服务器上。一个集群可以有一个或多个分片。 MongoDB 3.6以后，每个分片都必须是副本集！</li></ul><h4 id="主机信息-1" tabindex="-1"><a class="header-anchor" href="#主机信息-1"><span>主机信息</span></a></h4><table><thead><tr><th>IP 地址</th><th>角色</th><th>操作系统</th><th>内核版本</th><th>软件及版本</th></tr></thead><tbody><tr><td>10.10.13.100</td><td>mongos 1</td><td>CentOS 7.9</td><td>3.10.0-1160.el7.x86_64</td><td>MongoDB 7.0</td></tr><tr><td>10.10.13.101</td><td>mongos 2</td><td>CentOS 7.9</td><td>3.10.0-1160.el7.x86_64</td><td>MongoDB 7.0</td></tr><tr><td>10.10.13.102</td><td>config 1</td><td>CentOS 7.9</td><td>3.10.0-1160.el7.x86_64</td><td>MongoDB 7.0</td></tr><tr><td>10.10.13.103</td><td>config 2</td><td>CentOS 7.9</td><td>3.10.0-1160.el7.x86_64</td><td>MongoDB 7.0</td></tr><tr><td>10.10.13.104</td><td>config 3</td><td>CentOS 7.9</td><td>3.10.0-1160.el7.x86_64</td><td>MongoDB 7.0</td></tr><tr><td>10.10.13.105</td><td>shard1-1</td><td>CentOS 7.9</td><td>3.10.0-1160.el7.x86_64</td><td>MongoDB 7.0</td></tr><tr><td>10.10.13.106</td><td>shard1-2</td><td>CentOS 7.9</td><td>3.10.0-1160.el7.x86_64</td><td>MongoDB 7.0</td></tr><tr><td>10.10.13.107</td><td>shard1-3</td><td>CentOS 7.9</td><td>3.10.0-1160.el7.x86_64</td><td>MongoDB 7.0</td></tr><tr><td>10.10.13.108</td><td>shard2-1</td><td>CentOS 7.9</td><td>3.10.0-1160.el7.x86_64</td><td>MongoDB 7.0</td></tr><tr><td>10.10.13.109</td><td>shard2-2</td><td>CentOS 7.9</td><td>3.10.0-1160.el7.x86_64</td><td>MongoDB 7.0</td></tr><tr><td>10.10.13.110</td><td>shard2-3</td><td>CentOS 7.9</td><td>3.10.0-1160.el7.x86_64</td><td>MongoDB 7.0</td></tr></tbody></table><h4 id="主机配置-1" tabindex="-1"><a class="header-anchor" href="#主机配置-1"><span>主机配置</span></a></h4><ul><li>主机名称设置</li></ul><blockquote><p>所有节点</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment"># 在管理节点上执行即可</span>
<span class="token assign-left variable">hosts</span><span class="token operator">=</span><span class="token string">&quot;10.10.13.100 10.10.13.101 10.10.13.102 10.10.13.103 10.10.13.104 10.10.13.105 10.10.13.106 10.10.13.107 10.10.13.108 10.10.13.109 10.10.13.110&quot;</span>
<span class="token assign-left variable">num</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token keyword">for</span> <span class="token for-or-select variable">host</span> <span class="token keyword">in</span> <span class="token variable">$hosts</span><span class="token punctuation">;</span> 
<span class="token keyword">do</span> 
sshpass <span class="token parameter variable">-p</span> <span class="token string">&#39;root@123&#39;</span> <span class="token function">ssh</span> <span class="token parameter variable">-o</span> <span class="token assign-left variable">StrictHostKeyChecking</span><span class="token operator">=</span>no root@<span class="token variable">\${host}</span> hostnamectl set-hostname <span class="token function">node</span><span class="token variable">$num</span> <span class="token punctuation">;</span><span class="token assign-left variable">num</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span>$num<span class="token operator">+</span><span class="token number">1</span><span class="token variable">))</span></span><span class="token punctuation">;</span>
<span class="token keyword">done</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>主机<code>hosts</code>设置</li></ul><blockquote><p>所有节点</p></blockquote>`,87),b=n("div",{class:"language-bash line-numbers-mode","data-ext":"sh","data-title":"sh"},[n("pre",{class:"language-bash"},[n("code",null,[n("span",{class:"token function"},"cat"),s(),n("span",{class:"token operator"},">"),s(" /etc/hosts "),n("span",{class:"token operator"},"<<"),n("span",{class:"token string"},`EOF
127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
::1         localhost localhost.localdomain localhost6 localhost6.localdomain6

# by abelit
10.10.13.100 node1
10.10.13.101 node2
10.10.13.102 node3
10.10.13.103 node4
10.10.13.104 node5
10.10.13.105 node6
10.10.13.106 node7
10.10.13.107 node8
10.10.13.108 node9
10.10.13.109 node10
10.10.13.110 node11
EOF`),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),g=n("div",{class:"language-bash line-numbers-mode","data-ext":"sh","data-title":"sh"},[n("pre",{class:"language-bash"},[n("code",null,[n("span",{class:"token assign-left variable"},"hosts"),n("span",{class:"token operator"},"="),n("span",{class:"token string"},'"10.10.13.100 10.10.13.101 10.10.13.102 10.10.13.103 10.10.13.104 10.10.13.105 10.10.13.106 10.10.13.107 10.10.13.108 10.10.13.109 10.10.13.110"'),s(`

`),n("span",{class:"token keyword"},"for"),s(),n("span",{class:"token for-or-select variable"},"host"),s(),n("span",{class:"token keyword"},"in"),s(),n("span",{class:"token variable"},"$hosts"),n("span",{class:"token punctuation"},";"),s(` 
`),n("span",{class:"token keyword"},"do"),s(` 
sshpass `),n("span",{class:"token parameter variable"},"-p"),s(),n("span",{class:"token string"},"'root@123'"),s(),n("span",{class:"token function"},"ssh"),s(),n("span",{class:"token parameter variable"},"-o"),s(),n("span",{class:"token assign-left variable"},"StrictHostKeyChecking"),n("span",{class:"token operator"},"="),s("no root@"),n("span",{class:"token variable"},"${host}"),s(),n("span",{class:"token function"},"bash"),s(),n("span",{class:"token operator"},"<<"),n("span",{class:"token string"},`SSHEOF
cat > /etc/hosts <<EOF
127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
::1         localhost localhost.localdomain localhost6 localhost6.localdomain6

# by abelit
10.10.13.100 node1
10.10.13.101 node2
10.10.13.102 node3
10.10.13.103 node4
10.10.13.104 node5
10.10.13.105 node6
10.10.13.106 node7
10.10.13.107 node8
10.10.13.108 node9
10.10.13.109 node10
10.10.13.110 node11
EOF
SSHEOF`),s(`
`),n("span",{class:"token keyword"},"done"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),h=n("ul",null,[n("li",null,"关闭防火墙")],-1),y=n("blockquote",null,[n("p",null,"所有节点")],-1),f=n("div",{class:"language-bash line-numbers-mode","data-ext":"sh","data-title":"sh"},[n("pre",{class:"language-bash"},[n("code",null,`systemctl stop firewalld
systemctl disable firewalld
`)]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),q=n("div",{class:"language-bash line-numbers-mode","data-ext":"sh","data-title":"sh"},[n("pre",{class:"language-bash"},[n("code",null,[n("span",{class:"token assign-left variable"},"hosts"),n("span",{class:"token operator"},"="),n("span",{class:"token string"},'"10.10.13.100 10.10.13.101 10.10.13.102 10.10.13.103 10.10.13.104 10.10.13.105 10.10.13.106 10.10.13.107 10.10.13.108 10.10.13.109 10.10.13.110"'),s(`

`),n("span",{class:"token keyword"},"for"),s(),n("span",{class:"token for-or-select variable"},"host"),s(),n("span",{class:"token keyword"},"in"),s(),n("span",{class:"token variable"},"$hosts"),n("span",{class:"token punctuation"},";"),s(` 
`),n("span",{class:"token keyword"},"do"),s(` 
sshpass `),n("span",{class:"token parameter variable"},"-p"),s(),n("span",{class:"token string"},"'root@123'"),s(),n("span",{class:"token function"},"ssh"),s(),n("span",{class:"token parameter variable"},"-o"),s(),n("span",{class:"token assign-left variable"},"StrictHostKeyChecking"),n("span",{class:"token operator"},"="),s("no root@"),n("span",{class:"token variable"},"${host}"),s(),n("span",{class:"token function"},"bash"),s(),n("span",{class:"token operator"},"<<"),n("span",{class:"token string"},`SSHEOF
systemctl stop firewalld
systemctl disable firewalld
SSHEOF`),s(`
`),n("span",{class:"token keyword"},"done"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),x=n("ul",null,[n("li",null,"Selinux设置")],-1),S=n("blockquote",null,[n("p",null,"所有节点")],-1),j=n("div",{class:"language-bash line-numbers-mode","data-ext":"sh","data-title":"sh"},[n("pre",{class:"language-bash"},[n("code",null,[s("setenforce "),n("span",{class:"token number"},"0"),s(`
`),n("span",{class:"token function"},"sed"),s(),n("span",{class:"token parameter variable"},"-i"),s(),n("span",{class:"token string"},'"s/^SELINUX=enforcing/SELINUX=disabled/g"'),s(` /etc/selinux/config
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),_=n("div",{class:"language-bash line-numbers-mode","data-ext":"sh","data-title":"sh"},[n("pre",{class:"language-bash"},[n("code",null,[n("span",{class:"token assign-left variable"},"hosts"),n("span",{class:"token operator"},"="),n("span",{class:"token string"},'"10.10.13.100 10.10.13.101 10.10.13.102 10.10.13.103 10.10.13.104 10.10.13.105 10.10.13.106 10.10.13.107 10.10.13.108 10.10.13.109 10.10.13.110"'),s(`

`),n("span",{class:"token keyword"},"for"),s(),n("span",{class:"token for-or-select variable"},"host"),s(),n("span",{class:"token keyword"},"in"),s(),n("span",{class:"token variable"},"$hosts"),n("span",{class:"token punctuation"},";"),s(` 
`),n("span",{class:"token keyword"},"do"),s(` 
sshpass `),n("span",{class:"token parameter variable"},"-p"),s(),n("span",{class:"token string"},"'root@123'"),s(),n("span",{class:"token function"},"ssh"),s(),n("span",{class:"token parameter variable"},"-o"),s(),n("span",{class:"token assign-left variable"},"StrictHostKeyChecking"),n("span",{class:"token operator"},"="),s("no root@"),n("span",{class:"token variable"},"${host}"),s(),n("span",{class:"token function"},"bash"),s(),n("span",{class:"token operator"},"<<"),n("span",{class:"token string"},`SSHEOF
setenforce 0
sed -i "s/^SELINUX=enforcing/SELINUX=disabled/g" /etc/selinux/config
SSHEOF`),s(`
`),n("span",{class:"token keyword"},"done"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),D=n("h3",{id:"安装mongodb-1",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#安装mongodb-1"},[n("span",null,"安装MongoDB")])],-1),T=n("h4",{id:"配置包管理器-1",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#配置包管理器-1"},[n("span",null,"配置包管理器")])],-1),O=n("blockquote",null,[n("p",null,"所有节点")],-1),w=n("div",{class:"language-bash line-numbers-mode","data-ext":"sh","data-title":"sh"},[n("pre",{class:"language-bash"},[n("code",null,[n("span",{class:"token assign-left variable"},"hosts"),n("span",{class:"token operator"},"="),n("span",{class:"token string"},'"10.10.13.100 10.10.13.101 10.10.13.102 10.10.13.103 10.10.13.104 10.10.13.105 10.10.13.106 10.10.13.107 10.10.13.108 10.10.13.109 10.10.13.110"'),s(`

`),n("span",{class:"token keyword"},"for"),s(),n("span",{class:"token for-or-select variable"},"host"),s(),n("span",{class:"token keyword"},"in"),s(),n("span",{class:"token variable"},"$hosts"),n("span",{class:"token punctuation"},";"),s(` 
`),n("span",{class:"token keyword"},"do"),s(` 
sshpass `),n("span",{class:"token parameter variable"},"-p"),s(),n("span",{class:"token string"},"'root@123'"),s(),n("span",{class:"token function"},"ssh"),s(),n("span",{class:"token parameter variable"},"-o"),s(),n("span",{class:"token assign-left variable"},"StrictHostKeyChecking"),n("span",{class:"token operator"},"="),s("no root@"),n("span",{class:"token variable"},"${host}"),s(),n("span",{class:"token function"},"bash"),s(),n("span",{class:"token operator"},"<<"),n("span",{class:"token string"},`'SSHEOF'
cat > /etc/yum.repos.d/mongodb-org-7.0.repo <<'EOF'
[mongodb-org-7.0]
name=MongoDB Repository
baseurl=https://repo.mongodb.org/yum/redhat/$releasever/mongodb-org/7.0/x86_64/
gpgcheck=1
enabled=1
gpgkey=https://www.mongodb.org/static/pgp/server-7.0.asc
EOF
SSHEOF`),s(`
`),n("span",{class:"token keyword"},"done"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),M=n("div",{class:"language-bash line-numbers-mode","data-ext":"sh","data-title":"sh"},[n("pre",{class:"language-bash"},[n("code",null,[n("span",{class:"token function"},"cat"),s(),n("span",{class:"token operator"},">"),s(" /etc/yum.repos.d/mongodb-org-3.6.repo "),n("span",{class:"token operator"},"<<"),n("span",{class:"token string"},"'EOF'"),s(`
`),n("span",{class:"token punctuation"},"["),s("mongodb-org"),n("span",{class:"token punctuation"},"]"),s(` 
name `),n("span",{class:"token operator"},"="),s(` MongoDB Repository
baseurl `),n("span",{class:"token operator"},"="),s(" https://mirrors.aliyun.com/mongodb/yum/redhat/"),n("span",{class:"token variable"},"$releasever"),s(`/mongodb-org/3.6/x86_64/
gpgcheck `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"1"),s(` 
enabled `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"1"),s(` 
gpgkey `),n("span",{class:"token operator"},"="),s(` https://www.mongodb.org/static/pgp/server-3.6.asc
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),C=n("h4",{id:"安装mongo包-1",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#安装mongo包-1"},[n("span",null,"安装Mongo包")])],-1),I=n("blockquote",null,[n("p",null,"所有节点")],-1),B=n("div",{class:"language-bash line-numbers-mode","data-ext":"sh","data-title":"sh"},[n("pre",{class:"language-bash"},[n("code",null,[s("yum "),n("span",{class:"token function"},"install"),s(),n("span",{class:"token parameter variable"},"-y"),s(` mongodb-org
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"})])],-1),A=n("div",{class:"language-bash line-numbers-mode","data-ext":"sh","data-title":"sh"},[n("pre",{class:"language-bash"},[n("code",null,[n("span",{class:"token assign-left variable"},"hosts"),n("span",{class:"token operator"},"="),n("span",{class:"token string"},'"10.10.13.100 10.10.13.101 10.10.13.102 10.10.13.103 10.10.13.104 10.10.13.105 10.10.13.106 10.10.13.107 10.10.13.108 10.10.13.109 10.10.13.110"'),s(`

`),n("span",{class:"token keyword"},"for"),s(),n("span",{class:"token for-or-select variable"},"host"),s(),n("span",{class:"token keyword"},"in"),s(),n("span",{class:"token variable"},"$hosts"),n("span",{class:"token punctuation"},";"),s(` 
`),n("span",{class:"token keyword"},"do"),s(` 
sshpass `),n("span",{class:"token parameter variable"},"-p"),s(),n("span",{class:"token string"},"'root@123'"),s(),n("span",{class:"token function"},"ssh"),s(),n("span",{class:"token parameter variable"},"-o"),s(),n("span",{class:"token assign-left variable"},"StrictHostKeyChecking"),n("span",{class:"token operator"},"="),s("no root@"),n("span",{class:"token variable"},"${host}"),s(),n("span",{class:"token function"},"bash"),s(),n("span",{class:"token operator"},"<<"),n("span",{class:"token string"},`'SSHEOF'
yum install -y mongodb-org
SSHEOF`),s(`
`),n("span",{class:"token keyword"},"done"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),E=l(`<h3 id="创建配置服务器副本集" tabindex="-1"><a class="header-anchor" href="#创建配置服务器副本集"><span>创建配置服务器副本集</span></a></h3><blockquote><p>在config server节点上进行。</p></blockquote><ul><li>创建配置目录</li></ul><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /etc/mongo
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>编辑配置文件<code>/etc/mongo/mongod.conf</code>,添加如下内容:</li></ul><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token comment"># where to write logging data.</span>
<span class="token key atrule">systemLog</span><span class="token punctuation">:</span>
  <span class="token key atrule">destination</span><span class="token punctuation">:</span> file
  <span class="token key atrule">logAppend</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">path</span><span class="token punctuation">:</span> /var/log/mongodb/mongod.log

<span class="token comment"># Where and how to store data.</span>
<span class="token key atrule">storage</span><span class="token punctuation">:</span>
  <span class="token key atrule">dbPath</span><span class="token punctuation">:</span> /var/lib/mongo

<span class="token comment"># how the process runs</span>
<span class="token key atrule">processManagement</span><span class="token punctuation">:</span>
  <span class="token key atrule">timeZoneInfo</span><span class="token punctuation">:</span> /usr/share/zoneinfo

<span class="token key atrule">sharding</span><span class="token punctuation">:</span>
  <span class="token key atrule">clusterRole</span><span class="token punctuation">:</span> configsvr

<span class="token key atrule">replication</span><span class="token punctuation">:</span>
  <span class="token key atrule">replSetName</span><span class="token punctuation">:</span> abelitReplSet

<span class="token key atrule">net</span><span class="token punctuation">:</span>
  <span class="token key atrule">bindIp</span><span class="token punctuation">:</span> 0.0.0.0
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">27019</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>启动mongod</li></ul><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>mongod <span class="token parameter variable">--config</span> /etc/mongo/mongod.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>后台运行</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>mongod <span class="token parameter variable">--fork</span> <span class="token parameter variable">--config</span> /etc/mongo/mongod.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>关闭mongod</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>mongod <span class="token parameter variable">--shutdown</span> <span class="token parameter variable">--config</span> /etc/mongo/mongod.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>连接到其中一台配置服务器</li></ul><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>mongosh <span class="token parameter variable">--host</span> <span class="token number">10.10</span>.13.102 <span class="token parameter variable">--port</span> <span class="token number">27019</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>启动副本集</li></ul><blockquote><p>在mongo config server其中一个节点执行</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>rs.initiate<span class="token punctuation">(</span>
  <span class="token punctuation">{</span>
    _id: <span class="token string">&quot;abelitReplSet&quot;</span>,
    configsvr: true,
    members: <span class="token punctuation">[</span>
      <span class="token punctuation">{</span> _id <span class="token builtin class-name">:</span> <span class="token number">0</span>, <span class="token function">host</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;10.10.13.102:27019&quot;</span> <span class="token punctuation">}</span>,
      <span class="token punctuation">{</span> _id <span class="token builtin class-name">:</span> <span class="token number">1</span>, <span class="token function">host</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;10.10.13.103:27019&quot;</span> <span class="token punctuation">}</span>,
      <span class="token punctuation">{</span> _id <span class="token builtin class-name">:</span> <span class="token number">2</span>, <span class="token function">host</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;10.10.13.104:27019&quot;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="创建分片副本集" tabindex="-1"><a class="header-anchor" href="#创建分片副本集"><span>创建分片副本集</span></a></h3><h4 id="创建分片1" tabindex="-1"><a class="header-anchor" href="#创建分片1"><span>创建分片1</span></a></h4><blockquote><p>在shared 1节点上进行。</p></blockquote><ul><li>创建配置目录</li></ul><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /etc/mongo
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>编辑配置文件<code>/etc/mongo/mongod.conf</code>,添加如下内容:</li></ul><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token comment"># where to write logging data.</span>
<span class="token key atrule">systemLog</span><span class="token punctuation">:</span>
  <span class="token key atrule">destination</span><span class="token punctuation">:</span> file
  <span class="token key atrule">logAppend</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">path</span><span class="token punctuation">:</span> /var/log/mongodb/mongod.log

<span class="token comment"># Where and how to store data.</span>
<span class="token key atrule">storage</span><span class="token punctuation">:</span>
  <span class="token key atrule">dbPath</span><span class="token punctuation">:</span> /var/lib/mongo

<span class="token comment"># how the process runs</span>
<span class="token key atrule">processManagement</span><span class="token punctuation">:</span>
  <span class="token key atrule">timeZoneInfo</span><span class="token punctuation">:</span> /usr/share/zoneinfo

<span class="token key atrule">sharding</span><span class="token punctuation">:</span>
    <span class="token key atrule">clusterRole</span><span class="token punctuation">:</span> shardsvr

<span class="token key atrule">replication</span><span class="token punctuation">:</span>
    <span class="token key atrule">replSetName</span><span class="token punctuation">:</span> abelitReplSet<span class="token punctuation">-</span>shared1

<span class="token key atrule">net</span><span class="token punctuation">:</span>
    <span class="token key atrule">bindIp</span><span class="token punctuation">:</span> 0.0.0.0
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">27018</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>启动mongod</li></ul><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>mongod <span class="token parameter variable">--fork</span> <span class="token parameter variable">--config</span> /etc/mongo/mongod.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>连接到分片副本集的一个成员</li></ul><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>mongosh <span class="token parameter variable">--host</span> <span class="token number">10.10</span>.13.105 <span class="token parameter variable">--port</span> <span class="token number">27018</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>启动副本集</li></ul><blockquote><p>在mongo shared 1其中一个节点执行</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>rs.initiate<span class="token punctuation">(</span>
  <span class="token punctuation">{</span>
    _id <span class="token builtin class-name">:</span> <span class="token string">&quot;abelitReplSet-shared1&quot;</span>,
    members: <span class="token punctuation">[</span>
      <span class="token punctuation">{</span> _id <span class="token builtin class-name">:</span> <span class="token number">0</span>, <span class="token function">host</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;10.10.13.105:27018&quot;</span> <span class="token punctuation">}</span>,
      <span class="token punctuation">{</span> _id <span class="token builtin class-name">:</span> <span class="token number">1</span>, <span class="token function">host</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;10.10.13.106:27018&quot;</span> <span class="token punctuation">}</span>,
      <span class="token punctuation">{</span> _id <span class="token builtin class-name">:</span> <span class="token number">2</span>, <span class="token function">host</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;10.10.13.107:27018&quot;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="创建分片2" tabindex="-1"><a class="header-anchor" href="#创建分片2"><span>创建分片2</span></a></h4><blockquote><p>在shared 2节点上进行。</p></blockquote><ul><li>创建配置目录</li></ul><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /etc/mongo
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>编辑配置文件<code>/etc/mongo/mongod.conf</code>,添加如下内容:</li></ul><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token comment"># where to write logging data.</span>
<span class="token key atrule">systemLog</span><span class="token punctuation">:</span>
  <span class="token key atrule">destination</span><span class="token punctuation">:</span> file
  <span class="token key atrule">logAppend</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">path</span><span class="token punctuation">:</span> /var/log/mongodb/mongod.log

<span class="token comment"># Where and how to store data.</span>
<span class="token key atrule">storage</span><span class="token punctuation">:</span>
  <span class="token key atrule">dbPath</span><span class="token punctuation">:</span> /var/lib/mongo

<span class="token comment"># how the process runs</span>
<span class="token key atrule">processManagement</span><span class="token punctuation">:</span>
  <span class="token key atrule">timeZoneInfo</span><span class="token punctuation">:</span> /usr/share/zoneinfo

<span class="token key atrule">sharding</span><span class="token punctuation">:</span>
    <span class="token key atrule">clusterRole</span><span class="token punctuation">:</span> shardsvr

<span class="token key atrule">replication</span><span class="token punctuation">:</span>
    <span class="token key atrule">replSetName</span><span class="token punctuation">:</span> abelitReplSet<span class="token punctuation">-</span>shared2

<span class="token key atrule">net</span><span class="token punctuation">:</span>
    <span class="token key atrule">bindIp</span><span class="token punctuation">:</span> 0.0.0.0
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">27018</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>启动mongod</li></ul><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>mongod <span class="token parameter variable">--fork</span> <span class="token parameter variable">--config</span> /etc/mongo/mongod.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>连接到分片副本集的一个成员</li></ul><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>mongosh <span class="token parameter variable">--host</span> <span class="token number">10.10</span>.13.108 <span class="token parameter variable">--port</span> <span class="token number">27018</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>启动副本集</li></ul><blockquote><p>在mongo shared 2其中一个节点执行</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>rs.initiate<span class="token punctuation">(</span>
  <span class="token punctuation">{</span>
    _id <span class="token builtin class-name">:</span> <span class="token string">&quot;abelitReplSet-shared2&quot;</span>,
    members: <span class="token punctuation">[</span>
      <span class="token punctuation">{</span> _id <span class="token builtin class-name">:</span> <span class="token number">0</span>, <span class="token function">host</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;10.10.13.108:27018&quot;</span> <span class="token punctuation">}</span>,
      <span class="token punctuation">{</span> _id <span class="token builtin class-name">:</span> <span class="token number">1</span>, <span class="token function">host</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;10.10.13.109:27018&quot;</span> <span class="token punctuation">}</span>,
      <span class="token punctuation">{</span> _id <span class="token builtin class-name">:</span> <span class="token number">2</span>, <span class="token function">host</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;10.10.13.110:27018&quot;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="创建mongos" tabindex="-1"><a class="header-anchor" href="#创建mongos"><span>创建mongos</span></a></h3><blockquote><p>在mongos节点上进行。</p></blockquote><ul><li>创建配置目录</li></ul><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /etc/mongo
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>编辑配置文件<code>/etc/mongo/mongod.conf</code>,添加如下内容:</li></ul><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token comment"># where to write logging data.</span>
<span class="token key atrule">systemLog</span><span class="token punctuation">:</span>
  <span class="token key atrule">destination</span><span class="token punctuation">:</span> file
  <span class="token key atrule">logAppend</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">path</span><span class="token punctuation">:</span> /var/log/mongodb/mongod.log

<span class="token comment"># how the process runs</span>
<span class="token key atrule">processManagement</span><span class="token punctuation">:</span>
  <span class="token key atrule">timeZoneInfo</span><span class="token punctuation">:</span> /usr/share/zoneinfo

<span class="token key atrule">sharding</span><span class="token punctuation">:</span>
  <span class="token key atrule">configDB</span><span class="token punctuation">:</span> abelitReplSet/10.10.13.102<span class="token punctuation">:</span><span class="token number">27019</span><span class="token punctuation">,</span>10.10.13.103<span class="token punctuation">:</span><span class="token number">27019</span><span class="token punctuation">,</span>10.10.13.104<span class="token punctuation">:</span><span class="token number">27019</span>

<span class="token key atrule">net</span><span class="token punctuation">:</span>
  <span class="token key atrule">bindIp</span><span class="token punctuation">:</span> 0.0.0.0
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">27107</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>启动mongos</li></ul><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>mongos <span class="token parameter variable">--fork</span> <span class="token parameter variable">--config</span> /etc/mongo/mongod.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>连接到分片集群</li></ul><blockquote><p>连接其中一个mongos节点</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>mongosh <span class="token parameter variable">--host</span> <span class="token number">10.10</span>.13.100 <span class="token parameter variable">--port</span> <span class="token number">27107</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>将分片添加到集群</li></ul><blockquote><p>在其中一个mongos节点上执行</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>use admin

sh.addShard<span class="token punctuation">(</span><span class="token string">&quot;abelitReplSet-shared1/10.10.13.105:27018,10.10.13.106:27018,10.10.13.107:27018&quot;</span><span class="token punctuation">)</span>

sh.addShard<span class="token punctuation">(</span><span class="token string">&quot;abelitReplSet-shared2/10.10.13.108:27018,10.10.13.109:27018,10.10.13.110:27018&quot;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>查看集群状态</li></ul><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>sh.status<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="分片使用与管理" tabindex="-1"><a class="header-anchor" href="#分片使用与管理"><span>分片使用与管理</span></a></h3><h4 id="对数据库进行分片" tabindex="-1"><a class="header-anchor" href="#对数据库进行分片"><span>对数据库进行分片</span></a></h4><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>use admin

sh.enableSharding<span class="token punctuation">(</span><span class="token string">&quot;testdb&quot;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="对集合进行分片" tabindex="-1"><a class="header-anchor" href="#对集合进行分片"><span>对集合进行分片</span></a></h4><p>要对集合进行分片，请连接mongosh并 mongos使用该sh.shardCollection()方法。如果集合已经包含数据，则必须 在对集合进行分片之前创建支持 分片键的索引。如果集合为空，MongoDB 将创建索引作为 .sh.shardCollection()。</p><p>MongoDB 提供了两种对集合进行分片的策略：</p><ul><li>哈希分片使用 单个字段的 哈希索引作为分片键来跨分片集群对数据进行分区。</li></ul><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>sh<span class="token punctuation">.</span><span class="token function">shardCollection</span><span class="token punctuation">(</span><span class="token string">&quot;testdb.users&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string-property property">&quot;name&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;hashed&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>基于范围的分片可以使用多个字段作为分片键，并将数据划分为由分片键值确定的连续范围。</li></ul><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment"># sh.shardCollection(&quot;testdb.users&quot;, { &quot;age&quot; : 1, ... } )</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="入数据验证数据分片" tabindex="-1"><a class="header-anchor" href="#入数据验证数据分片"><span>入数据验证数据分片</span></a></h4><ul><li>测试插入数据</li></ul><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>use testdb

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">100000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  db<span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string-property property">&quot;id&quot;</span> <span class="token operator">:</span> i<span class="token punctuation">,</span> <span class="token string-property property">&quot;name&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;name&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>    
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>验证是否分片</li></ul><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>sh<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>获取Chunk数据的分布信息</li></ul><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>db<span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">getShardDistribution</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="查看集群配置" tabindex="-1"><a class="header-anchor" href="#查看集群配置"><span>查看集群配置</span></a></h4><ul><li>查看启用分片的数据库</li></ul><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>use config
db<span class="token punctuation">.</span>databases<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>查看分片</li></ul><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>db<span class="token punctuation">.</span><span class="token function">adminCommand</span><span class="token punctuation">(</span> <span class="token punctuation">{</span> <span class="token literal-property property">listShards</span> <span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span> <span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>查看集群详细信息</li></ul><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>db<span class="token punctuation">.</span><span class="token function">printShardingStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>或</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>sh<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="删除分片" tabindex="-1"><a class="header-anchor" href="#删除分片"><span>删除分片</span></a></h4><ul><li>确保均衡器启用</li></ul><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>sh<span class="token punctuation">.</span><span class="token function">getBalancerState</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>查看分片信息</li></ul><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>db<span class="token punctuation">.</span><span class="token function">adminCommand</span><span class="token punctuation">(</span> <span class="token punctuation">{</span> <span class="token literal-property property">listShards</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span> <span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>删除分片</li></ul><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>db<span class="token punctuation">.</span><span class="token function">adminCommand</span><span class="token punctuation">(</span> <span class="token punctuation">{</span> <span class="token literal-property property">removeShard</span><span class="token operator">:</span> <span class="token string">&quot;abelitReplSet-shared2&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>检查迁移状态分片</li></ul><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>db<span class="token punctuation">.</span><span class="token function">adminCommand</span><span class="token punctuation">(</span> <span class="token punctuation">{</span> <span class="token literal-property property">removeShard</span><span class="token operator">:</span> <span class="token string">&quot;abelitReplSet-shared2&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>将数据库移动到另一个主分片</li></ul><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>db<span class="token punctuation">.</span><span class="token function">adminCommand</span><span class="token punctuation">(</span> <span class="token punctuation">{</span> <span class="token literal-property property">movePrimary</span><span class="token operator">:</span> <span class="token string">&quot;testdb&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">to</span><span class="token operator">:</span> <span class="token string">&quot;abelitReplSet-shared1&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>完成迁移</li></ul><p>要清理所有元数据信息并完成删除，请 removeShard再次运行。</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>db<span class="token punctuation">.</span><span class="token function">adminCommand</span><span class="token punctuation">(</span> <span class="token punctuation">{</span> <span class="token literal-property property">removeShard</span><span class="token operator">:</span> <span class="token string">&quot;abelitReplSet-shared2&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="hint-container tip"><p class="hint-container-title">提示</p><p>一旦返回结果中state字段的值为<code>completed</code>，您就可以安全地停止包含分片的实例 abelitReplSet-shared2 。</p></div><h3 id="重启分片集群" tabindex="-1"><a class="header-anchor" href="#重启分片集群"><span>重启分片集群</span></a></h3><h4 id="停止均衡器" tabindex="-1"><a class="header-anchor" href="#停止均衡器"><span>停止均衡器</span></a></h4><p>连接到 mongos 路由实例，执行如下命令启动均衡器：</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>sh<span class="token punctuation">.</span><span class="token function">stopBalancer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>检查均衡器状态：</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>sh<span class="token punctuation">.</span><span class="token function">getBalancerState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="停止分片集群" tabindex="-1"><a class="header-anchor" href="#停止分片集群"><span>停止分片集群</span></a></h4><ol><li>停止mongos路由器 登陆mongos：</li></ol><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>mongosh <span class="token parameter variable">--host</span> <span class="token number">10.10</span>.13.100 <span class="token parameter variable">--port</span> <span class="token number">27107</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>在每个mongos 路由服务器上的admin数据库,执行如下命令:</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>use admin
db<span class="token punctuation">.</span><span class="token function">shutdownServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>停止每个分片副本集 登陆分片集：</li></ol><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>mongosh <span class="token parameter variable">--host</span> <span class="token number">10.10</span>.13.105 <span class="token parameter variable">--port</span> <span class="token number">27018</span>
mongosh <span class="token parameter variable">--host</span> <span class="token number">10.10</span>.13.106 <span class="token parameter variable">--port</span> <span class="token number">27018</span>
mongosh <span class="token parameter variable">--host</span> <span class="token number">10.10</span>.13.107 <span class="token parameter variable">--port</span> <span class="token number">27018</span>
mongosh <span class="token parameter variable">--host</span> <span class="token number">10.10</span>.13.108 <span class="token parameter variable">--port</span> <span class="token number">27018</span>
mongosh <span class="token parameter variable">--host</span> <span class="token number">10.10</span>.13.109 <span class="token parameter variable">--port</span> <span class="token number">27018</span>
mongosh <span class="token parameter variable">--host</span> <span class="token number">10.10</span>.13.110 <span class="token parameter variable">--port</span> <span class="token number">27018</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在每个分片集服务器上的admin数据库,执行如下命令:</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>use admin
db.shutdownServer<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>停止分片配置服务器 登陆配置服务器：</li></ol><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>mongosh <span class="token parameter variable">--host</span> <span class="token number">10.10</span>.13.102 <span class="token parameter variable">--port</span> <span class="token number">27018</span>
mongosh <span class="token parameter variable">--host</span> <span class="token number">10.10</span>.13.103 <span class="token parameter variable">--port</span> <span class="token number">27018</span>
mongosh <span class="token parameter variable">--host</span> <span class="token number">10.10</span>.13.104 <span class="token parameter variable">--port</span> <span class="token number">27018</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在每个分片集配置服务器上的admin数据库，执行如下命令:</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>use admin
db<span class="token punctuation">.</span><span class="token function">shutdownServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="启动分片集群" tabindex="-1"><a class="header-anchor" href="#启动分片集群"><span>启动分片集群</span></a></h4><ol><li>启动每个分片配置服务器</li></ol><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>mongod <span class="token parameter variable">--fork</span> <span class="token parameter variable">--config</span> /etc/mongo/mongod.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="2"><li>启动每个分片集服务器</li></ol><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>mongod <span class="token parameter variable">--fork</span> <span class="token parameter variable">--config</span> /etc/mongo/mongod.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="3"><li>启动每个mongos路由</li></ol><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>mongos <span class="token parameter variable">--fork</span> <span class="token parameter variable">--config</span> /etc/mongo/mongod.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="启动均衡器" tabindex="-1"><a class="header-anchor" href="#启动均衡器"><span>启动均衡器</span></a></h4><p>连接到 mongos 路由实例，执行如下命令启动均衡器：</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>sh<span class="token punctuation">.</span><span class="token function">startBalancer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>检查均衡器状态：</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>sh<span class="token punctuation">.</span><span class="token function">getBalancerState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,132);function R(L,H){const p=r("CodeTabs");return u(),d("div",null,[m,o(p,{id:"605",data:[{id:"手动设置"},{id:"批量设置"}],active:0},{title0:a(({value:e,isActive:t})=>[s("手动设置")]),title1:a(({value:e,isActive:t})=>[s("批量设置")]),tab0:a(({value:e,isActive:t})=>[b]),tab1:a(({value:e,isActive:t})=>[g]),_:1}),h,y,o(p,{id:"625",data:[{id:"手动设置"},{id:"批量设置"}],active:0},{title0:a(({value:e,isActive:t})=>[s("手动设置")]),title1:a(({value:e,isActive:t})=>[s("批量设置")]),tab0:a(({value:e,isActive:t})=>[f]),tab1:a(({value:e,isActive:t})=>[q]),_:1}),x,S,o(p,{id:"645",data:[{id:"手动设置"},{id:"批量设置"}],active:0},{title0:a(({value:e,isActive:t})=>[s("手动设置")]),title1:a(({value:e,isActive:t})=>[s("批量设置")]),tab0:a(({value:e,isActive:t})=>[j]),tab1:a(({value:e,isActive:t})=>[_]),_:1}),D,T,O,o(p,{id:"664",data:[{id:"Mongo官方源"},{id:"阿里云源头"}],active:0},{title0:a(({value:e,isActive:t})=>[s("Mongo官方源")]),title1:a(({value:e,isActive:t})=>[s("阿里云源头")]),tab0:a(({value:e,isActive:t})=>[w]),tab1:a(({value:e,isActive:t})=>[M]),_:1}),C,I,o(p,{id:"680",data:[{id:"手动设置"},{id:"批量命令"}],active:0},{title0:a(({value:e,isActive:t})=>[s("手动设置")]),title1:a(({value:e,isActive:t})=>[s("批量命令")]),tab0:a(({value:e,isActive:t})=>[B]),tab1:a(({value:e,isActive:t})=>[A]),_:1}),E])}const $=c(v,[["render",R],["__file","hapractise.html.vue"]]),W=JSON.parse('{"path":"/guide/database/mongo/ha/hapractise.html","title":"MongoDB高可用实战","lang":"zh-CN","frontmatter":{"title":"MongoDB高可用实战","description":"副本集集群 主机准备 架构图 主机信息 主机配置 主机名称设置 所有节点 主机hosts设置 所有节点 关闭防火墙 所有节点 Selinux设置 所有节点 安装MongoDB 配置包管理器 所有节点 安装Mongo包 所有节点 启动Mongo 所有节点 配置集群 配置mongo支持复制 所有节点 登陆mongodb实例 节点1 启动副本集 节点1 查看...","head":[["meta",{"property":"og:url","content":"https://github.com/abelit/abelit-datapeacock.git/guide/database/mongo/ha/hapractise.html"}],["meta",{"property":"og:site_name","content":"数之雀"}],["meta",{"property":"og:title","content":"MongoDB高可用实战"}],["meta",{"property":"og:description","content":"副本集集群 主机准备 架构图 主机信息 主机配置 主机名称设置 所有节点 主机hosts设置 所有节点 关闭防火墙 所有节点 Selinux设置 所有节点 安装MongoDB 配置包管理器 所有节点 安装Mongo包 所有节点 启动Mongo 所有节点 配置集群 配置mongo支持复制 所有节点 登陆mongodb实例 节点1 启动副本集 节点1 查看..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-05-11T14:06:18.000Z"}],["meta",{"property":"article:author","content":"Abelit"}],["meta",{"property":"article:modified_time","content":"2024-05-11T14:06:18.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"MongoDB高可用实战\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2024-05-11T14:06:18.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Abelit\\",\\"url\\":\\"https://github.com/abelit\\"}]}"]]},"headers":[{"level":2,"title":"副本集集群","slug":"副本集集群","link":"#副本集集群","children":[{"level":3,"title":"主机准备","slug":"主机准备","link":"#主机准备","children":[]},{"level":3,"title":"安装MongoDB","slug":"安装mongodb","link":"#安装mongodb","children":[]},{"level":3,"title":"配置集群","slug":"配置集群","link":"#配置集群","children":[]},{"level":3,"title":"副本集群测试","slug":"副本集群测试","link":"#副本集群测试","children":[]},{"level":3,"title":"故障转移","slug":"故障转移","link":"#故障转移","children":[]}]},{"level":2,"title":"分片集群","slug":"分片集群","link":"#分片集群","children":[{"level":3,"title":"主机准备","slug":"主机准备-1","link":"#主机准备-1","children":[]},{"level":3,"title":"安装MongoDB","slug":"安装mongodb-1","link":"#安装mongodb-1","children":[]},{"level":3,"title":"创建配置服务器副本集","slug":"创建配置服务器副本集","link":"#创建配置服务器副本集","children":[]},{"level":3,"title":"创建分片副本集","slug":"创建分片副本集","link":"#创建分片副本集","children":[]},{"level":3,"title":"创建mongos","slug":"创建mongos","link":"#创建mongos","children":[]},{"level":3,"title":"分片使用与管理","slug":"分片使用与管理","link":"#分片使用与管理","children":[]},{"level":3,"title":"重启分片集群","slug":"重启分片集群","link":"#重启分片集群","children":[]}]}],"git":{"createdTime":1715436378000,"updatedTime":1715436378000,"contributors":[{"name":"ableit","email":"ychenid@live.com","commits":1}]},"readingTime":{"minutes":11.59,"words":3476},"filePathRelative":"guide/database/mongo/ha/hapractise.md","localizedDate":"2024年5月11日","autoDesc":true,"excerpt":"<h2>副本集集群</h2>\\n<h3>主机准备</h3>\\n<h4>架构图</h4>\\n<figure><figcaption></figcaption></figure>\\n<h4>主机信息</h4>\\n<table>\\n<thead>\\n<tr>\\n<th>IP 地址</th>\\n<th>角色</th>\\n<th>操作系统</th>\\n<th>内核版本</th>\\n<th>软件及版本</th>\\n</tr>\\n</thead>\\n<tbody>\\n<tr>\\n<td>10.10.12.212</td>\\n<td>MongoDB 主</td>\\n<td>CentOS 7.9</td>\\n<td>3.10.0-1160.el7.x86_64</td>\\n<td>MongoDB 7.0</td>\\n</tr>\\n<tr>\\n<td>10.10.12.213</td>\\n<td>MongoDB 从</td>\\n<td>CentOS 7.9</td>\\n<td>3.10.0-1160.el7.x86_64</td>\\n<td>MongoDB 7.0</td>\\n</tr>\\n<tr>\\n<td>10.10.12.214</td>\\n<td>MongoDB 从</td>\\n<td>CentOS 7.9</td>\\n<td>3.10.0-1160.el7.x86_64</td>\\n<td>MongoDB 7.0</td>\\n</tr>\\n</tbody>\\n</table>"}');export{$ as comp,W as data};
